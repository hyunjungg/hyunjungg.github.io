<?xml version="1.0" encoding="UTF-8"?><rss xmlns:dc="http://purl.org/dc/elements/1.1/" xmlns:content="http://purl.org/rss/1.0/modules/content/" xmlns:atom="http://www.w3.org/2005/Atom" version="2.0"><channel><title><![CDATA[Hyunjung's Blog]]></title><description><![CDATA[보안과 개발을 좋아하는 학생입니다~^^]]></description><link>https://hyunjungg.github.io</link><generator>GatsbyJS</generator><lastBuildDate>Sun, 26 Mar 2023 15:37:18 GMT</lastBuildDate><item><title><![CDATA[Threat Hunting: Detecting APT37 TTPs]]></title><description><![CDATA[APT37은 최소 2012년부터 활동한 그룹으로 다양한 공격 방식을 사용해온 그룹입니다.  본 글에서는 APT37의 여러 위협 활동 중 최근(21년) 일어난 개인PC…]]></description><link>https://hyunjungg.github.io/threat_hunting/Threat_Hunting_Detecting_APT37_TTPs/</link><guid isPermaLink="false">https://hyunjungg.github.io/threat_hunting/Threat_Hunting_Detecting_APT37_TTPs/</guid><pubDate>Sun, 26 Mar 2023 16:58:13 GMT</pubDate><content:encoded>&lt;p&gt;APT37은 최소 2012년부터 활동한 그룹으로 다양한 공격 방식을 사용해온 그룹입니다. &lt;/p&gt;
&lt;p&gt;본 글에서는 APT37의 여러 위협 활동 중 최근(21년) 일어난 개인PC를 타겟으로 정보를 탈취하는 행위에 사용한 공격방식을 시뮬레이션 하고 해당 위협을 탐지하는 방법에 대해 설명합니다. (APT37 그룹 고유의 위협 및 특징을 탐지하기보다는, 범용적인 TTP를 탐지하는 것에 목적을 두고 있습니다.)&lt;/p&gt;
&lt;p&gt;악성코드 샘플을 수집하지 못한 관계로 오로지 APT37 분석 리포트들만을 참고하여 위협을 모사했습니다. 하지만 제가 임의로 특정 Technique을 추가하거나 제외한 부분도 있습니다. &lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;예시로 APT37은 악성 워드 문서 내에서 C2서버로부터 추가 악성 매크로를 로드하는 방식을 사용했지만, 본 글에서는 C2서버로부터 추가 악성 매크로가 아닌 CVE-2022-30190 취약점이 사용된 HTML파일을 다운로드해 실행하는 방식을 사용합니다.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;&lt;strong&gt;실제 APT37의 공격 시나리오와 100% 같지 않다는 점을 유념해 주셨으면 합니다.&lt;/strong&gt;&lt;/p&gt;
&lt;h3 id=&quot;toc&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#toc&quot; aria-label=&quot;toc permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;[TOC]&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;#threat-hunting--detecting-apt37-ttps&quot;&gt;Threat Hunting: Detecting APT37 TTPs&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;a href=&quot;#1-apt37&quot;&gt;1. APT37&lt;/a&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;#a----------&quot;&gt;A. 공격 조직과 타겟&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#b------&quot;&gt;B. 침투 방식&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;a href=&quot;#2--------&quot;&gt;2. 공격 시나리오&lt;/a&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;#a--------------&quot;&gt;A. 공격 시나리오 상세 설명&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#b--------------&quot;&gt;B. 시나리오 시뮬레이션 방법&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;a href=&quot;#3---&quot;&gt;3. 탐지&lt;/a&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;#a-------&quot;&gt;A. 탐지 플랫폼&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#b-1----&quot;&gt;B. 1차 탐지&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#c-2-------&quot;&gt;C. 2차 분석/탐지&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#4---&quot;&gt;4. 참고&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;h1 id=&quot;1-apt37&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#1-apt37&quot; aria-label=&quot;1 apt37 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;1. APT37&lt;/h1&gt;
&lt;h2 id=&quot;a-공격-조직과-타겟&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#a-%EA%B3%B5%EA%B2%A9-%EC%A1%B0%EC%A7%81%EA%B3%BC-%ED%83%80%EA%B2%9F&quot; aria-label=&quot;a 공격 조직과 타겟 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;A. 공격 조직과 타겟&lt;/h2&gt;
&lt;p&gt;APT37은 북한 추정 해커조직으로 2012년부터 국내를 대상으로 공격 활동을 지속하고 있으며, 공격 조직이 속한 국가와 관련된 국내 주요 인사들이 공격 대상입니다. 침해한 시스템을 파괴하거나 탈취한 정보를 이용한 협박 등의 행위를 하지 않는 것으로 보아 감시 목적이 강한 것으로 추정됩니다.&lt;/p&gt;
&lt;h2 id=&quot;b-침투-방식&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#b-%EC%B9%A8%ED%88%AC-%EB%B0%A9%EC%8B%9D&quot; aria-label=&quot;b 침투 방식 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;B. 침투 방식&lt;/h2&gt;
&lt;p&gt;타겟이 관심을 가질 만한 내용으로 스피어피싱 이메일을 송부하여 악성코드를 다운로드 받도록 유도합니다. &lt;/p&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 1024px; &quot;
    &gt;
      &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 66.66666666666666%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAANCAIAAAAmMtkJAAAACXBIWXMAAAsTAAALEwEAmpwYAAADBklEQVQozxXLbU8ScQAA8HvVVsuSRORA7ziBUMDKMkIQiQdRgj8Hh0Cgh4GhAXee8gye4AGaPAxxks6W+bBsrq21vkCfrdp+b38QZuiO6I5hU3cm9FnrPEb0bbGhB+uPUeOhxLg/NnuA6PcEUzVYU4e1bVjfgl9uCzU5eDInesFCavBN/uYcxS81kR9PfJeo4wIDN4jjGnOcKbznSs+xCvQmXD2ls4eaD0WGGmrmZKApte1L7Q2I9bdZ18G2u03bDmKmaoY4okCTMlcpC0c56glQ4zzcnreUXchETBnSkmMAF8d34vOFLUcRaimCPXnoFPN/kS+3pUvlQW8OWS7O5lljvoCReT7BYoG22FUcAAmeK/EQpPodTJ893f+mIAJQUUV2lJHu43B39N0uHCpP0dWTPzXuV4q+rJ/9YbXMDhKoqPyMkIgKiPgjPD7gTAyADT5gUTeUUQV66vD38chHCVmE/YXoSWrrKq5L0dqNDnfbpE9LiC+DeGm+f2PQWx8LsCgR4zkpgTMnsEGxYSI3/LY1GklLyZI6Vqnf5IPV9cFFdiiwh1ca1Zu8ejk7hK8Pe6NiT1JGxBA36JsL8Obej9ghBvUXkH95ZVcWrowG643bTut3CVvdlkYb9Z/cx58fYDyD+Telvqzclx7yJPud0QcLQb7tPWqHCqg/IwrsIeE0urwq8na93Fn5Nrl5nmSvO8lPdUdhTeYuPV0qqUP/8gchvjYIwCMr4FtWRPNQiuek79hzd3HmPr7DJ/b7PAmMjJqyaV+t9mwtzbNvigElduXFHlrojPXPB++ZLXd1i7zXEdgKMbPpqq1cMuSK1u0yqBXtlby1kHhJkcp3aUOKMm9RxhT5KrE+w1BGOjQZcU+QhHrp7XNydToMPfFdTPguH7s+jxFfNatX+vAXQ6inwjvo3KHSfap0n8gXDketbaXnaNLVVNg4hYUdf52V6mn5DAMpzM3/jC3BZF5i5OSmBqKrwtoGrDmQzDQkugpm2B3RNYTTnFDDiqdL4imGJ1+5L1saUEf/AoXTBnQ50CSmAAAAAElFTkSuQmCC&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;[https://industrialcyber.co/threat-landscape/securonix-provides-details-on-konni-malware-campaign-striking-high-value-eu-targets/](https://industrialcyber.co/threat-landscape/securonix-provides-details-on-konni-malware-campaign-striking-high-value-eu-targets/)&quot;
        title=&quot;[https://industrialcyber.co/threat-landscape/securonix-provides-details-on-konni-malware-campaign-striking-high-value-eu-targets/](https://industrialcyber.co/threat-landscape/securonix-provides-details-on-konni-malware-campaign-striking-high-value-eu-targets/)&quot;
        src=&quot;/static/789adf69a43b0230ec463cf6b5ee1718/2bef9/Untitled.png&quot;
        srcset=&quot;/static/789adf69a43b0230ec463cf6b5ee1718/5a46d/Untitled.png 300w,
/static/789adf69a43b0230ec463cf6b5ee1718/0a47e/Untitled.png 600w,
/static/789adf69a43b0230ec463cf6b5ee1718/2bef9/Untitled.png 1024w&quot;
        sizes=&quot;(max-width: 1024px) 100vw, 1024px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
      /&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;h1 id=&quot;2-공격-시나리오&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#2-%EA%B3%B5%EA%B2%A9-%EC%8B%9C%EB%82%98%EB%A6%AC%EC%98%A4&quot; aria-label=&quot;2 공격 시나리오 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;2. 공격 시나리오&lt;/h1&gt;
&lt;p&gt;먼저 APT37 공격 시나리오를 요약해서 설명하겠습니다.&lt;/p&gt;
&lt;p&gt;APT37은 악성 워드 문서를 통해 시스템에 침투합니다. 이후 다양한 Defense Evasion 테크닉을 사용하여 악성 DLL을 윈도우 정상 프로그램에 로드하여 실행합니다. 악성 DLL은 시스템에 상주해 주기적으로 정보를 탈취하여 C2로 전송하는 역할을 합니다. &lt;/p&gt;
&lt;p&gt;자세한 설명은 바로 다음 파트에서 이어지며, 시나리오 설명을 위해 ATT&amp;#x26;CK Matrix를 사용합니다. 전체적인 ATT&amp;#x26;CK Matrix 매핑 정보는 다음과 같습니다.&lt;/p&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 1200px; &quot;
    &gt;
      &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 50.33333333333333%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAYAAAC0VX7mAAAACXBIWXMAABcRAAAXEQHKJvM/AAAB40lEQVQoz2WSbU/iQBSF+///iF8MGxPIGqLyWqC1tNM3phRBdN1EgYIChcVAz56paHD3JpPbuZ15zrm31X6Wy5lhGDBUrlRg3N6iw73eaqF5dQXr+hp6owF1psFsGibKrNfKZZjFElo3N6jxrH5xAadQgNYsFhE29czRdTh8cScEAttG0OtBMo+4HMuC5/twXRdhGED2+/Ao0C2VIAj3azW0z88hCj+g6ZVK5tIVgZkgVHY6cNptWAR5zOpw4ArEgwGEI3JgGIYIKSA9j+IOItfL9/fDIbTZfI5kMsHo8hLDeh2echZFiOIYkqs/GiFkbcQcBAFi1hx2MSD0gc7vWIsolm42UKHt93ukyyXiahU9zkiwLekHubqoN+Bzrg47EHRhMvd5eUgnsyTJAcq5aZpYrVYfwN1uh+XbG3yri4iQHt2F3S5sDt2mgIIl0ykWiwUanFdMR6dxT+dqtuv1+gh8f8eaDp1qDZItRAT+enrCjADlRkZ9/KFodjjgN9ucj8fIsuzbOvCdyl8ON6S7HQM9Kvmc1/TYjpQyn9fmOJ/P+IIB/9W17XarnvLC5PER9tkZZgSpGNBtQJE0TT8unDg5zZ8rd5gDjzF5foatt5C8vOT7Mf+1B3797evrt8unjv6Nv0kb0pqlm3z1AAAAAElFTkSuQmCC&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;Untitled&quot;
        title=&quot;Untitled&quot;
        src=&quot;/static/350ddef73d99a2c7411680e20f66e56b/c1b63/Untitled1.png&quot;
        srcset=&quot;/static/350ddef73d99a2c7411680e20f66e56b/5a46d/Untitled1.png 300w,
/static/350ddef73d99a2c7411680e20f66e56b/0a47e/Untitled1.png 600w,
/static/350ddef73d99a2c7411680e20f66e56b/c1b63/Untitled1.png 1200w,
/static/350ddef73d99a2c7411680e20f66e56b/d61c2/Untitled1.png 1800w,
/static/350ddef73d99a2c7411680e20f66e56b/0f96c/Untitled1.png 2248w&quot;
        sizes=&quot;(max-width: 1200px) 100vw, 1200px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
      /&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;h2 id=&quot;a-공격-시나리오-상세-설명&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#a-%EA%B3%B5%EA%B2%A9-%EC%8B%9C%EB%82%98%EB%A6%AC%EC%98%A4-%EC%83%81%EC%84%B8-%EC%84%A4%EB%AA%85&quot; aria-label=&quot;a 공격 시나리오 상세 설명 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;A. 공격 시나리오 상세 설명&lt;/h2&gt;
&lt;p&gt;ATT&amp;#x26;CK Matrix 를 사용해 공격 시나리오를 설명합니다.&lt;/p&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 1200px; &quot;
    &gt;
      &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 62%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAMCAYAAABiDJ37AAAACXBIWXMAABcRAAAXEQHKJvM/AAAClklEQVQoz1WTv08TYRjHn94dveOAtEgpEEkggehgmIwhMYSwgAmBqAPaSBggtUdL23vf+wl3LWBS4gKJzEy6uJg46N/g5mAcZHBRRyfd1KF+n0tp4E2+ed73yb2f59d7RJ3l2TYJ1yVHSv3AsgZO1tf720Sp/e3tLHyPXSHuUrtNn6an1R/5vPo9n6f7Jyd0WCqRj7ueEORDdBnY5s35OX0bHU1/nprqYeCLQsEQjvMIUImzwr6O1U4LBdra378KxIesFNuXq6v0ZWKCfmYyDEsCfJiZSWyjXM6xfRrHhhVF6fdzcz2ulBkk0g9gP4D6ZWCinSiiV8vLxKXNn53R66WlBPZH0wz2cXn4bhaaR3vySPoh9n2ogABPJUD0JofDTdiBUAgNkfqwn4GGV9AjBv5TVePr+Lj2dmGBv+8DaBh3srBjkMbJ1D0vaRtHHIEzgF05rNfVQIg0zhvQKg+JMwNUh1SGb4chucgoQJntwUEOQMK2U0EQkAM/4SKrB8ogKh1XKpx+DgGGWsWisnlwoKJkvTMIWjs9pdBxdN/zOEtqxnHCCAH0kOUFMNEZPwEp1V3bNoXnKbUgMJ+0Wvov0zQYyNk2d3ZI+v4d1/OeSSGGGo3G2B5WFEW3oKtAbm5Qq5F0nMmoUuF3SL9NU4HMv6qaPp+cTMp+XiyOouySkHL6qNUywjBcAGyEs+yuBMrTEkKBvRHWatnkXSKrTh+Vi6d04d84OlK8atV4gL1brfKzSXeBESb0cW2N3lkWYTC9VrOZerO4SHYYZsXu7jUGOK6bK8Vx7/HmZm+jXr9e830dwzEAGmQYpHWBfuelQyo0EEhp7JXLGhp923XdGAOY4N6GlYqO/s16vn/P2toiF4n41Wr3T/kPtUU31xY8bqoAAAAASUVORK5CYII=&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;Untitled&quot;
        title=&quot;Untitled&quot;
        src=&quot;/static/b6962e5841661cba14cc84e90c39f7da/c1b63/Untitled2.png&quot;
        srcset=&quot;/static/b6962e5841661cba14cc84e90c39f7da/5a46d/Untitled2.png 300w,
/static/b6962e5841661cba14cc84e90c39f7da/0a47e/Untitled2.png 600w,
/static/b6962e5841661cba14cc84e90c39f7da/c1b63/Untitled2.png 1200w,
/static/b6962e5841661cba14cc84e90c39f7da/d61c2/Untitled2.png 1800w,
/static/b6962e5841661cba14cc84e90c39f7da/4779f/Untitled2.png 1837w&quot;
        sizes=&quot;(max-width: 1200px) 100vw, 1200px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
      /&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;h3 id=&quot;1-compromise-infrastructure-servert1584004--stage-capabilities-upload-toolt1608002--develop-capabilities-malwaret1567001&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#1-compromise-infrastructure-servert1584004--stage-capabilities-upload-toolt1608002--develop-capabilities-malwaret1567001&quot; aria-label=&quot;1 compromise infrastructure servert1584004  stage capabilities upload toolt1608002  develop capabilities malwaret1567001 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;(1) Compromise Infrastructure: Server(&lt;a href=&quot;https://attack.mitre.org/techniques/T1584/004/&quot;&gt;T1584.004&lt;/a&gt;) &amp;#x26; Stage Capabilities: Upload Tool(&lt;a href=&quot;https://attack.mitre.org/techniques/T1608/002/&quot;&gt;T1608.002&lt;/a&gt;) &amp;#x26; Develop Capabilities: Malware(&lt;a href=&quot;https://attack.mitre.org/techniques/T1567/001/&quot;&gt;T1567.001&lt;/a&gt;)&lt;/h3&gt;
&lt;p&gt;공격자는 기업의 웹서버를 탈취해 명령제어 서버를 구축하며 공격에 필요한 문서, 스크립트, 악성코드를 자체 제작합니다. 분석 리포트에 따르면 공격자는 탈취한 페이스북 계정을 사용하여 공격 대상에게 접근했음을 알 수 있습니다.  본 글에서는 &lt;a href=&quot;https://attack.mitre.org/tactics/TA0043/&quot;&gt;Reconnaissance&lt;/a&gt; 과 &lt;a href=&quot;https://attack.mitre.org/tactics/TA0042/&quot;&gt;Resource Development&lt;/a&gt; Tactic 부분은 시뮬레이션 하지 않습니다.&lt;/p&gt;
&lt;h3 id=&quot;2-phishing-spearphishing-attachementt1566001&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#2-phishing-spearphishing-attachementt1566001&quot; aria-label=&quot;2 phishing spearphishing attachementt1566001 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;(2) Phishing: Spearphishing Attachement(&lt;a href=&quot;https://attack.mitre.org/techniques/T1566/001/&quot;&gt;T1566.001&lt;/a&gt;)&lt;/h3&gt;
&lt;p&gt;공격자는 비밀번호로 암호화된 악성 RAR 파일과 함께 스피어 피싱 메일을 송부합니다. &lt;/p&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 538px; &quot;
    &gt;
      &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 77%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAPCAYAAADkmO9VAAAACXBIWXMAABcRAAAXEQHKJvM/AAACP0lEQVQ4y61Ty47aQBDk/+8c4MBKkZLcc0oga5D2FASORMIe4jV+vzAP22BsbDyV7mG92ZUipEgZqeRmmOnuqq7pGIYhzuczqqoSdV2jxel0Qp7n8nsLfOY1OnEc43K5CMdxYJomLMsCx2VZghf9h4ZABVEzqBjvXQtXEELg9epsNhsRBAF6vZ5QVRXT6RTdblcmFk2D/X6PQ5YhoW+WpsgozvMjUorTJAGz48WJGZwQ6/Uag8EAHG+3W/T7fbiuiwt14NA3oYvbTQyLGLiOC9/zYFsmbNuG74dvE3ICjw4oiiIPMN3xeIzVaiUPFkUh6ZZlgePxKKXgvZLAGr50+JxUJvT9QCZrl+f7srOGOnxcPiKKIjiWjThaQ6dCDnVnGKa8lxD1tkOpYUSHzlSV9SmLE9FLsaMi+x1pd8ikhjwA7qSuatmhRFHS3nVIbyhzddFcsE9yqVUYhogIAXVpmAZSGsK/rA4PhDUJjSnm3x4wUSYEBep8Th0e5CS5aBgG2O12VHQPthpL1Q6UWfD0ZYe8kZPY2uIe958/4eP7D3h3d4fRl+H1El02SS+bbMRWYouZ5tWrjk3eNQwZB0F4TcgUedUN/st6SVhV52caWykBgym3Rm6aPxXbAfwNHd/35bw91xHD4Qiz2QzLnz+wXC6hfB1hPHmAqn4no3s4UgH25M2ErCEXjdcRFouFHIL+9CSnvdI1WOTPX5oGXddhkAczSnqTsqZpgmnR2xRyquTHliq/DI75LfNvjtlat/Ab64hxXdgj1fMAAAAASUVORK5CYII=&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;Untitled&quot;
        title=&quot;Untitled&quot;
        src=&quot;/static/6f58fc4a1b9e57151594a70884f9096f/9516f/Untitled3.png&quot;
        srcset=&quot;/static/6f58fc4a1b9e57151594a70884f9096f/5a46d/Untitled3.png 300w,
/static/6f58fc4a1b9e57151594a70884f9096f/9516f/Untitled3.png 538w&quot;
        sizes=&quot;(max-width: 538px) 100vw, 538px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
      /&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;h3 id=&quot;3-user-execution-malicious-filet1204002&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#3-user-execution-malicious-filet1204002&quot; aria-label=&quot;3 user execution malicious filet1204002 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;(3) User Execution: Malicious File(&lt;a href=&quot;https://attack.mitre.org/techniques/T1204/002/&quot;&gt;T1204.002&lt;/a&gt;)&lt;/h3&gt;
&lt;p&gt;rar파일이 해제되면 정상 파일로 위장된 악성 word문서가 생성됩니다. &lt;/p&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 836px; &quot;
    &gt;
      &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 99.66666666666667%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAYAAACNiR0NAAAACXBIWXMAABcRAAAXEQHKJvM/AAAC4klEQVQ4y6VT204TURSdfzEabzHGRBL+wFeJURITL//gqz+heEMfeCHGVx60MQgCCm2hNCX0zkxbgRbbmc50pveWszzr2JEWMWLcycrZs2df19lHuzo5JSYevcX4g9fi3MRTXLw1hUu3n+HK5AuM3Z/G9XvTGJO4dvel0scfvpH6K5yXfmdvPsEFeUqIy3ee48yNx0KbCyzCKJTEWjSLhXAWK5sGFsMZfFpLIbC8jbnFGD5+TeDDShzvJRaCKcyvJvGZPqEsAl8SmF9LYzmii3dzC9AKelKY5QPUbEt4NQtO1UTVLqNh7cGW9lJJnuZ3HJSKsOW/ml2BbZWlXwX0bzdd1F1bdFp16Nm00NKZLKpVW8G0LFQqTGjDcWqwrKrS/X/UzYGtLP2oOzVX/avJMxQOQ8vlcjgujUYDrVYLf5NutwvX9ZTe6/URCoWgGYahDPV6HUtLSwjLKvF4HKlkEplMBoaRU8mJdrstO6nJKSrKn+AUQohBwvBRQs/zMDMzg0gkoiqzS8dxVBCFQRS7WkU+n4freSPd9nq9o5F959PI4eGhCu73+yOFVMLQCQmp05mBPAk6+/Btw/aRhP7IrutifX0dLGDzNk1ToSpHJB2kgCc5HAZtJ3JYr3vY3o4jLxOSI15IIpFANptVQQQv5U/yx5FZdWNjAzs7O9jd3VUd7+/vq2/erk/Lcd5HEqqd6nTU2LzZknwVHJU8MZB8UvjdkX4+2HGz2fx5Uf3+aEL+aDSaKkGzyYWty6SW5NNRhSzLVNzasiCLchK/QK/XVbpabH9k/2U4MiiVMiSP35BOp6DrBsgzRybUsuu6tOuqw+Hb/61Dn8N8nrztKQ4LhYL8Lqj3zE7ZJX14MgkfATHSIYWtMymr0kHx1O38CvB5U/rARl+uk7+XwWAQmmxdDBZZDC/zaUD/AUSn08Xq6prQisWi2gT8v4jNaBRaIBAQsVgMW1tb/vlP8GOjMtns7Kz4ATUrxXp1n0ScAAAAAElFTkSuQmCC&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;Untitled&quot;
        title=&quot;Untitled&quot;
        src=&quot;/static/e571e76494087cce5d0a238fde7b628e/27b8e/Untitled4.png&quot;
        srcset=&quot;/static/e571e76494087cce5d0a238fde7b628e/5a46d/Untitled4.png 300w,
/static/e571e76494087cce5d0a238fde7b628e/0a47e/Untitled4.png 600w,
/static/e571e76494087cce5d0a238fde7b628e/27b8e/Untitled4.png 836w&quot;
        sizes=&quot;(max-width: 836px) 100vw, 836px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
      /&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;h3 id=&quot;4-exploitation-for-client-executiont1203&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#4-exploitation-for-client-executiont1203&quot; aria-label=&quot;4 exploitation for client executiont1203 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;(4) Exploitation for Client Execution(&lt;a href=&quot;https://attack.mitre.org/techniques/T1203/&quot;&gt;T1203&lt;/a&gt;)&lt;/h3&gt;
&lt;p&gt;공격자는 CVE-2022-30190 취약점이 사용된 악성 워드 문서를 통해 서버로부터 Powershell 커맨드를 다운로드해 실행시킵니다. 이 명령어는 작업 스케줄러 태스크를 생성합니다. &lt;/p&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 1200px; &quot;
    &gt;
      &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 15.333333333333336%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAADCAYAAACTWi8uAAAACXBIWXMAABcRAAAXEQHKJvM/AAAA4ElEQVQI12MoKixkKikpYajNyOBuT0jgbk1K4mlLTOQpz8vjzMvNZahfvpyhv6tLevG8+WFnz55e3lPT+shcSP2drYTRextxNCxm+J4BaKB+QVFR9H8GBobPnJxcXzg4OIFsjsq8PL7CoqKAsqKimt7Ozhcrliz5f/zYkf8T6rp/WgkZ/nNXsvvvpmADxu6KtmDaVd76P0NJQYEcUKPdex4elk22tnxLPD0FgAayVOXksBQXFjoUFRQoT+7rUwK6MP3MmVPb++o63pvya/y2FNH/ayGsB8S6fy1F9P5aQfkAMZ5ipr5p9NQAAAAASUVORK5CYII=&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;Untitled&quot;
        title=&quot;Untitled&quot;
        src=&quot;/static/2d0f11004d69617cf7b581cdb3aad237/c1b63/Untitled5.png&quot;
        srcset=&quot;/static/2d0f11004d69617cf7b581cdb3aad237/5a46d/Untitled5.png 300w,
/static/2d0f11004d69617cf7b581cdb3aad237/0a47e/Untitled5.png 600w,
/static/2d0f11004d69617cf7b581cdb3aad237/c1b63/Untitled5.png 1200w,
/static/2d0f11004d69617cf7b581cdb3aad237/d61c2/Untitled5.png 1800w,
/static/2d0f11004d69617cf7b581cdb3aad237/536a8/Untitled5.png 2049w&quot;
        sizes=&quot;(max-width: 1200px) 100vw, 1200px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
      /&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;&lt;strong&gt;CVE-2022-30190&lt;/strong&gt; 이란 RCE 취약점으로 이를 활용하면 MS오피스 문서 내에서 TargetMode=”Exeternal”모드로 서버에서 html파일을 로드한 후 msdt url protocol을 사용하여 파워셸 명령어를 실행할 수 있습니다.
타겟 유저가  “매크로 허용”을 클릭하지 않아도, 악성 행위 수행이 가능합니다.
자세한 설명은 &lt;a href=&quot;https://www.cybereason.com/blog/threat-alert-follina/msdt-microsoft-office-vulnerability&quot;&gt;링크&lt;/a&gt;를 참고해 주세요.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h3 id=&quot;5-scheduled-taskjob-scheduled-taskt1053005&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#5-scheduled-taskjob-scheduled-taskt1053005&quot; aria-label=&quot;5 scheduled taskjob scheduled taskt1053005 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;(5) Scheduled Task/Job: Scheduled Task(&lt;a href=&quot;https://attack.mitre.org/techniques/T1053/005/&quot;&gt;T1053.005&lt;/a&gt;)&lt;/h3&gt;
&lt;p&gt;취약점을 활용해 시스템에 작업 스케줄러 태스크를 생성 및 실행합니다. 생성된 태스크는 C2서버에 접속을 시도합니다.&lt;/p&gt;
&lt;h3 id=&quot;6-masqueradingt1036&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#6-masqueradingt1036&quot; aria-label=&quot;6 masqueradingt1036 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;(6) Masquerading(&lt;a href=&quot;https://attack.mitre.org/techniques/T1036/&quot;&gt;T1036&lt;/a&gt;)&lt;/h3&gt;
&lt;p&gt;작업 스케줄러 등록 시 정상 태스크로 위장하기 위해 특정 백신사명을 사용합니다.&lt;/p&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 1200px; &quot;
    &gt;
      &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 9.666666666666666%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAACCAYAAABYBvyLAAAACXBIWXMAABcRAAAXEQHKJvM/AAAAZklEQVQI122KOwqAMBQEvf/BtNE6mH9esBJEMS/pXE1AsLAYdhmm056wbvt1pBNcClJKyDn/wszgdx9e9226cZou4wLmfsAiJZQxCCGAiBr1e+/bV0rBWgvnHOanrU4IAa01KMbW3tPOlNSzsmADAAAAAElFTkSuQmCC&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;Untitled&quot;
        title=&quot;Untitled&quot;
        src=&quot;/static/2caebca8282b4f43ac58fc876aaf60b1/c1b63/Untitled6.png&quot;
        srcset=&quot;/static/2caebca8282b4f43ac58fc876aaf60b1/5a46d/Untitled6.png 300w,
/static/2caebca8282b4f43ac58fc876aaf60b1/0a47e/Untitled6.png 600w,
/static/2caebca8282b4f43ac58fc876aaf60b1/c1b63/Untitled6.png 1200w,
/static/2caebca8282b4f43ac58fc876aaf60b1/d61c2/Untitled6.png 1800w,
/static/2caebca8282b4f43ac58fc876aaf60b1/5e703/Untitled6.png 1942w&quot;
        sizes=&quot;(max-width: 1200px) 100vw, 1200px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
      /&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;h3 id=&quot;7-system-binary-execution-mshtat1218005&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#7-system-binary-execution-mshtat1218005&quot; aria-label=&quot;7 system binary execution mshtat1218005 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;(7) System Binary Execution: Mshta(&lt;a href=&quot;https://attack.mitre.org/techniques/T1218/005/&quot;&gt;T1218.005&lt;/a&gt;)&lt;/h3&gt;
&lt;p&gt;등록된 작업 스케줄러 태스크가 실행되면, Windows의 정상 유틸리티인 mshta를 악용해 악성 .chm을 서버에서 다운로드하고 실행합니다.&lt;/p&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 1200px; &quot;
    &gt;
      &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 27.333333333333332%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAFCAYAAABFA8wzAAAACXBIWXMAABcRAAAXEQHKJvM/AAABDUlEQVQY0y2QbYuDMBCE/f9/q9B+LCJiU69qYtX0lJr6UqqFzM2GCywJ2Z1nZzdSKvOXnwr2d/DjOOL1esE5h2VZMM8zpmn6v2dI3jEvNc/nGHLhzzn/+XyQJImPmrpEpbVvjEF+OMDkOYqqQlWW0Fqj7To0TQNrLeq6xu12g6lZyzpDTZZlUEqxkfPH0xHR9/v14FmW2WdpCkOIMToIS0L7vkdnOzp6YhgGFEWBpm1D/n6/BxjhgZGmqY+2bZM3Jo6VXS4oCCmqEup6haILTRecAKW4ZohrCYHZxyM0lFjXFefzGdG+7wG4cmeW3WaONRLqJAiYKJb3xFi52/X9DmIxwukg+o37kxPHMf4A0Qpy7vfWEpMAAAAASUVORK5CYII=&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;Untitled&quot;
        title=&quot;Untitled&quot;
        src=&quot;/static/04a9a57896c75e0ddb398ae067817cd3/c1b63/Untitled7.png&quot;
        srcset=&quot;/static/04a9a57896c75e0ddb398ae067817cd3/5a46d/Untitled7.png 300w,
/static/04a9a57896c75e0ddb398ae067817cd3/0a47e/Untitled7.png 600w,
/static/04a9a57896c75e0ddb398ae067817cd3/c1b63/Untitled7.png 1200w,
/static/04a9a57896c75e0ddb398ae067817cd3/d61c2/Untitled7.png 1800w,
/static/04a9a57896c75e0ddb398ae067817cd3/0faf1/Untitled7.png 1956w&quot;
        sizes=&quot;(max-width: 1200px) 100vw, 1200px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
      /&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;h3 id=&quot;8-system-binary-proxy-execution-compiled-html-filet1218001&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#8-system-binary-proxy-execution-compiled-html-filet1218001&quot; aria-label=&quot;8 system binary proxy execution compiled html filet1218001 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;(8) System Binary Proxy Execution: Compiled HTML File(&lt;a href=&quot;https://attack.mitre.org/techniques/T1218/001/&quot;&gt;T1218.001&lt;/a&gt;)&lt;/h3&gt;
&lt;p&gt;실행된 .chm 파일은 도움말 파일로 위장한 악성 페이로드입니다.  .chm파일 실행 시 악성 페이지로 연결되어 추가 파워쉘 스크립트를 다운로드 받아 실행시킵니다.&lt;/p&gt;
&lt;p&gt;.chm 파일 생성을 위해 컴파일에 사용된 HTML 파일은 &lt;a href=&quot;https://github.com/hyunjungg/Threat-Hunting/blob/APT37/APT37/Resources/Compromised_Server/payloads/hello.chm.htm&quot;&gt;여기&lt;/a&gt;서 확인하실 수 있습니다.&lt;/p&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 1030px; &quot;
    &gt;
      &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 54.333333333333336%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAABcRAAAXEQHKJvM/AAAC5UlEQVQozz2PSUwTURjH3wk9GwMlwYB0Q6IIKIorCCe5ePECZWlRxHiSoxgxFSQaL57dDuwQDkZATDh5gBYEhAKBtiANS5jpdJkuTNs30+/zvcZ4+OX9t+/wiLC/TkVRRL/fD77dXfD5fCBJEhweHmTY39sDORzGeCzGiEIoGIRAQIJoJAKiIIBwdAQRpmOs4xmJRkLKsaKokVicJlMqTVKVqmmgKVVjWtNYBmlEjMQTKMcUoKqmUS1N5dgxTaQo5TqlpqnCbtOAlIRDYRRDIVz0+HB9P4o7IS3DdlBFXwTxIIH40+XDaccGuv1J9PgT6BYT6NoL4caBzLSCXrb1SBTdQhzJ1uam/UgQu6Wg/EqUgt1HotTrD4Tsx8lUx+aWu29sZJS+eNaJXZ3PcXxsjG5tefqOk7QjGJbtgj/Qy284/gB7GcTr9RJBlEg0oZFgJE5+r6wS9kPy+mVX65vubvfbnh58/+4dcLjmGe/4ZmXFRSQ5RuR4gohBOQNZXFzMcrnWTg5/+UTePG0nX8fHG0aHhraH+vpwZGAARwcHYbi/Hzlc84x3bLPDt/bHzWTo8wfiWts4sb7pziJKLEr+eNxkenLyyo+pqZnv377h94kJ/DE5qbIsPc00A/6BmYx1fMO3bDfD/NXd7W2SiMcJoYqSt7K09GF+bg6ds7O44HBoCw6nxv28wwHMwy+n8z//PP5yOjT2sh27YdvV5eWPmEzmkXv36wVb2xNssdqgubVNbbW1gq2xAR/ZrNBubYKHzY3YbKnHpoZ6tLK8raURrJZ6sLTYkAEWW5vaZHuAFosF79bVSSRHp4NcY7mmv1QFF0rLsNKUD6XmYrhcWoHVxgK8oc/HioIzWJKXi0W6nAymnGw06nLAnKtj5GZ04elTqj47G4nhXEnKXH4LTefLoKi4GC4aCvGauRivm4vwtv4s3tQXYo3ZiHfMBqwtMjJtwCqTAasZtSyvMRmg2qgH3lcW5Kf/AkzjZ7Y2hr8vAAAAAElFTkSuQmCC&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;Untitled&quot;
        title=&quot;Untitled&quot;
        src=&quot;/static/9f0a592862568f67d8a4d4a8f0e69e43/7a1fb/Untitled8.png&quot;
        srcset=&quot;/static/9f0a592862568f67d8a4d4a8f0e69e43/5a46d/Untitled8.png 300w,
/static/9f0a592862568f67d8a4d4a8f0e69e43/0a47e/Untitled8.png 600w,
/static/9f0a592862568f67d8a4d4a8f0e69e43/7a1fb/Untitled8.png 1030w&quot;
        sizes=&quot;(max-width: 1030px) 100vw, 1030px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
      /&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;h3 id=&quot;9-command-and-scripting-interpreter-powershellt1059001&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#9-command-and-scripting-interpreter-powershellt1059001&quot; aria-label=&quot;9 command and scripting interpreter powershellt1059001 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;(9) Command and Scripting Interpreter: Powershell(&lt;a href=&quot;https://attack.mitre.org/techniques/T1059/001/&quot;&gt;T1059.001&lt;/a&gt;)&lt;/h3&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 617px; &quot;
    &gt;
      &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 88.33333333333333%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAASCAYAAABb0P4QAAAACXBIWXMAABcRAAAXEQHKJvM/AAADzUlEQVQ4y42SbUxbZRTHz723t46XAL29LX2DIjicBDPNYnzJNDEkU8eSOT/MxeiyhPDBiO29FVpDBwFaiDic2WCDtVDG2t5uWGi7jTK2klHDyIiOZIlRo9/4MBOziG7DD2xwPc+1xW7xrcmv5zznOc8/z/nfB1oEgUNeQPQIZPmnX07PFuTpFkE0I08gZU5ByAf8K0feQZ5EyJpy/j/Bx5D9yJsuUXjbKQoHMX8GbA4H09DcTAkOB9tls8Fhux1EUfwPQRE+sovwsWiHZlsTVmXqs9YG+KDJCeTw88iHSB0RyvJvgja7C2rfOknBK5NQvttfV14/Ulex55R1y6sRRfBZxIa8SIRcLhcVCQZh4tw5mCSMjytxIocdB4bBsOsUWN4YKijb7W9AGi2vD2lNr/kUQQsRc4iitdXtBlmWIRaNbh4mgrliRFyWk/DSewG8nU9dVh+osdQHaq17RlTl9cMAzsMeOCItFr7reh++Epqo+bY2+vu9e6krfX3MbG8vcx39TXd00HMeD01qc11d9NyRXjrqaKd3Hl1QLiDLX6saO8bhgBNHPh5aBO9A1CKjP/tlmT47NVUVunpVJ83MmDCvjly6VBaandWfTSYrI8nk40o9mawam0tzM81ucB+NFrmPTfJ9wwn4fPQ8wHP3ZXBJX+rvFHNFKGq4XV2tvWs08r9rNNyvVqtuxWrlV7Va7UpFBX+3tJS/p9drfzOb+Xu8Tov9+e4zqfzuE5Maz1ACPIMxAFc4DZ2+C4YfaneosEGNMIgqE+kMTE4ke6p1ABYjhWcLvCdjGs9gHLwIdA9MABaMtejFcuU2IKP/XFMDgcVFZmx+nj29sKAKptPqcCqlPn3tGhGBLCF7JzlbgGIajH8K9vR/oQiis/ALb1Aav9u3D0KplC4yPW2SLl82oHdmzK0kGmSZ+mn7dqVvtOUTwHEfFmxM/QjtI9OG23pjHjZpNiiKW6fpEsw5pJjUEOIvqRXjHoc9JfdZNY9rnSN6Pb9nIPrXyG2jM9A1dN6w9PIuJuMR8zf+MY/4mAU6/Rcf9rCnP7o5shefzbFbt5hPV1fpkRs31P6lJbZnbY0WcEzfzZusH+lfXla1Y9+Jb75lJRT04Mje3JE7/FOAn9zYiYIXRgOmWCRSGQ+FSHwqJknV8XDYHA8GSzHfRohLEtkvjYWlqunwWHHr8URe92CM27zhzhXyDtP6O0WaQhzB9IBlizZy/CN+PVCrs2sO90rWGUaJuC7MfmV8Ppkb+i7ig0wYE4cE4g+VZS0vj9rIWT/K8tYaWrEpI5i94R+KJhHO81P4QAAAAABJRU5ErkJggg==&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;Untitled&quot;
        title=&quot;Untitled&quot;
        src=&quot;/static/74dcf56139c88773c1d03c1b32c211c9/bc962/Untitled9.png&quot;
        srcset=&quot;/static/74dcf56139c88773c1d03c1b32c211c9/5a46d/Untitled9.png 300w,
/static/74dcf56139c88773c1d03c1b32c211c9/0a47e/Untitled9.png 600w,
/static/74dcf56139c88773c1d03c1b32c211c9/bc962/Untitled9.png 617w&quot;
        sizes=&quot;(max-width: 617px) 100vw, 617px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
      /&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;.chm 파일에 의해 다운로드 된 파워셸 스크립트는 C2서버와 통신 하며 다음과 같은 역할을 합니다.&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;감염된 시스템의 UUID 값 전송&lt;/p&gt;
&lt;p&gt;이 값이 C2서버에 전송되면, C2서버는 해당 UUID 값으로 서버의 특정 경로에 폴더를 생성합니다.&lt;/p&gt;
&lt;p&gt;이 폴더는 추후 감염 시스템에서 수집한 파일들과 스크린 샷을 저장하는 목적으로 사용됩니다.&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;C2 서버에서 수신한 명령어 실행&lt;/p&gt;
&lt;p&gt;C2 서버로부터 명령어를 수신 받고 실행하고, 수행 결과를 다시 C2서버로 전송합니다.&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&quot;10-system-time-discoveryt1124&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#10-system-time-discoveryt1124&quot; aria-label=&quot;10 system time discoveryt1124 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;(10) System Time Discovery(&lt;a href=&quot;https://attack.mitre.org/techniques/T1124/&quot;&gt;T1124&lt;/a&gt;)&lt;/h3&gt;
&lt;p&gt;C2서버와 통신하는 파워셸 스크립트는 시스템의 시간 정보를 출력하는 커맨드를 실행하고 서버로 전송합니다.&lt;/p&gt;
&lt;h3 id=&quot;11-data-encodingnon-standard-encodingt1132002&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#11-data-encodingnon-standard-encodingt1132002&quot; aria-label=&quot;11 data encodingnon standard encodingt1132002 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;(11) Data Encoding: Non-Standard Encoding(&lt;a href=&quot;https://attack.mitre.org/techniques/T1132/002/&quot;&gt;T1132.002&lt;/a&gt;)&lt;/h3&gt;
&lt;p&gt;명령어 실행 결과를 XOR 암호화 후 C2서버에 전송합니다.&lt;/p&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 1200px; &quot;
    &gt;
      &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 36.333333333333336%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAHCAYAAAAIy204AAAACXBIWXMAABcRAAAXEQHKJvM/AAAB40lEQVQoz1WPS2/TUBCF74pUILEFwYKfxZIfAEiVWLJCLNpCBRLLriqQUJEKhYpHEZAbqxElTWvaOmmezcPXj8Tx246dJrk+ON4x0qczM4tzZkjFOICoFnHYpnix9gw7X7bw4etbrK+sodTIo2qWcNgt4Fjeh8iKKPcESIMDVIw/qI5KaC3wjtEOT1DTi5vkzNwrltiusN/Ypo+WH9KN18/pm/ev6PKD+7RQeUfr4S9aknfp797HlB0qNLfpqblHz70ftOr/pLXBZ6E2+pavxYJYFzefkkacJ7dBCNpYApD7D4ac8hI5byvtBeTmNFUJOV5O95+QK+dxRb+7cr11b+PaxfcnJLVZImdShVSb0uOe2gksf9QzPYOlmmH6BnPHNhuMNCaeHjFVV9hwOGSe57Ew8Fk0iVnsOqpvWf0OcDM1vEokJhJJFtdl5wLGWIXuy1C8Lnp2K+v7Tgs14wTnxl/oDoPv+bAsE4HvI4pjRK6LwLZhALeyC4eeRnRHWY1mIaaYXE75hMfziNvjEY9nEXdikzOvw7Vxn1uBwcMg5NPplGeVJPMkjpNJGF4qwI3MUNM0oijK6iLVsq1ZSmKniY7jLOZMXcfNLtNUFfV6Hd1uF3K7Db3TSVKgyPKsWRDuLF7+B7xzxbuX/b06AAAAAElFTkSuQmCC&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;Untitled&quot;
        title=&quot;Untitled&quot;
        src=&quot;/static/b0daf76c497cf4787a11a895dc183f4d/c1b63/Untitled10.png&quot;
        srcset=&quot;/static/b0daf76c497cf4787a11a895dc183f4d/5a46d/Untitled10.png 300w,
/static/b0daf76c497cf4787a11a895dc183f4d/0a47e/Untitled10.png 600w,
/static/b0daf76c497cf4787a11a895dc183f4d/c1b63/Untitled10.png 1200w,
/static/b0daf76c497cf4787a11a895dc183f4d/e0577/Untitled10.png 1796w&quot;
        sizes=&quot;(max-width: 1200px) 100vw, 1200px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
      /&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;h3 id=&quot;12-bits-jobst1197&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#12-bits-jobst1197&quot; aria-label=&quot;12 bits jobst1197 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;(12) BITS Jobs(&lt;a href=&quot;https://attack.mitre.org/techniques/T1197/&quot;&gt;T1197&lt;/a&gt;)&lt;/h3&gt;
&lt;p&gt;(9)번에서 실행된 파워셸 스크립트는 BitsAdmin을 통해 악성 dll 파일을 다운로드합니다. &lt;/p&gt;
&lt;h3 id=&quot;13-hijack-execution-flow-dll-side-loadingt1574002&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#13-hijack-execution-flow-dll-side-loadingt1574002&quot; aria-label=&quot;13 hijack execution flow dll side loadingt1574002 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;(13) Hijack Execution Flow: DLL Side Loading(&lt;a href=&quot;https://attack.mitre.org/techniques/T1574/002/&quot;&gt;T1574.002&lt;/a&gt;)&lt;/h3&gt;
&lt;p&gt;파워셸 스크립트는 악성 dll 파일 실행을 위해 정상 프로그램에 Side Loading 기법을 이용하여 악성코드를 주입합니다. 이로 인해 악성 dll이 Windows 정상 프로그램에 로드되어 실행됩니다.&lt;/p&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 1200px; &quot;
    &gt;
      &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 55.333333333333336%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAABcRAAAXEQHKJvM/AAACNElEQVQoz3WSW0/bQBCF/f9/QKVKPEBKW9GmpSq0FUJq8wB5SkJi5+ILtuMYX7Ed27mQYGdPZzeAeGhXOppde/zNmfFKo0mPhaGKMJywONbA9zNHxmymwLYHiCIdUajBvO0hCDQkiSnOtnWDKDaQBios+Yp5Rhed1jmTRqZMSUOWZWNstzaWSxNFYSCf68hSVUR+zjJNiJ8XCxN5riOn52WmInM6KLw+G1yfQ3LdgAVBAteNmOslCKMMcTynD1YoSHzPlaYFFc7F8+gph0d+Xi43bLvdQVbGTPJ9H/M5AcoFbia3SOcFfN/D1J4SJKXkJRVzwfPiOCJogoeHNepdjaqqUNeViHzJ8gDSdOqQqxjr1QqaqqEsS1iWDV03RMzznKJFyQqGigKVcqqqxuvFGBNRofcCGD0BeXKRFzRwW+wdx8GCnHOgogwJOISm6S+OOIhrt9vtHT4DfT/Aw3oNdbIHcmeGYYhWi6KAaVqiOgdOJup/gXuHNKu7Ow+rVw4dKjKbzeB5HjabDV0ZEwq1zDUajVEWJd2I7QvwueVOtwvJMi3GHdGPYQbNLblPBIwPPwoj4dAwbjEYyJBJw+FIvOMGuLO6rrkEsd1uM+meAI7jsjW17Lp32FDlNM1QLhZCj48VPPrDOo2At87hJc31H4v1+31IZydN9u24icvvF+zjQQMXpz9x+r6Jr0Jf8KN5hk+HH3D05gDHbw/x+egErV+/SX9wfdnCDbXZ7fXYgGCNxjv2F3UfJa5Xqe51AAAAAElFTkSuQmCC&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;Untitled&quot;
        title=&quot;Untitled&quot;
        src=&quot;/static/ac8b7e329cf71046ad175ec816f9cbc6/c1b63/Untitled11.png&quot;
        srcset=&quot;/static/ac8b7e329cf71046ad175ec816f9cbc6/5a46d/Untitled11.png 300w,
/static/ac8b7e329cf71046ad175ec816f9cbc6/0a47e/Untitled11.png 600w,
/static/ac8b7e329cf71046ad175ec816f9cbc6/c1b63/Untitled11.png 1200w,
/static/ac8b7e329cf71046ad175ec816f9cbc6/5d36b/Untitled11.png 1467w&quot;
        sizes=&quot;(max-width: 1200px) 100vw, 1200px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
      /&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;h3 id=&quot;14-boot-or-logon-autostart-execution-registry-run-keys--startup-foldert1547001&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#14-boot-or-logon-autostart-execution-registry-run-keys--startup-foldert1547001&quot; aria-label=&quot;14 boot or logon autostart execution registry run keys  startup foldert1547001 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;(14) Boot or Logon Autostart Execution: Registry Run Keys / Startup Folder(&lt;a href=&quot;https://attack.mitre.org/techniques/T1547/001/&quot;&gt;T1547.001&lt;/a&gt;)&lt;/h3&gt;
&lt;p&gt;실행된 dll 파일은 지속적으로 정보를 탈취하기 위해 레지스트리에 자기 자신을 등록합니다.&lt;/p&gt;
&lt;p&gt;등록 경로는 다음과 같습니다.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;bash&quot;&gt;&lt;pre class=&quot;language-bash&quot;&gt;&lt;code class=&quot;language-bash&quot;&gt;HKEY_CURRENT_USER&lt;span class=&quot;token punctuation&quot;&gt;\&lt;/span&gt;SOFTWARE&lt;span class=&quot;token punctuation&quot;&gt;\&lt;/span&gt;Microsoft&lt;span class=&quot;token punctuation&quot;&gt;\&lt;/span&gt;Windows&lt;span class=&quot;token punctuation&quot;&gt;\&lt;/span&gt;CurrentVersion&lt;span class=&quot;token punctuation&quot;&gt;\&lt;/span&gt;Run&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h3 id=&quot;15-screen-capturet1113--automated-collectiont1119&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#15-screen-capturet1113--automated-collectiont1119&quot; aria-label=&quot;15 screen capturet1113  automated collectiont1119 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;(15) Screen Capture(&lt;a href=&quot;https://attack.mitre.org/techniques/T1113/&quot;&gt;T1113&lt;/a&gt;) &amp;#x26; Automated Collection(&lt;a href=&quot;https://attack.mitre.org/techniques/T1119/&quot;&gt;T1119&lt;/a&gt;)&lt;/h3&gt;
&lt;p&gt;악성 dll은 피해자 화면을 지속적으로 캡처하고 C2서버에 전달합니다. C2서버로 전송 된 스크린 샷들은 (9)번에서 생성된 폴더에 저장됩니다.&lt;/p&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 1200px; &quot;
    &gt;
      &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 43%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAJCAYAAAAywQxIAAAACXBIWXMAABcRAAAXEQHKJvM/AAACUElEQVQozz3S+09ScRjHcfqhvIBZWcua15ymeANvCBmXwzmcAxwPIKYxbA5B02zTZolaOaHa0iWgq7xNtK2t/9J3B9r64bXn+Tw/PNv3YohGAkSj2tX0VITJqEZYC6KpCrLkQfS6UHQZ+wAFh4UfniG+O/v46erhVOjhTDBzIZn5JXXyW3nMH38HhqBVvFKtIqEhGdUqIXY4cTeN4Goaxl5vwW22saV4+eRzkZWd7KoChQmJfMRLIeIhFxojrzk4CNs5jtoxSI1PEB/ar4QHNkrEBjveRgdyqwuh3obf5uXF0ktic0liyRTx+QVmFvScmud5cp6pRKpscnaOxOtVDFqfRMl4r0igW0B85MTXbCfQMoqnfhCv9SlaaJyg4icYCOCXZf06RBRJQvGV+PSZD5/oJR6LYbDd62boThcjdeZytRjbsVS3MWBso/d6M67eUcLRCOOqvjSosri0yNb7LdLp9D8badb1uv5unc3NTQydVc2032jUNZV1VOi5pKqF1msN2M3DaJEQAX8AWVFYW1sjl8uxu7dHoZDn4PCQQ11en+3v5/Qjm4YIVw4wYRxg0mRhqqaf6Zt9xG/3M2Ps4plljK+5b5ydnnJ0dMTJyQnFYpHz83OKF0Uu9P7y8rKcl14tYVgxSaQrZD4YZXZqRL7cEtitc5O/7+b4roOVQYE3Wxt8zmTZ3t4uy2azZDKZ/8p5Z4f4TBxDstrJcoWH1UqRt9UimyaBj7VusvrS3VoHy4Oi/sKzJBMJUqkUCb1qmv5fw2FCoXC5L1FVlchEhL9TLWCQkyWIxwAAAABJRU5ErkJggg==&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;Untitled&quot;
        title=&quot;Untitled&quot;
        src=&quot;/static/9dfa566cb55509a2ee1876ba209403c0/c1b63/Untitled12.png&quot;
        srcset=&quot;/static/9dfa566cb55509a2ee1876ba209403c0/5a46d/Untitled12.png 300w,
/static/9dfa566cb55509a2ee1876ba209403c0/0a47e/Untitled12.png 600w,
/static/9dfa566cb55509a2ee1876ba209403c0/c1b63/Untitled12.png 1200w,
/static/9dfa566cb55509a2ee1876ba209403c0/d61c2/Untitled12.png 1800w,
/static/9dfa566cb55509a2ee1876ba209403c0/97a96/Untitled12.png 2400w,
/static/9dfa566cb55509a2ee1876ba209403c0/89587/Untitled12.png 2624w&quot;
        sizes=&quot;(max-width: 1200px) 100vw, 1200px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
      /&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;h3 id=&quot;16-data-from-local-systemt1005&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#16-data-from-local-systemt1005&quot; aria-label=&quot;16 data from local systemt1005 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;(16) Data from Local System(&lt;a href=&quot;https://attack.mitre.org/techniques/T1005/&quot;&gt;T1005&lt;/a&gt;)&lt;/h3&gt;
&lt;p&gt;감염 시스템내에서 &lt;code class=&quot;language-text&quot;&gt;CSIDL_DESKTOP&lt;/code&gt;, &lt;code class=&quot;language-text&quot;&gt;CSIDL_PERSONAL&lt;/code&gt;,&lt;code class=&quot;language-text&quot;&gt;CSIDL_MYMUSIC&lt;/code&gt;, &lt;code class=&quot;language-text&quot;&gt;CSIDL_MYVIDEO&lt;/code&gt; 위치의 파일을 수집합니다.&lt;/p&gt;
&lt;p&gt;수집 파일 확장자 목록은 다음과 같습니다.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;bash&quot;&gt;&lt;pre class=&quot;language-bash&quot;&gt;&lt;code class=&quot;language-bash&quot;&gt;jpg&lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt;jpeg&lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt;png&lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt;gif&lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt;bmp&lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt;hwp&lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt;doc&lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt;docx&lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt;xls&lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt;xlsx&lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt;xlsm&lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt;ppt&lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt;pptx&lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt;pdf&lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt;txt&lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt;mp3&lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt;amr&lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt;
m4a&lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt;ogg&lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt;aac&lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt;jpg&lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt;jpeg&lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt;png&lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt;gif&lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt;bmp&lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt;hwp&lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt;doc&lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt;docx&lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt;xls&lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt;xlsx&lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt;xlsm&lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt;ppt&lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt;pptx&lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt;pdf&lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt;
txt&lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt;mp3&lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt;amr&lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt;m4a&lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt;ogg&lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt;acc&lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt;av&lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt;wma&lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt;3gpp&lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt;eml&lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt;lnk&lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;zip&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;rar&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt;egg&lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt;alz&lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt;7z&lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt;vcf&lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt;3gp&lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h3 id=&quot;17-archive-collected-dataarchive-via-libraryt1560002&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#17-archive-collected-dataarchive-via-libraryt1560002&quot; aria-label=&quot;17 archive collected dataarchive via libraryt1560002 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;(17) Archive Collected Data: Archive via Library(&lt;a href=&quot;https://attack.mitre.org/techniques/T1560/002/&quot;&gt;T1560.002&lt;/a&gt;)&lt;/h3&gt;
&lt;p&gt;수집한 정보를 ZIP으로 압축합니다. &lt;/p&gt;
&lt;h3 id=&quot;18-exfiltration-over-c2-channel&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#18-exfiltration-over-c2-channel&quot; aria-label=&quot;18 exfiltration over c2 channel permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;(18) Exfiltration Over C2 Channel&lt;/h3&gt;
&lt;p&gt;ZIP으로 압축한 파일을 C2채널을 통해 유출합니다.&lt;/p&gt;
&lt;p&gt;다음 이미지는 C2서버에 전송된 압축ZIP 파일을 압축 해제 후 확인한 모습입니다.&lt;/p&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 1200px; &quot;
    &gt;
      &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 53.666666666666664%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAABcRAAAXEQHKJvM/AAACOElEQVQoz52R20vTYRjHfyQeOoFReZiHualrB3XOTbc556Ztc2aooeSFt3XXbSBSZmRe1G13RViEWdmwJP+RdqUoU+e8kG2COs3N36f9XtKgi05f+PDCy8PnfZ7nlQa9Pvq9PrnH66fb3Ynf2U6g1YPLaMOps+CobcSqNmGp0GcxCJoqjb9gkJUaXVGFLA17euUBRxC/oY1eq58+WwCPthlboYF2lZXOKofAU96Mu7SJjko71vN66nI11OdrBQ0FWswFNXJ1XgnS1ZpWXKUW2XymGq+6hU6NgzaVBWdxA/5aF/3WLgbs18TZobXj1bbgKmtEl1OG7pRKUC2VyFmokApladDZQ0Dfhr24nu46L4PO6wy5++izBAga2ult9HHDFqTrips7w7d4+niSiXsPGLs7wvjIKI9G7zM5Ns6ThxPcHrqJ1Jp9zVHagFNlxlVuESh3zReN2C4YaLlkEt3qc8r5PB1CiSzLxJMJorENvqUPOc7CwhckU54aU16VwJirPsGUX3VC/WktGukyH16+FaKNaJS1tTXCX8NEIhFWVlbYT+0zPzeHpBT/CfO5muyeipl5/obDTJrVyCrJZJLNzU2WlpZYX18nlUox/+mHsK5A83vhWUVYwtSzF+ymdonH48RiMSE7lsYTCUKzs38v1EhFhF6/F7s6ODggmh07HA6ztbXF9vY2R0dHzIVC/yb8OPVOCNPpNJlMRoy6vLzM4uIie3t7/yF89VOo/LTSlZKdnR0hnZme5jt4Qc+0SbI6XgAAAABJRU5ErkJggg==&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;Untitled&quot;
        title=&quot;Untitled&quot;
        src=&quot;/static/4a8b80b7f8a858606b3f5e680458c0a8/c1b63/Untitled13.png&quot;
        srcset=&quot;/static/4a8b80b7f8a858606b3f5e680458c0a8/5a46d/Untitled13.png 300w,
/static/4a8b80b7f8a858606b3f5e680458c0a8/0a47e/Untitled13.png 600w,
/static/4a8b80b7f8a858606b3f5e680458c0a8/c1b63/Untitled13.png 1200w,
/static/4a8b80b7f8a858606b3f5e680458c0a8/7ef4c/Untitled13.png 1748w&quot;
        sizes=&quot;(max-width: 1200px) 100vw, 1200px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
      /&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;h2 id=&quot;b-시나리오-시뮬레이션-방법&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#b-%EC%8B%9C%EB%82%98%EB%A6%AC%EC%98%A4-%EC%8B%9C%EB%AE%AC%EB%A0%88%EC%9D%B4%EC%85%98-%EB%B0%A9%EB%B2%95&quot; aria-label=&quot;b 시나리오 시뮬레이션 방법 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;B. 시나리오 시뮬레이션 방법&lt;/h2&gt;
&lt;p&gt;본 글에서는 개인PC를 타겟으로 정보를 탈취하는 위협을 모사하였기 때문에 여러 대의 타겟 시스템이나 별도의 AD환경 구축이 필요하지 않습니다. &lt;/p&gt;
&lt;p&gt;시뮬레이션을 위해 구축해야 하는 환경은 C2 Server와 Victim System(Windows) 두 개 입니다.&lt;/p&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 1200px; &quot;
    &gt;
      &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 59.66666666666667%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAMCAYAAABiDJ37AAAACXBIWXMAABcRAAAXEQHKJvM/AAACeElEQVQoz1VSXUhTYRh+z9Y5NgW3GppzSDiWFZNqyaCGUEiMbgKDMFCJGDEx1HO+n7Pt6JD1I9oWqLO8CQQTL+qmGyEouqr7oMvYbd502UUR0nq+/bFdPLzv957nfb7nfb9D/4iogUpLVHg7Pk6p2VmtWCjEK5UKfR4ZaXJa+a1oJG7AAEFH1FU8HBzsIIi82Ni4UNraev1yfX1YnX+EQh11XoNv1PvbBFVRa3X4cWpKe7q3R6XNzWCpVJpA7H+yv08fpqfbeKqv3t8mqDcEf3k8tZENgxZ3dqiwukrPi0UqrK2Rs7vbXMdvXW8dWW8KVloE/7rd9CaRICYlScuiwvIyZYTodGzbh+gpOg4J1M1Mht6NjdGRy9VwqNZER5pWE/yj6/qh3191mMznyWaM0pbVm7EsH2LQtqwziIG0afqQ92Zx4V24LgeD9HVoSPvp9RqNFdCnWEwl+veBAU0tnYMMITdEexhjccb5WYELhJRRKeVomrGTnHP3AniJ7W2icln1V82sT04SgXwin0r1LM7NeXF7Jx0ckGNZLslYAIK3gNHc0pImhHgIwQdw1/equ1tN0SU4P4XVhLPz8+fB77MxgRLshot7aJTIA1nLMkBW4n448QCn8e0xYkjY9vGsafq/hcOeSv23wU7voD/PlXNMQqYQGpIImhBYvypC8BgEe2wpLyqgHoHDCByeU6t4NDPjUiO+j8fd4A/juwNMsKog56SSKpDfz+XIMU01sl/a9m24uiRRR34ZuIk8yFZWag+AnatXh6iB/q6qYF1MA1zKnTBNSi8sKJexNOcJPMI1uL2K83XgBnAFD0TPkkn6Eo0qMTVh09R/wu88poVZFJYAAAAASUVORK5CYII=&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;Untitled&quot;
        title=&quot;Untitled&quot;
        src=&quot;/static/9a5b81a83e69b4c404e4e2999c4b214c/c1b63/Untitled14.png&quot;
        srcset=&quot;/static/9a5b81a83e69b4c404e4e2999c4b214c/5a46d/Untitled14.png 300w,
/static/9a5b81a83e69b4c404e4e2999c4b214c/0a47e/Untitled14.png 600w,
/static/9a5b81a83e69b4c404e4e2999c4b214c/c1b63/Untitled14.png 1200w,
/static/9a5b81a83e69b4c404e4e2999c4b214c/1f038/Untitled14.png 1481w&quot;
        sizes=&quot;(max-width: 1200px) 100vw, 1200px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
      /&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;h3 id=&quot;1-c2-server-setup&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#1-c2-server-setup&quot; aria-label=&quot;1 c2 server setup permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;(1) C2 Server Setup&lt;/h3&gt;
&lt;p&gt;Docker 구동이 가능한 시스템에서 다음 명령어를 입력해줍니다.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;bash&quot;&gt;&lt;pre class=&quot;language-bash&quot;&gt;&lt;code class=&quot;language-bash&quot;&gt;&lt;span class=&quot;token function&quot;&gt;git&lt;/span&gt; clone https://github.com/hyunjungg/Threat-Hunting.git
&lt;span class=&quot;token builtin class-name&quot;&gt;cd&lt;/span&gt; Threat-Hunting/APT37/Resources
docker run --name apt37_server -d -p &lt;span class=&quot;token number&quot;&gt;80&lt;/span&gt;:80 -v &lt;span class=&quot;token variable&quot;&gt;&lt;span class=&quot;token variable&quot;&gt;$(&lt;/span&gt;&lt;span class=&quot;token builtin class-name&quot;&gt;pwd&lt;/span&gt;&lt;span class=&quot;token variable&quot;&gt;)&lt;/span&gt;&lt;/span&gt;/Compromised_Server/:/var/www/html hyunjungg/apt37:1&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h3 id=&quot;2-victim-system-setup&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#2-victim-system-setup&quot; aria-label=&quot;2 victim system setup permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;(2) Victim System Setup&lt;/h3&gt;
&lt;p&gt;1909버전 이하의 Windows에서 다음과 같은 설정을 합니다&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Windows Defender OFF&lt;/li&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;C:\Windows\System32\Drivers\etc\host&lt;/code&gt; 파일에 &lt;code class=&quot;language-text&quot;&gt;compromsied.server [C2_server_ip]&lt;/code&gt; 추가&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;위 두 개의 설정이 끝나면 &lt;a href=&quot;https://github.com/hyunjungg/Threat-Hunting/blob/APT37/APT37/Resources/Initial_Execution_Payloads/NorthKorea&amp;#x27;s_latest_situation.rar&quot;&gt;rar 파일&lt;/a&gt;을 다운로드 받고 실행합니다.  rar파일의 압축을 해제 하면(pw : 1234), 악성 Word문서가 생성됩니다.&lt;/p&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 893px; &quot;
    &gt;
      &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 17.333333333333336%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAADCAYAAACTWi8uAAAACXBIWXMAABcRAAAXEQHKJvM/AAAA50lEQVQI1x2KzUvCcACG9w+HfSBlh4K8dPDcMaIwTMFtJisqkChx0UGCZXOfTubmREc6rEP0exodXnh4nldaL1OxCG3svi6SkUMS2MS+ReQNiT2LNAr+OfJzn/fYM5mNXeahR+SaZPOYnywV/H7z2n0Ukto1kI2V0IZr2oMV1/nktwVVPaT1vuTsacRlb0y7H9Fx8s9Hhmp8ctpxOH8O0Kwvai8TLnoTUaneIVVkXRRqJjt1UxSbDuWHhF3ZpaT6HN1P2WqY7Csuxzc+hy2b7YbFgRZSbNpsXg3YUzxKiisKdYuNk1vxB0//yHs7JbmnAAAAAElFTkSuQmCC&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;Untitled&quot;
        title=&quot;Untitled&quot;
        src=&quot;/static/b5fc2e1fc215577d4779cc5bbf70f5bd/6c745/Untitled15.png&quot;
        srcset=&quot;/static/b5fc2e1fc215577d4779cc5bbf70f5bd/5a46d/Untitled15.png 300w,
/static/b5fc2e1fc215577d4779cc5bbf70f5bd/0a47e/Untitled15.png 600w,
/static/b5fc2e1fc215577d4779cc5bbf70f5bd/6c745/Untitled15.png 893w&quot;
        sizes=&quot;(max-width: 893px) 100vw, 893px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
      /&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;악성 Word문서를 더블 클릭 하여 열면 이후 모든 시나리오가 자동으로 실행됩니다.&lt;/p&gt;
&lt;h1 id=&quot;3-탐지&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#3-%ED%83%90%EC%A7%80&quot; aria-label=&quot;3 탐지 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;3. 탐지&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;탐지는 &lt;strong&gt;1차 탐지&lt;/strong&gt;와 &lt;strong&gt;2차 분석&lt;/strong&gt; 으로 나누어져 있습니다. 1차 탐지를 위해서는 ElastAlert를 사용하며, 기본적인 위협을 탐지합니다. 하지만 ElastAlert는 단일 이벤트에 대한 탐지만 가능합니다. 따라서 여러 이벤트를 조합해서 탐지하는 것이 불가능합니다. 이러한 단일 이벤트 탐지의 한계를 2차 분석에서 커버합니다. 2차 분석은 파이썬 Elastic Query Dsl을 사용합니다.&lt;/p&gt;
&lt;p&gt;최종적으로 모든 분석이 끝난 후, 위협으로 판단된 프로세스들을 트리 형태로 시각화합니다.&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;IOC (Indicator of Compromise, 파일명 - 악성 도메인 등 단순 지표) 정보는 탐지에 활용하지 않았습니다.&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&quot;a-탐지-플랫폼&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#a-%ED%83%90%EC%A7%80-%ED%94%8C%EB%9E%AB%ED%8F%BC&quot; aria-label=&quot;a 탐지 플랫폼 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;A. 탐지 플랫폼&lt;/h2&gt;
&lt;p&gt;탐지 플랫폼은 아직 미완성 상태입니다.  최종적으로 구축하고자 하는 플랫폼의 파이프라인은 다음과 같습니다. (회색 부분은 미완성으로, 개발 진행 중인부분 입니다.) &lt;/p&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 1200px; &quot;
    &gt;
      &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 55.00000000000001%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAABcRAAAXEQHKJvM/AAADDElEQVQoz2NggILSggIwLsnLA9NlUD4yBoH///8zGrq4WUQY687Y7Gmv84ODgeEBVD/coLLCQjDdXFfH0N3ayjC1rw+kkSEjOZmhKDeXoRhqCcxAIztrC30jo96GiAj+joMHGK8D1ZbBLT31n4Hl5EOmn0DmhIA0hp7mZoaZkyczgjTmpMUxTGkMAhrCAMbFGYEMYZERzOvnzOUCyjMXl1fwRgH1ZZdmMfxnamdIKMkE8jb+Z+A6fB3I4GTosi9maK+vZ0lJiuOztjYTq64o5z42Q47x/yeIgfO6g5kKC0sYUrLrgB49xlSWk8lRXJDLkNtXx/ifIZ0hrDaXiUG7e7e2wYqtkRXTS4Qa1ncyzJ83l4ODQYgHaINXXmw8l6DNedaTiw01b67UUtFznM9RXNbC3lboI7NhsoVJcWktX1FZLktlWo7gaesinZnJZXwMhku3JMqtPvzdbuZa5Q0uBhwlzR0cWbWB4mHJLoatE5MFE3O28vbly9gmdke3qVz+zzkjJUXANi1E1WVyXeqC6cvZK2vKeZNdfcUyCupq6x+8YmcomVwl5zRtlWlg8VSBvow41uKiXJGm7Z6Tm3e7H23Y4Juhz/Cf0cS/iNcqs1GxrqOatyQ4gqWosVUgraFdsTQvh6etupkxPzeLx2Jeu3RmQzUfQ/T/A8Dg+MTwup2Bsbo8lqG4KIuveYfX3Kad7teaN/vlVzxiY5i52ZeV4cd/hgJhbwYDYFicnTmDBRikjHrV9eDUsG/XHmZQIE9Jy2GChPbpL4wgOruqiKGsJJ+5fm6kZMPCCIWAHB1BkAYgYGRICGZYdeooLOmA8dFTpxjv3LnDcO/uXYY3p84xXDp1igGeiHMcuxjyi5IZamtKGDKnmzA8/X+Q4fa1hzJ37twujImOZQUZCjJk9erVPK9fv+4AYhsQf8+ePeJnz5717+/vF6ipqeGBZRSGypZUhtKybIbgQD+Gk/fXgTVfunRB8v69+2EuLs7MMHVVVVUsFy9e1Dl16pQo2Lv79gmdOXPGoaSkhLOhvp4HAEpRV52trsYxAAAAAElFTkSuQmCC&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;Untitled&quot;
        title=&quot;Untitled&quot;
        src=&quot;/static/0fc046ca63ba59222c0754c8e084a35a/c1b63/Untitled16.png&quot;
        srcset=&quot;/static/0fc046ca63ba59222c0754c8e084a35a/5a46d/Untitled16.png 300w,
/static/0fc046ca63ba59222c0754c8e084a35a/0a47e/Untitled16.png 600w,
/static/0fc046ca63ba59222c0754c8e084a35a/c1b63/Untitled16.png 1200w,
/static/0fc046ca63ba59222c0754c8e084a35a/8fdfc/Untitled16.png 1725w&quot;
        sizes=&quot;(max-width: 1200px) 100vw, 1200px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
      /&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;우선 Target System 에서 Winlogbeat를 통해 Sysmon데이터를 수집합니다. &lt;strong&gt;ElastAlert에서 1차 탐지를 한 후 celery_app에서 2차 탐지를 수행하는 구조로 개발 중입니다.&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;2차 탐지까지 진행되면 그래프 DB인 NEO4J에서 프로세스 관계를 시각화하고, 그중 악성 프로세스를 식별하여 화면에 표시함으로써 위협 정보를 가시화하는 것을 최종 목표로 하고 있습니다.&lt;/p&gt;
&lt;p&gt;하지만 앞서 언급 드렸듯이 아직 구현이 덜 된 부분이 있기 때문에,  2차 탐지 로직을 Jupyter Notebook을 통한 구현으로 대체하였습니다…&lt;/p&gt;
&lt;p&gt;탐지 플랫폼 구축이 완료되는 대로 본 글을 수정할 예정이며, Jupyter Notebook을 통해 임시로 구축한 파이프라인은 다음과 같습니다.&lt;/p&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 1200px; &quot;
    &gt;
      &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 55.333333333333336%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAABcRAAAXEQHKJvM/AAAC/ElEQVQoz1VSa0iTYRQ+35xuTre8ZVFiVEKUVs5MhpqirExRUPM+XOnm3O2b275dndvn3HSmNtRlKuS0QksjVEq6SKGYghlYBEn/jCCwfiVB9evt25xSBw7n8j7nObyHByBgerXa7zqVyh8Ngfpf9xlCCOPyL/Gqzp0eepyfnfSbCbAZmN8jMmg0/uiw2aC7vR0G3G7fIEhFItDiOBCBJbuEKVkZvLMpKTdaq6r2dS4uYBsU1rC39A0C+upn2h8q7S2WQI/DAcMeD+YbVEqEcNNeSpGA3wlpCVRUVwVN3x5hUe9BhNHErqHmFHo5IJoLrulkVDWLgLW0QSWh0JVNgIsk6eJ6IScjIy3WYjKGrQzFY2h7h9DbfYWm0ehArLBRH12hGZQyJqHGAXfbMASNUGHFaZDYPZ+Y/GCu2jSoi2qdvg6j3hEmE6LCqQ0FqtqrrMjM9eDVe9yTnyZPJZzJGWUSRiejQ1MYN+PhpRJ6G0drwOlmiTJyLUObNCwycIA7/qQu/uHSr6zhR8dn+MlMnaOTKbeWHKgQ8bntfaLIOuUc290Ud6GuW9CR8AGFDolFEZmSsgS+x9YwNjDOMLUY2aKLRbFStc1Kbn5jgM7THJ97a+p8CTEQ4ZYKgwktHtP2NN/jmM9bts8USVMAYanFWna6zH6U7LSw1TVCuoVsi9KYyWNqjTqsR2/BmnBFOM/rOixrtXBAgBaoc2zDdxdgFmMtEFo5x/GsYKTted5H+2yRauxHPvRNXQ72HVF/kA+9vExgUPd4cSKJJXK2BUtcLrCbWzDfe2elkLZz7bWf/obCTMmHUAW1egWHyLvlR6yDtdEIFQLaoDDSdABGCFSKG0JelqVFtAsK2fVkV5Dc4QaH0wkUApoljbAnYmVOF+hMUjDocbBPlgM5VQzknUp4iwTwOhf5denziYn7+7++X9768m5FEejR9JSOd7W8Z2ZnA+goPem1Kh8RRk6UYtZhAayhbNAaxX5MTEQ01t/Xz95aXyQ3V1+lB4T+H9FfcA1D60W4j8cAAAAASUVORK5CYII=&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;Untitled&quot;
        title=&quot;Untitled&quot;
        src=&quot;/static/9fdb470b95616199a447a6d8c23d705e/c1b63/Untitled17.png&quot;
        srcset=&quot;/static/9fdb470b95616199a447a6d8c23d705e/5a46d/Untitled17.png 300w,
/static/9fdb470b95616199a447a6d8c23d705e/0a47e/Untitled17.png 600w,
/static/9fdb470b95616199a447a6d8c23d705e/c1b63/Untitled17.png 1200w,
/static/9fdb470b95616199a447a6d8c23d705e/8fdfc/Untitled17.png 1725w&quot;
        sizes=&quot;(max-width: 1200px) 100vw, 1200px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
      /&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;h2 id=&quot;b-1차-탐지&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#b-1%EC%B0%A8-%ED%83%90%EC%A7%80&quot; aria-label=&quot;b 1차 탐지 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;B. 1차 탐지&lt;/h2&gt;
&lt;p&gt;1차 탐지 및 분석을 위해서 ElastAlert를 사용합니다. &lt;/p&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 501px; &quot;
    &gt;
      &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 50.33333333333333%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAYAAAC0VX7mAAAACXBIWXMAABcRAAAXEQHKJvM/AAAByUlEQVQoz5VSPVPbQBDVD+KPUFBQQEvDD6CmpU3BL4jbxHyEhJIiwYAZYFJEtnHGRkwyJkyCpJOl0+nrpH3ZOzuMJ8lMJjuz2rer07vdt3LG4zHFcYwoEiSE4Bghnk5tnHI0HscmF/B9H0EQWDdY5DlEWSIsS1Ja46zTISdJEuR5QYIJiqJEkkj8ePKRSImQLwhDJgpCyDTF7yZaLTxub2OytYWm26Xh/T0c7oAm3x7Rvbym65uPuLi8QvvgyPre4VsbD4+OcTv8bEnqukbDbmy0vIy7tTW4S0vk7+xgMJmQE4Yh6qZBluVIU2W7LHgMk2c8EndvayaanIhAfN7YeGUF3vo6RqurCJjw9uEBjtGtqjSkTGekSkGpjEdU9gKVZXZcOceLhN93d/FlcxPexgbykxP0PQ+2w/8xQ7gYF8113T8JFw/+C5tOyWjKG34mfPIDZKyRz9ssyor1JIgoRswSNPxhIhWiaYxK17auWBZzRteNdYOlylFowidDqPPZ76ALBTTVrx4Y5s8d1eUcE2+X9N+EsM+v3gjOy+MLHJwP0T7t49V7F68/9LB/NrDR5PudgX3XPu1ZbOoGz2r9Oe7h3dUdXrTe4Cef1+NtRzzvqAAAAABJRU5ErkJggg==&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;Untitled&quot;
        title=&quot;Untitled&quot;
        src=&quot;/static/01e4eec03139b7c83e3e1457c6d74493/55811/Untitled18.png&quot;
        srcset=&quot;/static/01e4eec03139b7c83e3e1457c6d74493/5a46d/Untitled18.png 300w,
/static/01e4eec03139b7c83e3e1457c6d74493/55811/Untitled18.png 501w&quot;
        sizes=&quot;(max-width: 501px) 100vw, 501px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
      /&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;ElastAlert는 Elastic의 Query Dsl을 활용하기 때문에 탐지 룰 개발이 크게 어렵지 않습니다.&lt;/p&gt;
&lt;p&gt;APT37 위협을 탐지하기 위해 개발한 1차 탐지룰의 개수는 총 10개이며, 각 룰은 &lt;a href=&quot;https://github.com/hyunjungg/Threat-Hunting/tree/APT37/APT37/Detection/ElastAlert&quot;&gt;여기&lt;/a&gt;서 확인하실 수 있습니다. 룰의 신빙성을 위해 룰 개발 시 참고한 문서의 링크를 각 룰 내에 기재해놓았습니다.&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Rule 파일명&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Rule의 파일명은 &lt;code class=&quot;language-text&quot;&gt;[TYPE]_[OS]_[ACIVITY]_[LEVEL]&lt;/code&gt; 과 같은 형식으로 구성되어있습니다.&lt;/p&gt;
&lt;p&gt;e.g) &lt;code class=&quot;language-text&quot;&gt;proc_creation_win_exploit_cve_2022_30190_HIGH&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;맨 마지막의 Level 값은 해당 룰의 위협 정도를 표기한 것이며 &lt;strong&gt;HIGH&lt;/strong&gt;, &lt;strong&gt;MEDIUM&lt;/strong&gt;, &lt;strong&gt;LOW&lt;/strong&gt; 세 가지로 나뉩니다.  (&lt;a href=&quot;https://github.com/SigmaHQ/sigma&quot;&gt;SigmaHQ&lt;/a&gt;를 참고하여 Level을 표기했습니다.)&lt;/p&gt;
&lt;p&gt;LEVEL 값은 추후 프로세스의 위협 정도를 판단하는 데에 사용되며 각각의 score는 10, 2, 1로 정했습니다.&lt;/p&gt;
&lt;p&gt;alert 발생 시 alert가 발생한 process 정보를 다음과 같은 파이썬 딕셔너리 구조체에 저장합니다.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;python&quot;&gt;&lt;pre class=&quot;language-python&quot;&gt;&lt;code class=&quot;language-python&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; 
	process_guid &lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
										&lt;span class=&quot;token string&quot;&gt;&quot;score&quot;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; score&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
											&lt;span class=&quot;token string&quot;&gt;&quot;tag&quot;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; tag
									&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
			
							&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
							&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;			 
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;이후 계속 alert가 발생할 때마다 Level에 해당하는 score값을 더하여 위협 가중치를 계산하는 식으로 분석시스템을 구성했습니다.&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Rule 내용&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;전체 룰에 대해 설명하면 내용이 너무 길어질 것 같아 10 개중 2개의 룰에 대해서만 소개합니다.&lt;/p&gt;
&lt;p&gt;참고로 아래 룰들을 이해하기 위해선 elastic query dsl에 대한 이해가 조금 필요합니다. 관련 부분은 &lt;a href=&quot;https://esbook.kimjmin.net/05-search&quot;&gt;이 문서&lt;/a&gt;에 정말 잘 설명이 되어있으니 참고해 주세요!&lt;/p&gt;
&lt;h3 id=&quot;1-detecting-cve202230190&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#1-detecting-cve202230190&quot; aria-label=&quot;1 detecting cve202230190 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;(1) Detecting CVE&lt;em&gt;2022&lt;/em&gt;30190&lt;/h3&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;yaml&quot;&gt;&lt;pre class=&quot;language-yaml&quot;&gt;&lt;code class=&quot;language-yaml&quot;&gt;&lt;span class=&quot;token key atrule&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; proc_creation_win_exploit_cve_2022_30190_HIGH
&lt;span class=&quot;token key atrule&quot;&gt;type&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; any
&lt;span class=&quot;token key atrule&quot;&gt;es_host&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; es&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;01&lt;/span&gt;
&lt;span class=&quot;token key atrule&quot;&gt;es_port&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;9200&lt;/span&gt;
&lt;span class=&quot;token key atrule&quot;&gt;index&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; winlogbeat&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;*
&lt;span class=&quot;token key atrule&quot;&gt;filter&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;token key atrule&quot;&gt;query&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
    &lt;span class=&quot;token key atrule&quot;&gt;bool&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
      &lt;span class=&quot;token key atrule&quot;&gt;filter&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
      &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;token key atrule&quot;&gt;match_phrase&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
          &lt;span class=&quot;token key atrule&quot;&gt;event_id&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;1&apos;&lt;/span&gt; &lt;span class=&quot;token comment&quot;&gt;# process create&lt;/span&gt;
      &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;token key atrule&quot;&gt;match_phrase&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
          &lt;span class=&quot;token key atrule&quot;&gt;parent_image_path&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; sdiagnhost.exe
      &lt;span class=&quot;token key atrule&quot;&gt;must_not&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
      &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;token key atrule&quot;&gt;bool&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
          &lt;span class=&quot;token key atrule&quot;&gt;should&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
          &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;token key atrule&quot;&gt;match_phrase&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
              &lt;span class=&quot;token key atrule&quot;&gt;image_path&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; conhost.exe
          &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;token key atrule&quot;&gt;match_phrase&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
              &lt;span class=&quot;token key atrule&quot;&gt;image_path&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; csc.exe
          &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;token key atrule&quot;&gt;match_phrase&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
              &lt;span class=&quot;token key atrule&quot;&gt;image_path&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; TiWorker.exe
          &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;token key atrule&quot;&gt;match_phrase&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
              &lt;span class=&quot;token key atrule&quot;&gt;image_path&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; MoUsoCoreWorker.exe
          &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;token key atrule&quot;&gt;match_phrase&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
              &lt;span class=&quot;token key atrule&quot;&gt;image_path&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; TrustedInstaller.exe
          &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;token key atrule&quot;&gt;match_phrase&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
              &lt;span class=&quot;token key atrule&quot;&gt;image_path&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; RtkAudioService64.exe
          &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;token key atrule&quot;&gt;match_phrase&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
              &lt;span class=&quot;token key atrule&quot;&gt;image_path&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; spoolsv.exe
          &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;token key atrule&quot;&gt;match_phrase&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
              &lt;span class=&quot;token key atrule&quot;&gt;image_path&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; WaaSMedicAgent.exe
          &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;token key atrule&quot;&gt;match_phrase&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
              &lt;span class=&quot;token key atrule&quot;&gt;image_path&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; sc.exe
          &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;token key atrule&quot;&gt;match_phrase&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
              &lt;span class=&quot;token key atrule&quot;&gt;image_path&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; net.exe
          &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;token key atrule&quot;&gt;match_phrase&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
              &lt;span class=&quot;token key atrule&quot;&gt;image_path&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; ipconfig.exe
          &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;token key atrule&quot;&gt;match_phrase&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
              &lt;span class=&quot;token key atrule&quot;&gt;image_path&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; netsh.exe
          &lt;span class=&quot;token key atrule&quot;&gt;minimum_should_match&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;

&lt;span class=&quot;token key atrule&quot;&gt;alert&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;debug&quot;&lt;/span&gt;

&lt;span class=&quot;token comment&quot;&gt;## Ref : https://conscia.com/blog/vulnerability-spotlight-how-to-detect-follina-the-windows-msdt-0-day/&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;CVE&lt;em&gt;2022&lt;/em&gt;30190을 사용하여 공격을 수행하는 경우, sdiagnhost.exe 프로세스에서 악성 페이로드가 실행됩니다.&lt;/p&gt;
&lt;p&gt;하지만 sdiagnhost.exe는 Windows 시스템에서 문제 해결을 위해 자주 실행되는 프로세스이기 때문에, sdiagnhost.exe 프로세스가 실행되는 모든 경우를 탐지해버리면 오탐이 빈번히 발생하게 됩니다.&lt;/p&gt;
&lt;p&gt;따라서 정상적으로 sdiagnhost.exe가 동작하는 경우 실행되는 자식 프로세스를 화이트리스트로 지정해 줍니다. &lt;/p&gt;
&lt;p&gt;이 룰이 탐지된 경우에는 의심에 여지가 없이, 해당 행위가 발생한 프로세스는 malicious하다고 판단할 수 있으므로 Rule Level을 HIGH로 설정 해 주었습니다.&lt;/p&gt;
&lt;h3 id=&quot;2-detecting-dll-side-loading&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#2-detecting-dll-side-loading&quot; aria-label=&quot;2 detecting dll side loading permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;(2) Detecting DLL Side Loading&lt;/h3&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;yaml&quot;&gt;&lt;pre class=&quot;language-yaml&quot;&gt;&lt;code class=&quot;language-yaml&quot;&gt;&lt;span class=&quot;token key atrule&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; image_load_side_load_from_non_system_location_HIGH
&lt;span class=&quot;token key atrule&quot;&gt;type&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; any
&lt;span class=&quot;token key atrule&quot;&gt;es_host&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; es&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;01&lt;/span&gt;
&lt;span class=&quot;token key atrule&quot;&gt;es_port&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;9200&lt;/span&gt;
&lt;span class=&quot;token key atrule&quot;&gt;index&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; winlogbeat&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;*
&lt;span class=&quot;token key atrule&quot;&gt;filter&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;token key atrule&quot;&gt;query&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
    &lt;span class=&quot;token key atrule&quot;&gt;bool&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
      &lt;span class=&quot;token key atrule&quot;&gt;filter&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
      &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;token key atrule&quot;&gt;match_phrase&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
          &lt;span class=&quot;token key atrule&quot;&gt;event_id&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;7&apos;&lt;/span&gt; &lt;span class=&quot;token comment&quot;&gt;# DLL Load&lt;/span&gt;
      &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;token key atrule&quot;&gt;bool&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
          &lt;span class=&quot;token key atrule&quot;&gt;should&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
          &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;token key atrule&quot;&gt;match_phrase&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
              &lt;span class=&quot;token key atrule&quot;&gt;image_loaded&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; shfolder.dll
          &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;token key atrule&quot;&gt;match_phrase&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
              &lt;span class=&quot;token key atrule&quot;&gt;image_loaded&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; userenv.dll
          &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;token key atrule&quot;&gt;match_phrase&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
              &lt;span class=&quot;token key atrule&quot;&gt;image_loaded&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; atl.dll
          &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;token key atrule&quot;&gt;match_phrase&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
              &lt;span class=&quot;token key atrule&quot;&gt;image_loaded&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; audioses.dll
          &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;token key atrule&quot;&gt;match_phrase&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
              &lt;span class=&quot;token key atrule&quot;&gt;image_loaded&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; authz.dll
          &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;token key atrule&quot;&gt;match_phrase&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
              &lt;span class=&quot;token key atrule&quot;&gt;image_loaded&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; avrt.dll
          &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;token key atrule&quot;&gt;match_phrase&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
              &lt;span class=&quot;token key atrule&quot;&gt;image_loaded&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; authfwcfg.dll
          &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;token key atrule&quot;&gt;match_phrase&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
              &lt;span class=&quot;token key atrule&quot;&gt;image_loaded&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; adsldpc.dll
          &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;token key atrule&quot;&gt;match_phrase&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
              &lt;span class=&quot;token key atrule&quot;&gt;image_loaded&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; bcd.dll
          &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;token key atrule&quot;&gt;match_phrase&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
              &lt;span class=&quot;token key atrule&quot;&gt;image_loaded&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; cldapi.dll
          &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;token key atrule&quot;&gt;match_phrase&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
              &lt;span class=&quot;token key atrule&quot;&gt;image_loaded&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; clipc.dll
          &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;token key atrule&quot;&gt;match_phrase&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
              &lt;span class=&quot;token key atrule&quot;&gt;image_loaded&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; colouri.dll
          &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;token key atrule&quot;&gt;match_phrase&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
              &lt;span class=&quot;token key atrule&quot;&gt;image_loaded&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; connect.dll
          &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;token key atrule&quot;&gt;match_phrase&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
              &lt;span class=&quot;token key atrule&quot;&gt;image_loaded&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; cscobj.dll
          &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;token key atrule&quot;&gt;match_phrase&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
              &lt;span class=&quot;token key atrule&quot;&gt;image_loaded&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; d2d1.dll
          &lt;span class=&quot;token key atrule&quot;&gt;minimum_should_match&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;
      &lt;span class=&quot;token key atrule&quot;&gt;must_not&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
      &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;token key atrule&quot;&gt;bool&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
          &lt;span class=&quot;token key atrule&quot;&gt;should&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
          &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;token key atrule&quot;&gt;match_phrase&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
              &lt;span class=&quot;token key atrule&quot;&gt;image_loaded&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; C&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;\Program Files\WindowsApps\DellInc.DellSupportAssistforPCs
          &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;token key atrule&quot;&gt;match_phrase&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
              &lt;span class=&quot;token key atrule&quot;&gt;image_loaded&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; C&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;\Program Files\Common Files\microsoft shared\ClickToRun\AppVPolicy.dll
          &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;token key atrule&quot;&gt;match_phrase&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
              &lt;span class=&quot;token key atrule&quot;&gt;image_loaded&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; C&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;\Windows\System32\
          &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;token key atrule&quot;&gt;match_phrase&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
              &lt;span class=&quot;token key atrule&quot;&gt;image_loaded&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; C&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;\Windows\SysWOW64\
          &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;token key atrule&quot;&gt;match_phrase&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
              &lt;span class=&quot;token key atrule&quot;&gt;image_loaded&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; C&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;\Windows\WinSxS\
          &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;token key atrule&quot;&gt;match_phrase&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
              &lt;span class=&quot;token key atrule&quot;&gt;image_loaded&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; C&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;\Windows\SoftwareDistribution\
          &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;token key atrule&quot;&gt;match_phrase&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
              &lt;span class=&quot;token key atrule&quot;&gt;image_loaded&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; C&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;\Windows\SystemTemp\
          &lt;span class=&quot;token key atrule&quot;&gt;minimum_should_match&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;

&lt;span class=&quot;token key atrule&quot;&gt;alert&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;debug&quot;&lt;/span&gt;

&lt;span class=&quot;token comment&quot;&gt;## Ref : https://github.com/SigmaHQ/sigma/blob/master/rules/windows/image_load/image_load_side_load_from_non_system_location.yml&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Windows 기본 프로그램에서 DLL Hijacking에 자주 사용되는 dll목록들을 blacklist에 넣어줍니다. 이때 dll이 &lt;code class=&quot;language-text&quot;&gt;must_not&lt;/code&gt; 부분에 명시된 경로들이 아닌 경우에만 탐지합니다.&lt;/p&gt;
&lt;p&gt;해당 경로들은 Windows에서 보호되고 있는 디렉토리이기 때문에 접근이 제한됩니다. 따라서 보통  위 디렉토리에 있는 프로세스를 다른 폴더로 복사한 후 DLL Hijacking 기법을 수행합니다.&lt;/p&gt;
&lt;p&gt;이 룰도 이전 룰과 마찬가지로 탐지가 되었을 시 해당 행위가 발생한 프로세스는 malicious하다고 판단할 수 있으므로 Rule Level을 HIGH로 설정해 주었습니다.&lt;/p&gt;
&lt;h2 id=&quot;c-2차-분석탐지&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#c-2%EC%B0%A8-%EB%B6%84%EC%84%9D%ED%83%90%EC%A7%80&quot; aria-label=&quot;c 2차 분석탐지 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;C. 2차 분석/탐지&lt;/h2&gt;
&lt;p&gt;앞서 말씀드렸듯이 ElastAlert는 단일 이벤트에 대한 탐지만 가능합니다.&lt;/p&gt;
&lt;p&gt;따라서 파이썬 ES DSL 라이브러리를 사용하여 직접 다른 이벤트와의 연관 분석이 추가로 이루어져야 합니다. &lt;/p&gt;
&lt;p&gt;이 파트에서는 이러한 추가 탐지와, 추가 탐지 후 malicious한 프로세스들을 식별하여 프로세스 트리 형태로 시각화합니다.  결과는 Jupyter Notebook을 통해 보여줍니다.&lt;/p&gt;
&lt;p&gt;모든 코드는 &lt;a href=&quot;https://github.com/hyunjungg/Threat-Hunting/blob/APT37/APT37/Detection/Analyzer/Analyzer.ipynb&quot;&gt;여기&lt;/a&gt;에 작성해 놓았으며, 이해를 위해서는 해당 문서를 함께 보는 것이 좋을 것 같습니다. 문서를 기준으로 순서대로 각 Step을 설명하겠습니다. &lt;/p&gt;
&lt;h3 id=&quot;1-set-up-analyzing&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#1-set-up-analyzing&quot; aria-label=&quot;1 set up analyzing permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;(1) Set up Analyzing&lt;/h3&gt;
&lt;p&gt;분석을 위해 필요한 설정과 함수들을 구성합니다. ES 인덱스 정보나 시뮬레이션 시간 범위 등을 정의하는 부분입니다.&lt;/p&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 608px; &quot;
    &gt;
      &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 47%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAJCAYAAAAywQxIAAAACXBIWXMAABcRAAAXEQHKJvM/AAABxElEQVQoz31S2W6jQBDk/7/ILytfWjvaJHixDUE22OCLwwxgbuJkKgVKtMnLIpW6h5kpVdW0MlVV+bjd4kHX5XrvQN1a0Hc2tq6LmWHgdD4jFgIiSSDiGIJ9FEV9/UIYhrKuawwGA6lMJhNo2lLO5jMsVA1ZmCMlcazruD4/I9lsUN1uqEhYpSkaXmzb9geqqgI/OR6PoZiGIZ3dDpfTSa6WGvK0QJNkKFwHxfGE8nhE5nlIeOZ2OKDM857gO/I8lx3jcDiUiskLFx6KyxJRUcAVEYI8g017lyyDQ2V506B9e0N9v6Omoprrvn6ipOpPQii/5nP8Wa/xSHWm7cA6eHANHfZyiaNpwtI0CNtGSoWp4/ToFKf8l1hWj4hZ4/0do9EIypHhF1RyDQNkaYa39o4mTdAw7JroakW1xfWKgn3BvqTqrs/DsEfKh+sVdoQPpimXtO0KIR1uGsxp4/k4kGAfBNj4Prr9rtaMpmQ0veVvtmn5X4a/ZzOofxdS+DfEHJlAVXFlBBEtR6sVYr5ywHXYWX966tW2r69oSPiFH688nU6ktdlDnEN5XqjwmZv38gKPY+N3ZMwo4Jz2a/bdPP5vDj8AtAiYz2G6yzoAAAAASUVORK5CYII=&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;Untitled&quot;
        title=&quot;Untitled&quot;
        src=&quot;/static/59a7052a254042a8fb74a5dd9b6a0d19/18872/Untitled19.png&quot;
        srcset=&quot;/static/59a7052a254042a8fb74a5dd9b6a0d19/5a46d/Untitled19.png 300w,
/static/59a7052a254042a8fb74a5dd9b6a0d19/0a47e/Untitled19.png 600w,
/static/59a7052a254042a8fb74a5dd9b6a0d19/18872/Untitled19.png 608w&quot;
        sizes=&quot;(max-width: 608px) 100vw, 608px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
      /&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;h3 id=&quot;2-analyze-processes-with-rules&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#2-analyze-processes-with-rules&quot; aria-label=&quot;2 analyze processes with rules permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;(2) Analyze processes with rules&lt;/h3&gt;
&lt;p&gt;ElastAlert에 의해 1차 탐지된 프로세스들을 대상으로 2차 분석합니다. 단일 이벤트로는 분석이 불가능한 룰들을 작성합니다. 예를 들어 하나의 프로세스에서 네트워크 이벤트와 파일 이벤트의 수가 특정 threshold를 넘은 경우, 정보 탈취 행위로 간주할 수 있습니다.&lt;/p&gt;
&lt;p&gt;하지만 파일 업로드 프로그램 같은 경우에는 이런 룰이 오탐이 될 수 있기 때문에, Level을 HIGH가 아닌 MEDIUM이나 LOW로 설정해 주어야 합니다.&lt;/p&gt;
&lt;h3 id=&quot;3-find-processes-related-to-malicious-process&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#3-find-processes-related-to-malicious-process&quot; aria-label=&quot;3 find processes related to malicious process permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;(3) Find processes related to malicious process&lt;/h3&gt;
&lt;p&gt;ElastAlert에 의해 탐지된 모든 프로세스들을 대상으로 프로세스 트리를 생성합니다.  트리의 시작은 탐지된 프로세스가 아닌, 프로세스 트리의 ROOT가 될 수 있는 프로세스( e.g explorer.exe , svchost.exe)입니다. ROOT가 될 수 있는 프로세스들까지 트리에 포함 시킨 이유는 침입 경로 확인을 위한 분석에 도움이 되기 때문입니다.&lt;/p&gt;
&lt;p&gt;Windows System에는 정말 많은 svchost.exe 가 존재하기 때문에, ROOT 프로세스를 좀 더 명확히 구분하기 위한 Root_Handler 함수를 구현했습니다.&lt;/p&gt;
&lt;p&gt;이 함수에는 svchost.exe의 command line을 확인하여, svchost.exe 역할을 분류합니다.&lt;/p&gt;
&lt;p&gt;svchost.exe의 commandline에 대해서 좀 더 자세히 설명하겠습니다.&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;svchost.exe&lt;/p&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 1011px; &quot;
    &gt;
      &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 30%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAGCAYAAADDl76dAAAACXBIWXMAABcRAAAXEQHKJvM/AAABRklEQVQY0z1Ra1eCQBDl//+QOpnvBMXMPGVffEQmICCSIKDh65zUvrm3mbX6cM/s3p25M3dWyfUMUTBNlH1fdE8nVH0fV8NXXBsGbkYjim/IvY9R8jzkTQvFiYOH9YawxuNuB655Ph4vOBygaNMArdVKtLc7DAF0KKm+iAkLNOIYjSSBni4vIlmGerRAc7mSghxfTt8YUB3XGgSlMnZFxXVRC0PBDyzCk9xapowFy6apJrgLAtSCj3+OkRuNJa+nKcquh6evAws6qM1mqCep7MSPfyJlsllyXFSmPjSamCdnjovZep7ymNfjhPgp2tstFNWb4X5JljYbKdimqIUR1DBE49e6Ts1aZLf1mcl7k/JZnHnO7+z3cgUDadnyUKWuahRJokkTcveiQ7BteS7xSuZzqPMQBXsCjfbYpU/onc/oC3EBnwk/bYejcznBVH8AAAAASUVORK5CYII=&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;Untitled&quot;
        title=&quot;Untitled&quot;
        src=&quot;/static/8c34869fdb6382961e72aa367ab61ccf/6bfd0/Untitled20.png&quot;
        srcset=&quot;/static/8c34869fdb6382961e72aa367ab61ccf/5a46d/Untitled20.png 300w,
/static/8c34869fdb6382961e72aa367ab61ccf/0a47e/Untitled20.png 600w,
/static/8c34869fdb6382961e72aa367ab61ccf/6bfd0/Untitled20.png 1011w&quot;
        sizes=&quot;(max-width: 1011px) 100vw, 1011px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
      /&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;svchost.exe는 위 이미지에 나와 있는 것 처럼 다양한 플래그들과 함께 실행됩니다. 플래그 값의 의미는 다음과 같습니다.&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;K&lt;/code&gt; : &lt;code class=&quot;language-text&quot;&gt;KEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows NT\CurrentVersion\Svchost&lt;/code&gt; 키에 요청이 보내짐.  해당 레지스트리 value는 관련 서비스 정보를 string type으로 포함하고 있음. 해당 value 값들을 토대로 &lt;code class=&quot;language-text&quot;&gt;HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Services\[Service Name]&lt;/code&gt; 에서 관련 서비스를 찾아서 로드 시킴.&lt;/li&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;S&lt;/code&gt; : 위의 K옵션으로 지정된 서비스 그룹에서 하나의 서비스만 지정.&lt;/li&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;P&lt;/code&gt; : 정책 관련.&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;위 설명에 따라, 제가 작성한 분석로직에서 parent process의 commandline이 &lt;code class=&quot;language-text&quot;&gt;svchost.exe -k netsvcs -p -s Schedule&lt;/code&gt; 의 경우 Windows 스케줄러에 의해 실행된 프로세스로 정의했습니다.&lt;/p&gt;
&lt;h3 id=&quot;4-visualize&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#4-visualize&quot; aria-label=&quot;4 visualize permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;(4) Visualize&lt;/h3&gt;
&lt;p&gt;마지막 시각화 단계로 프로세스 정보를 트리화해서 보여줍니다. score 점수에 따라 프로세스 노드 색상을 구분했습니다.  노드의 색상은 기본적으로 Red 계열인데, score점수가 높을 수록 색의 명도가 높아집니다.&lt;/p&gt;
&lt;p&gt;ROOT 프로세스 노드들은 노란색으로 별도 표시했습니다.&lt;/p&gt;
&lt;p&gt;공격자들이 WMI, DLL Load, Windows Scheduler 와 같은 기능을 활용하여 공격을 수행하게 되면 위협 행위를 수행하는 프로세스들의 트리가 끊어지는 경우가 많기 때문에, 분석에 용이하도록 ROOT프로세스들을 별도로 표기합니다.&lt;/p&gt;
&lt;p&gt;이렇게 시각화 과정까지 거치면 시스템에서 실행된 프로세스 중, 위협과 관련 있는 프로세스를 식별할 수 있습니다.&lt;/p&gt;
&lt;p&gt;시각화 결과는 다음과 같습니다. &lt;/p&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 848px; &quot;
    &gt;
      &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 86.33333333333334%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAARCAYAAADdRIy+AAAACXBIWXMAABcRAAAXEQHKJvM/AAACYElEQVQ4y31Uy5LaMBDkJ/en9iNy2V/IJbkkl62tgq2CJJtssDcEYwN+4Yf8lrE6MwITTCAqpmSsUaune+SR53lKSom6aVTTNGjqGnK9hqwqfoea/vfRSFoHUFN+VZaoKOcyRkmSoJOtqkWOkja5lgXr7g7W4yOKtoXkQyhkK1FkGbL3H1BvXdwaIz8IVOwGcF4MZZomwiDAajyG6ziaYVEUKPIcBTFK4hj+x09Yff9x2K0U/YahGZ6PnFj4ux0834cQ4ioLud9rcAY44Kq/DHvA7uyloFJ5uK6rQTM6JM9y7KsGLenHg2VI0xSq606gQ4a0UNEUPz3Bvb9HTMkxsYiiCAHJ8GU6w+bFxJthYrvdIicpfplvWH81EIUh1FGCAWDJpUynEA8P8CiJ9fM9Hxlp2BLrTGQDNlrDpiWW6grgjdHRQXmcosoLpBeaamBcmBJRWW0jIUWhe00vENPuqE1MB1rf5rBeTSxXls4pyfE95VxtG9YnCkJ4rwuY87ku8+Q4lar7lMC5hRioB2SjgjCA/duCsD0INuiyZCZVlpU2gh1mwJPzVG57dP/UPuT4zg8gtqFeHwBqYRVfp4zcTTQDTupBWb++zJMp10rmBj2c1sFevINjfR4kMJC9srUkoevpdjkH/eemCJGebee26MtSAy3rJENNl78v+xbLEWml2AgqXeVFTaXmCKkHeSPfBNaTtSoJjBudDenb6VqMDMPAZrNRPM/nP+E4NhaLBZbLJSz68jAga8fuMiDP/xujyWSipnQ7xuOxen5+BgcDzmYzfqefffpQsOv9zFfvVvwBIYAc0z/mxCcAAAAASUVORK5CYII=&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;Untitled&quot;
        title=&quot;Untitled&quot;
        src=&quot;/static/0b032f1a3ca00dcc0279b683cbd62c21/d52e5/Untitled21.png&quot;
        srcset=&quot;/static/0b032f1a3ca00dcc0279b683cbd62c21/5a46d/Untitled21.png 300w,
/static/0b032f1a3ca00dcc0279b683cbd62c21/0a47e/Untitled21.png 600w,
/static/0b032f1a3ca00dcc0279b683cbd62c21/d52e5/Untitled21.png 848w&quot;
        sizes=&quot;(max-width: 848px) 100vw, 848px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
      /&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 804px; &quot;
    &gt;
      &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 83%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAARCAYAAADdRIy+AAAACXBIWXMAABcRAAAXEQHKJvM/AAAB2ElEQVQ4y5VU226jQAzlu/sb27c+b9X/6GtbqRspTWnSGyER4RIGCAzXs/aUIUBIq1qyYOyxfXxsMLbbbeMGAbaXl41zewsvjrH3fQRkO6f7/R6hCBFGAmEYDnxGkedIpGyCiwu8XF8jx8/SkFZZjlwcUFXVwGekadroe0VdqypFUShDTeemaTrlM0smJV7+zbEz3yGiSFXQd4w0y7pglqpNmrX2fsIvf6Vaztui+o5+EkIdWHcOFuYm4uq9AEbe76Bf6IgwTc9yxb6IhqSTMTLdyThRj0OJuvJRFh7KslatciLWnAZmbzbYzJd4fTKR5XI4nDFCThgnJRzrBh/Lv7QKEodDQnpAkiQqueM4cD83iIIQPq0T08D2Pqo+z+1QSjqcLgyvhBBiYOPWuZjmWEp5sjZtlWELzBUj0ns25qrjlRKvnp4RLK2vxT5OuQ1oSR9Pc6o9VZiecSgQu4Hi/TjlXpDmaTzNqUGMpUtYErI6TiDuH+G77gmaqZ2butMl9AmVffcA588VPt/eEBPxUwHn+OwQ8q79RqZQDxBalgXP80C/MazXazi7neKQ7bZtqxVhP7/z1H8SY7FYYLVaYTabwTRNPNOZ3zkh27lIzP9I+uz03n2n/wG5gitiIOK0hwAAAABJRU5ErkJggg==&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;Untitled&quot;
        title=&quot;Untitled&quot;
        src=&quot;/static/ebdc2686d7a25810d7528f2369a8d032/27b7a/Untitled23.png&quot;
        srcset=&quot;/static/ebdc2686d7a25810d7528f2369a8d032/5a46d/Untitled23.png 300w,
/static/ebdc2686d7a25810d7528f2369a8d032/0a47e/Untitled23.png 600w,
/static/ebdc2686d7a25810d7528f2369a8d032/27b7a/Untitled23.png 804w&quot;
        sizes=&quot;(max-width: 804px) 100vw, 804px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
      /&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 834px; &quot;
    &gt;
      &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 82.33333333333334%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAQCAYAAAAWGF8bAAAACXBIWXMAABcRAAAXEQHKJvM/AAABNUlEQVQ4y52UTW6EMAyFOfjcoqeYU8wNkLoAFl1QEBW/KTAFJqQhbkwHGlLCpLVkBSH78/OLwKmqSowjA0qpuN0oDMPw5+z7XsgA13WFMwwMmvpVRC9PcL2+w38CYXj4vg9O1/WCcznpIxCElIBqlyLb5JzPRM/zhAR2m0lN0+AK+vS1eS+maYI7EFagEHwtwHcIVmH6AAug2KgYxxHqup5PXaGu1gjca0Slui16nZVCVQF6iuClUa87VGhSwRgzWvAQeDSgbdtfFlgB91YzWcAZswPaWPB5h2H4pks5SnUAKnwrCijOZ5jCEJ6/P73HCo3KJbChFMjpBN3lAm4Q/ABxmpqL2eqzeqqXsVk5z3MghEAcx5BlGSRJAlEUzb+lNE0hlKugV1hXliXI392c2IO1+qV8AeZc4mxVdGOKAAAAAElFTkSuQmCC&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;Untitled&quot;
        title=&quot;Untitled&quot;
        src=&quot;/static/ef63299d2770d91c578627ce1fc6b8fc/5d72a/Untitled24.png&quot;
        srcset=&quot;/static/ef63299d2770d91c578627ce1fc6b8fc/5a46d/Untitled24.png 300w,
/static/ef63299d2770d91c578627ce1fc6b8fc/0a47e/Untitled24.png 600w,
/static/ef63299d2770d91c578627ce1fc6b8fc/5d72a/Untitled24.png 834w&quot;
        sizes=&quot;(max-width: 834px) 100vw, 834px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
      /&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 876px; &quot;
    &gt;
      &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 74.33333333333333%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAPCAYAAADkmO9VAAAACXBIWXMAABcRAAAXEQHKJvM/AAABVElEQVQ4y6VUyW6DMBDlt/M7OfdLesihEnAo4CA1TYCUfV9mOkNw6hBQqWrxZDweP7/nTQuCEMKrjb73BmlaYJalhGw70hSTJIGmaVDXddDqBjD+eoXT8QX/WcB1XdTKsgRulWUFVVXdegA2YSxdxxgbQgjQJMkwDBjHMdXwQPokQ8YJObVPux1+7vdj31EIvBNy4XVIaU3kQLVeiuV1jeHhgN35jJPCH0KZxIRMPCeYk9VERptxi00TLhJK608WlRyeUOYA5Q99v0woB3Asz/NFmx1tApOpcRaxqlDWbIcHz9VHUXQnUOOrCmVSTzbm1pmsn+xtUjhXSWcUZT+Tt2276OZXhRIdqblefIy8AIuyWD1Oc0KYEuDhvNHnBwF+vAu8WC79+6PdpYmH6TaoNwXWbP/5LjOrbdtIAMMw0HEc9DwPTdNEy7LG3ebDzlh7cdTX5hs77JLava/z1QAAAABJRU5ErkJggg==&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;Untitled&quot;
        title=&quot;Untitled&quot;
        src=&quot;/static/d21fb4626fad10a18b350a2b7ce734d8/1b1d5/Untitled25.png&quot;
        srcset=&quot;/static/d21fb4626fad10a18b350a2b7ce734d8/5a46d/Untitled25.png 300w,
/static/d21fb4626fad10a18b350a2b7ce734d8/0a47e/Untitled25.png 600w,
/static/d21fb4626fad10a18b350a2b7ce734d8/1b1d5/Untitled25.png 876w&quot;
        sizes=&quot;(max-width: 876px) 100vw, 876px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
      /&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;아무래도 제가 프론트엔드를 배워서 직접 출력해 줘야 할 것 같습니다. ㅎㅎ 라이브러리로는 한계가 있네요.&lt;/p&gt;
&lt;p&gt;사실 제 목표는 아래처럼 모든 위협 정보를 직관적으로 이해할 수 있게 표현해 주는 것입니다…&lt;/p&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 1200px; &quot;
    &gt;
      &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 43.66666666666667%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAJCAYAAAAywQxIAAAACXBIWXMAAAsTAAALEwEAmpwYAAABkklEQVQoz3WRXU8TQRSG96dKUBMvvBLFBK1iE3+CcdcS4dd4C1EXWwnUUiqWBezuzH7OzOOZbk3XBCd58p7MOXnnnZngce+Aja2IB9sDNp9GbD7b4/72Hg+ff1yq7917EgrRirCjaza2Qh7t7BNkw3e4SYQZv8eK2kmIO49g+kEYwMWg1b/1fzCTAc04JCjiPtW3Ps2oj/n+RnRNGfcov76kHu4uUfEuOn4l+pryuIf+8oLsaIf0c48sfrskcIDHdjCu1bqGPIeyBC1Ustes8P1S5sYzwzCBHwomQuCctLvYGlvlOFHqgkrqQqWo9Lbdc2Y9i+F0OOVwlHB6pZncFAT4hM61+NrK2U2zzO2amqIoJWWO1jnW91bz1rllfRLP+XSoOUssF6klUFqjMkWeZZIiRS8WKMHWPmktCSsxLVBK/WPoVobzy4STX5kYFoxvaoLGGIxgV2okXSmPpuUQtdBy6xw/41PeZfhzOudoNOP4/FpMy/bKdy1v0uSSPrmi8r/TfZqO4eUsEbPfnF1XTBeWP39KjE9msPwEAAAAAElFTkSuQmCC&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;Untitled&quot;
        title=&quot;Untitled&quot;
        src=&quot;/static/cee6505f3995ac1fe2d40aeed6e84f8a/c1b63/Untitled26.png&quot;
        srcset=&quot;/static/cee6505f3995ac1fe2d40aeed6e84f8a/5a46d/Untitled26.png 300w,
/static/cee6505f3995ac1fe2d40aeed6e84f8a/0a47e/Untitled26.png 600w,
/static/cee6505f3995ac1fe2d40aeed6e84f8a/c1b63/Untitled26.png 1200w,
/static/cee6505f3995ac1fe2d40aeed6e84f8a/d61c2/Untitled26.png 1800w,
/static/cee6505f3995ac1fe2d40aeed6e84f8a/75d38/Untitled26.png 1851w&quot;
        sizes=&quot;(max-width: 1200px) 100vw, 1200px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
      /&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;갈 길이 너무 많이 남았지만… 열심히 공부해서 목표를 이루겠습니다 ..&lt;/p&gt;
&lt;p&gt;오늘은 APT37 행위를 모사하여 직접 시뮬레이션을 하고, 위협을 탐지하는 방법에 대해서 포스팅을 해봤습니다. 내용이 너무 방대하다 보니 제대로 설명되지 않은 부분이 있는 것 같네여..  부족한 부분에 대해 피드백해 주시면 감사하겠습니다.&lt;/p&gt;
&lt;h1 id=&quot;4-참고&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#4-%EC%B0%B8%EA%B3%A0&quot; aria-label=&quot;4 참고 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;4. 참고&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;https://www.notion.so/TTPs-9-f04ce99784874947978bd2947738ac92&quot;&gt;KISA TTPS Report&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://securelist.com/scarcruft-surveilling-north-korean-defectors-and-human-rights-activists/105074/&quot;&gt;Kaspersky&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://asec.ahnlab.com/ko/47622/&quot;&gt;Anlab&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://github.dev/SigmaHQ/sigma/tree/master/rules/windows/network_connection&quot;&gt;SigmaHQ&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;</content:encoded></item><item><title><![CDATA[Detecting Format String Bugs with Libdft64]]></title><description><![CDATA[본 글에서는 DTA라이브러리인 LIBDFT64를 사용하는 방법을 간단한 예제와 함께 설명합니다.  TOC 1. LIBDFT64? 2. DTA? A. DTA란 무엇인가? B. 퍼징과 다른 점? C. DTA의 세 가지 요소 D. Taint Policy E…]]></description><link>https://hyunjungg.github.io/binary_analysis/Detecting_FSB_with_DTA/</link><guid isPermaLink="false">https://hyunjungg.github.io/binary_analysis/Detecting_FSB_with_DTA/</guid><pubDate>Sun, 05 Mar 2023 16:58:13 GMT</pubDate><content:encoded>&lt;p&gt;본 글에서는 DTA라이브러리인 LIBDFT64를 사용하는 방법을 간단한 예제와 함께 설명합니다. &lt;/p&gt;
&lt;h3 id=&quot;toc&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#toc&quot; aria-label=&quot;toc permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;[TOC]&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;#1-libdft64-&quot;&gt;1. LIBDFT64?&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;a href=&quot;#2-dta-&quot;&gt;2. DTA?&lt;/a&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;#a-dta-------&quot;&gt;A. DTA란 무엇인가?&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#b----------&quot;&gt;B. 퍼징과 다른 점?&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#c-dta---------&quot;&gt;C. DTA의 세 가지 요소&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#d-taint-policy&quot;&gt;D. Taint Policy&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#e---&quot;&gt;E. 한계..&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;a href=&quot;#3-libdft64-----------&quot;&gt;3. LIBDFT64 설치 및 사용 방법&lt;/a&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;#a---&quot;&gt;A. 설치&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#b-libdft64------&quot;&gt;B. LIBDFT64 내부 구조&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#c-libdft64-api&quot;&gt;C. LIBDFT64 API&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#d------&quot;&gt;D. 빌드 방법&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;a href=&quot;#4-libdft64--format-string-bug---&quot;&gt;4. LIBDFT64로 Format String Bug 탐지&lt;/a&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;#a-format-string-bug------&quot;&gt;A. Format String Bug 탐지 방안&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#b-----------------------&quot;&gt;B. 테스트 대상 프로그램 빌드 시 유의 사항&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#c-dta-----&quot;&gt;C. DTA 툴 작성&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#d---&quot;&gt;D. 결과&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#5---&quot;&gt;5. 참고&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;h1 id=&quot;1-libdft64&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#1-libdft64&quot; aria-label=&quot;1 libdft64 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;1. LIBDFT64?&lt;/h1&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 497px; &quot;
    &gt;
      &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 51%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAYAAAC0VX7mAAAACXBIWXMAAAsTAAALEwEAmpwYAAABr0lEQVQoz5VRTU/bQBTcP98LP4ELogckKqpyqEAgxKGHViQpiJBA4ny5QFI7ru2s19jr/fCwuw4RqEJVLY1m3vN69r0xwX88dV1vuJE1tNZGa8e2JmVZ4rrbw3TmYzSeYDyZonvTx+N84fTQG7l+xtgrs8aY5hzbpz6OOwvHeSlAWJ7jdjDEZDpDq/PTGXR7fTw8zuGNxvDWlwgp/zJcxAW2Dif41g2w9WWMiJYgQRBib/8AX49OsPNxz+lPnw8x8+//uTorOHbOfHw4GGH33EfBK5CqqrD4HeDX/QPCZYQgDB1sFDYopZSDXk/WZNZkWBstBcc8YlCGbU2EEIiiGOmKYkUpknQFSjPEcWqMl4iT1L23oBlz/T9xgqoSzbSbqRsQabKxBtYwMR9bQ5trmlLXe2fnN3lqXW9eESUkmDGE++1wnJmaF2ZlczAzpqm5SJqJLLu+NVJ6A1tn7AlFyUGsN1MC1GSQawllay0Ql0/QTkuEjLrVEl6AyurtsGsuuIJUduW2B9nxUP64RfG9D9EaQK3rF11dDODOtYfgF3cQhl+gWx6W7R4ury5xZfAM3hP2w8ntdsQAAAAASUVORK5CYII=&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;[https://github.com/AngoraFuzzer/libdft64](https://github.com/AngoraFuzzer/libdft64)&quot;
        title=&quot;[https://github.com/AngoraFuzzer/libdft64](https://github.com/AngoraFuzzer/libdft64)&quot;
        src=&quot;/static/ef778d9dd1ecac1886175fc3646d10c5/15d25/Untitled.png&quot;
        srcset=&quot;/static/ef778d9dd1ecac1886175fc3646d10c5/5a46d/Untitled.png 300w,
/static/ef778d9dd1ecac1886175fc3646d10c5/15d25/Untitled.png 497w&quot;
        sizes=&quot;(max-width: 497px) 100vw, 497px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
      /&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;기존에 많이 알려져 있는 &lt;a href=&quot;https://www.cs.columbia.edu/~vpk/research/libdft/&quot;&gt;libdft&lt;/a&gt;는 32비트 바이너리만 지원하는데, 리서치 도중 64비트 호환이 가능하게 &lt;a href=&quot;https://github.com/AngoraFuzzer/libdft64&quot;&gt;libdft64&lt;/a&gt; 프로젝트를 진행해 주신 분이 계셔서 사용해 보았습니다.!&lt;/p&gt;
&lt;p&gt;Libdft는 인텔의 Pin을 기반으로 작성된 DTA 라이브러리 입니다. 현재 알려진 DTA 라이브러리 중 가장 많이 사용되고 있습니다.&lt;/p&gt;
&lt;p&gt;MMX나 SSE와 같은 확장 명령어는 지원하고 있지 않으므로, 분석 대상 프로그램 컴파일 시 해당 명령어들이 포함되지 않게 해주셔야 합니다.! gcc 의 경우 &lt;code class=&quot;language-text&quot;&gt;-mno-{mmx, sse, sse2, sse3}&lt;/code&gt; 를 추가해주시면 됩니당.&lt;/p&gt;
&lt;h1 id=&quot;2-dta&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#2-dta&quot; aria-label=&quot;2 dta permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;2. DTA?&lt;/h1&gt;
&lt;h2 id=&quot;a-dta란-무엇인가&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#a-dta%EB%9E%80-%EB%AC%B4%EC%97%87%EC%9D%B8%EA%B0%80&quot; aria-label=&quot;a dta란 무엇인가 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;A. DTA란 무엇인가?&lt;/h2&gt;
&lt;p&gt;DTA (Dynamic Taint Analysis)는 프로그램에서 사용자 입력 값으로 인해 어떤 레지스터와 메모리 영역이 제어 가능한지 확인하는 기법입니다. &lt;/p&gt;
&lt;p&gt;런타임 정보를 사용하므로 STA(정적 오염 분석) 보다 결과의 신뢰도가 높습니다.
또한 정적 분석은 컴파일 시점에 오염 분석 기능을 삽입하기 때문에 소스코드가 제공되는 경우에만 가능합니다. 이에 반해 DTA는 빌드 된 바이너리에 분석 기능 삽입이 가능합니다.  (&lt;a href=&quot;https://www.zerodayinitiative.com/blog/2022/2/14/static-taint-analysis-using-binary-ninja-a-case-study-of-mysql-cluster-vulnerabilities&quot;&gt;Binary Ninja 등의 툴을 활용하면  정적 분석도 바이너리 레벨에서 taint analyze가 가능하긴 합니다!&lt;/a&gt;)&lt;/p&gt;
&lt;p&gt;하지만 DTA를 수행하면 계측 대상 프로그램이 성능상 엄청난 부하를 감수할 수밖에 없습니다. 아주 최적화된 방법을 사용하더라도 10배 혹은 그 이상의 성능 저하가 발생합니다..ㅠㅠ&lt;/p&gt;
&lt;h2 id=&quot;b-퍼징과-다른-점&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#b-%ED%8D%BC%EC%A7%95%EA%B3%BC-%EB%8B%A4%EB%A5%B8-%EC%A0%90&quot; aria-label=&quot;b 퍼징과 다른 점 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;B. 퍼징과 다른 점?&lt;/h2&gt;
&lt;p&gt;DTA도 퍼징처럼 소프트웨어 취약점을 이용해서 나타날 수 있는 소프트웨어의 오류를 찾아내고 대처할 수 있는 분석 방법 중 하나입니다.&lt;/p&gt;
&lt;p&gt;퍼징은 버그를 탐지할 때 주로 외부에 드러나는 현상을 중심으로 관찰합니다. 특히 프로그램의 Crashing, Hanging 현상을 활용합니다. &lt;/p&gt;
&lt;p&gt;이처럼 일반적인 퍼징이 주로 관찰 가능한 버그만 찾을 수 있는 상황에 사용하는 것이라면, DTA는 정보 유출 혹은 Logical Bugs 등 충돌이 발생하지 않는 버그에 사용됩니다.&lt;/p&gt;
&lt;h2 id=&quot;c-dta의-세-가지-요소&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#c-dta%EC%9D%98-%EC%84%B8-%EA%B0%80%EC%A7%80-%EC%9A%94%EC%86%8C&quot; aria-label=&quot;c dta의 세 가지 요소 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;C. DTA의 세 가지 요소&lt;/h2&gt;
&lt;p&gt;큰 시각에서 봤을 때 오염 분석은 세 가지 요소를 정의하는 과정으로 출발합니다. 먼저 &lt;strong&gt;Taint Source&lt;/strong&gt;를 설정하고, &lt;strong&gt;Taint Sink&lt;/strong&gt;를 정의한 후 &lt;strong&gt;Taint Propagation&lt;/strong&gt;를 추적합니다. &lt;/p&gt;
&lt;p&gt;(실제 DTA툴 개발 시, 개발자는 앞 두 가지만 정의하면 됩니다. &lt;strong&gt;Taint Progatation&lt;/strong&gt;은 통상적으로 라이브러리가 지원해 줍니다.)&lt;/p&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 1126px; &quot;
    &gt;
      &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 27.666666666666668%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAGCAYAAADDl76dAAAACXBIWXMAABcRAAAXEQHKJvM/AAABDElEQVQY013Q30oCQRQG8CMYum2Qf9qQ1UIJCUKiEgMvqivve4OeSqyuZsHd2NnZHa0gehDBJ+g17DvrQRYvfpxlZvbM+Yai+byUaU1Qh2u4EjdwB5dZklBue465MIYRDKWOrdaPFChFn2lK0uRJDrAHcQ8H0qh4Oa/fihEuzCsppbxva/mHdmGCHZskDmpjb/0UzsCX2vsJw6p9fyOe8OUjDGsLY1rL7aRHcAEtOMkja92RKTlqGZdwwyY4X0HgzlYr528yaW9qjSE3fMY71vOGxnDDMhzyYYnoy3N48u3t3hZsHPeNtf3f6XSwIXIpjiKOVcHmOceRKYs47vHemi8pulJ7aZZ1X9fr6j/7GflcmsEM9AAAAABJRU5ErkJggg==&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;Untitled&quot;
        title=&quot;Untitled&quot;
        src=&quot;/static/9e5f515b988e02e5e5e1599817c554c3/b94e3/Untitled1.png&quot;
        srcset=&quot;/static/9e5f515b988e02e5e5e1599817c554c3/5a46d/Untitled1.png 300w,
/static/9e5f515b988e02e5e5e1599817c554c3/0a47e/Untitled1.png 600w,
/static/9e5f515b988e02e5e5e1599817c554c3/b94e3/Untitled1.png 1126w&quot;
        sizes=&quot;(max-width: 1126px) 100vw, 1126px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
      /&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;용어 설명 전, 이해를 돕기 위해 아주 쉬운 예시 상황을 설정하겠습니다.&lt;/p&gt;
&lt;p&gt;서버와 클라이언트가 send와 recv함수를 사용해 통신합니다. 이때 사용자가 악의적으로 버퍼오버플로우를 일으켜 exec_buf 값을 수정하여 원하는 명령어를 실행할 수 있습니다.&lt;/p&gt;
&lt;p&gt;위와 같은 상황을 탐지하기 위해서는 각 요소를 어떻게 설정해야 할까여??&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Taint Source&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;추적하고자 선택한 특정 데이터의 프로그램 내 위치입니다. 위 상황에서는 &lt;strong&gt;recv&lt;/strong&gt;함수가 해당됩니다.&lt;/p&gt;
&lt;p&gt;따라서 분석 툴 개발 시 recv 시스템 콜 콜백함수를 사용하면 됩니다.&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Taint Sink&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;오염된 데이터(Taint Source로 설정한 데이터)로부터 영향을 받았는지 여부를 확인하고자 하는 프로그램 내의 위치입니다.&lt;/p&gt;
&lt;p&gt;위 상황에서는 &lt;strong&gt;execve&lt;/strong&gt;함수가 됩니다.&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Taint Propagation&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;프로그램 내에서 오염된 데이터가 어떻게 흘러가는지 추적하려면 해당 데이터를 처리하는 모든 명령어에 대해 계측을 수행해야 합니다. mov, xor, shl 와 같은 모~든 명령어를 계측하여 일부 바이트라도 영향을 미치면 전부 오염시킵니다. &lt;/p&gt;
&lt;p&gt;이 부분은 Taint Policy의 영향을 받습니다. Taint Policy에 대해서는 바로 다음 파트에서 설명하겠습니당.&lt;/p&gt;
&lt;h2 id=&quot;d-taint-policy&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#d-taint-policy&quot; aria-label=&quot;d taint policy permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;D. Taint Policy&lt;/h2&gt;
&lt;p&gt;DTA 시스템에서 오염이 전파되는 기준에 대한 정의입니다.  또한 중첩된 오염이 발생한 경우 색깔을 어떻게 merge해 표기할지를 정의합니다. &lt;/p&gt;
&lt;p&gt;몇 가지 X64 명령어를 예시로 설명합니다.&lt;/p&gt;
&lt;p&gt;참고로 아래 설명에서 T는 Taint(오염된) 메모리를 의미합니다.&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;MOV&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 943px; &quot;
    &gt;
      &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 9.333333333333334%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAACCAYAAABYBvyLAAAACXBIWXMAABcRAAAXEQHKJvM/AAAAn0lEQVQI12MoLSjgAmK2lvp6FgYgePbsmdC5M2csz589a3n/3j2xs6dPMyyYM4dt/uzZ6jOmTDEFshX////PsHLFCsY5CxcyLpo3j2fWtGmGUDkJBqBhKkAs0dLQIAg0j+nF8+eer16+3PLm9estjx4+jAYZuHThQpllixYtXL5o0WYg3QkycN2aNWw9M2cyLZ4/3xIotgmINy9ZsCADAJPIVYkoBm14AAAAAElFTkSuQmCC&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;Untitled&quot;
        title=&quot;Untitled&quot;
        src=&quot;/static/f6f347b91d3bef87d0c96e179ab2cfd6/146da/Untitled2.png&quot;
        srcset=&quot;/static/f6f347b91d3bef87d0c96e179ab2cfd6/5a46d/Untitled2.png 300w,
/static/f6f347b91d3bef87d0c96e179ab2cfd6/0a47e/Untitled2.png 600w,
/static/f6f347b91d3bef87d0c96e179ab2cfd6/146da/Untitled2.png 943w&quot;
        sizes=&quot;(max-width: 943px) 100vw, 943px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
      /&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;mov 같은 단순한 연상의 경우 전파되는 규칙이 명확합니다.&lt;/p&gt;
&lt;p&gt;결과값은 단순히 T의 복사본이기 때문에 A역시 오염된 메모리 T의 오염 정보를 그대로 전수받습니다.&lt;/p&gt;
&lt;p&gt;결과적으로 이 경우에 Taint merge operation은 &lt;code class=&quot;language-text&quot;&gt;:=&lt;/code&gt; 입니다.(그냥 단순 할당)&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;XOR&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 943px; &quot;
    &gt;
      &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 9.333333333333334%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAACCAYAAABYBvyLAAAACXBIWXMAABcRAAAXEQHKJvM/AAAAn0lEQVQI12MoLSjgBGK2+qoqpv///zMsnj9faM6MGeZzZ8wwWzhnjvjCuXMZZk+fzjZ/9mz1GVOmmC6YM0cRpG7Pnj2Mjo6OjA/u3+c5f+6cIQjfuX1bggFomDIQS9RVVvKAFC5duNBz2aJFm5cvXrwZaHg0EDMADZEBii1cDhQH0p0gdcePH2djYGBgevL4seXrV682vXn9euPTJ08yAAl7V9lZfIa3AAAAAElFTkSuQmCC&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;Untitled&quot;
        title=&quot;Untitled&quot;
        src=&quot;/static/05ba024d4ed6d3e92fe6316b11221726/146da/Untitled3.png&quot;
        srcset=&quot;/static/05ba024d4ed6d3e92fe6316b11221726/5a46d/Untitled3.png 300w,
/static/05ba024d4ed6d3e92fe6316b11221726/0a47e/Untitled3.png 600w,
/static/05ba024d4ed6d3e92fe6316b11221726/146da/Untitled3.png 943w&quot;
        sizes=&quot;(max-width: 943px) 100vw, 943px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
      /&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;피연산자가 자기 자신과 동일한 값으로 연산을 수행하는 특수한 xor 연산 상황을 예시로 들겠습니다.&lt;/p&gt;
&lt;p&gt;이 경우 항상 결과는 0이 됩니다.&lt;/p&gt;
&lt;p&gt;따라서 공격자가 아무리 T 값을 조작하려고 해도 결과값에 대해서 아무런 변화를 줄 수가 없게 되겠쬬?&lt;/p&gt;
&lt;p&gt;결과적으로 이 경우의 Taint merge operation은 &lt;code class=&quot;language-text&quot;&gt;Ø&lt;/code&gt; 공집합입니다.&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;SHL&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 943px; &quot;
    &gt;
      &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 9.333333333333334%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAACCAYAAABYBvyLAAAACXBIWXMAABcRAAAXEQHKJvM/AAAApklEQVQI12MoLSjgAGLWlvp6lv///zO8eP5c8NyZM5bnz561fHD/vtjDBw8YgGy227duqR89fNh01fLliiB1W7duZZyzcCHjonnzeGZNm2Y4Y8oU0wVz5kgwAA2TB2JhoIGCIIUvX7zwfPXy5ZY3r19vefzoUTQQM9y6eVPm9atXC589fbp50/r1nSB1+/buZeuZOZNp8fz5lssWLdoExJuXLFiQAQCar2CzJj70WAAAAABJRU5ErkJggg==&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;Untitled&quot;
        title=&quot;Untitled&quot;
        src=&quot;/static/f3d5d52470c3c25b9b9bf32712006881/146da/Untitled4.png&quot;
        srcset=&quot;/static/f3d5d52470c3c25b9b9bf32712006881/5a46d/Untitled4.png 300w,
/static/f3d5d52470c3c25b9b9bf32712006881/0a47e/Untitled4.png 600w,
/static/f3d5d52470c3c25b9b9bf32712006881/146da/Untitled4.png 943w&quot;
        sizes=&quot;(max-width: 943px) 100vw, 943px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
      /&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;변수 T값만큼 A값을 시프트하는 상황입니다. 이러한 경우 T가 한 바이트만 오염되어 있어도 A의 모든 바이트에 영향을 미칠 수 있습니다.&lt;/p&gt;
&lt;p&gt;결과적으로 A의 모든 부분에 오염이 전파됩니다.&lt;/p&gt;
&lt;p&gt;이 경우 오염 정책의 Taint merge operation은 &lt;code class=&quot;language-text&quot;&gt;:=&lt;/code&gt; 가 됩니다.&lt;/p&gt;
&lt;h2 id=&quot;e-한계&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#e-%ED%95%9C%EA%B3%84&quot; aria-label=&quot;e 한계 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;E. 한계..&lt;/h2&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;python&quot;&gt;&lt;pre class=&quot;language-python&quot;&gt;&lt;code class=&quot;language-python&quot;&gt;var &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;while&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;taint&lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; var&lt;span class=&quot;token operator&quot;&gt;+&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;+&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;token comment&quot;&gt;# taint는 오염된 변수를 의미합니다.&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;코드를 보면 공격자가 taint 변수를 통해 var 값을 변조하는 것을 확인할 수 있습니다. &lt;/p&gt;
&lt;p&gt;gcc로 빌드 후 해당 부분의 명령어를 확인해 보면 아래와 같습니다. &lt;/p&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 1200px; &quot;
    &gt;
      &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 14.333333333333334%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAADCAYAAACTWi8uAAAACXBIWXMAABcRAAAXEQHKJvM/AAAAxUlEQVQI1yWOS26DMAAFs6KJMQRsPjJ2+GQTatNEIdBGuUCXvUDvf40pUhdvMxqN3q67twxLj/UNzluabapMcG2Ecj1mWjg/Jr5/Bn5fliUrkLEkTSXhJvC3A8ZU5LlCCMFunVee65PwHpj8xEe4osuM5hSRuw5znemHC6/M8pVobG04yIRECh6V4F7u6U6OprH/wXmeWdaFcRzxweN9QOkjtouozcD58klRVNRbQKUJx+1JK1PqdHP2Me5NoDemtCaOY/4Akh1QF7AfcdYAAAAASUVORK5CYII=&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;Untitled&quot;
        title=&quot;Untitled&quot;
        src=&quot;/static/80986295c1467e35cd4aa52766bb4cf1/c1b63/Untitled5.png&quot;
        srcset=&quot;/static/80986295c1467e35cd4aa52766bb4cf1/5a46d/Untitled5.png 300w,
/static/80986295c1467e35cd4aa52766bb4cf1/0a47e/Untitled5.png 600w,
/static/80986295c1467e35cd4aa52766bb4cf1/c1b63/Untitled5.png 1200w,
/static/80986295c1467e35cd4aa52766bb4cf1/252a4/Untitled5.png 1314w&quot;
        sizes=&quot;(max-width: 1200px) 100vw, 1200px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
      /&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;두 변수 간의 묵시적인 데이터 흐름이 발생하지 않는 것이 확인됩니다.&lt;/p&gt;
&lt;p&gt;결국 DTA는 taint 변수 값이 오염된 상황이지만 var 값은 오염되지 않은 것으로 판단하고 이 결과 과소 오염으로 진단하게 됩니다.&lt;/p&gt;
&lt;h1 id=&quot;3-libdft64-설치-및-사용-방법&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#3-libdft64-%EC%84%A4%EC%B9%98-%EB%B0%8F-%EC%82%AC%EC%9A%A9-%EB%B0%A9%EB%B2%95&quot; aria-label=&quot;3 libdft64 설치 및 사용 방법 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;3. LIBDFT64 설치 및 사용 방법&lt;/h1&gt;
&lt;h2 id=&quot;a-설치&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#a-%EC%84%A4%EC%B9%98&quot; aria-label=&quot;a 설치 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;A. 설치&lt;/h2&gt;
&lt;p&gt;ubuntu 20.04 기준 정상 동작했으며, wsl환경을 사용했습니다.&lt;/p&gt;
&lt;p&gt;설치 스크립트는 다음과 같습니다.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;bash&quot;&gt;&lt;pre class=&quot;language-bash&quot;&gt;&lt;code class=&quot;language-bash&quot;&gt;&lt;span class=&quot;token shebang important&quot;&gt;#!/bin/bash&lt;/span&gt;
&lt;span class=&quot;token function&quot;&gt;git&lt;/span&gt; clone https://github.com/AngoraFuzzer/libdft64.git

&lt;span class=&quot;token builtin class-name&quot;&gt;cd&lt;/span&gt; libdft64

./install_pin.sh

&lt;span class=&quot;token builtin class-name&quot;&gt;export&lt;/span&gt; &lt;span class=&quot;token assign-left variable&quot;&gt;PIN_ROOT&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;pintools_path&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;

&lt;span class=&quot;token function&quot;&gt;make&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h2 id=&quot;b-libdft64-내부-구조&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#b-libdft64-%EB%82%B4%EB%B6%80-%EA%B5%AC%EC%A1%B0&quot; aria-label=&quot;b libdft64 내부 구조 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;B. LIBDFT64 내부 구조&lt;/h2&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 693px; &quot;
    &gt;
      &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 80.66666666666666%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAQCAIAAACZeshMAAAACXBIWXMAAAsTAAALEwEAmpwYAAACcUlEQVQoz02SC1eqUBCF+f//xNsqrVRuD81XD11mWokJ4gMDgQRNLRVT73fAu+6dtWDNGWbP7L050nQ6nUexWHhjz7FFTCaTWRifn5+WZZFQse2R67qz2aGdT5Lneev1+vv7OwiCrq7X6/V2u8233W5HZbMJer3egrneuNVqaapGvlwuV6sVQIkEJGeqjuNQBfLx8WEMh65ziKiBWePxGBbkX19fdEqLxZyMM/whvJjPaVWU5t3d3XOj/lirqapGhbb5fDYajWArstkMlGQYg9fXl2azuQkjCGO73e72e477/R7djUZjYBgI2f4NcpZJDFPbqqZ1DMOAIfNcx/UnU4yAGEesKhaLuXw+l8vd399nMpm3tzfTNGkW4FqtVi6XAb+/v1um+fzywrd+v08T4tF5dHQUi8VOTk6Oj49jsV/kmWwWjRID6NN1ndaHhwdFUaggjDc+Yyng07OzeDwuy/J5MplIJMjz+TxbBXg4HLKTN8hutwvbn58fBKONKeBLpRLdt7e3pVLx5iYLc/iLzTydTgfamqaxCv9UVWXYkGwwgPZqteSIKJMNpokLmI8jMJIc1xkM+tQ50MG/hX+1+thSlF6vj9tsTqfT52GkZblSLqMOmw6bGc8kMdey8Ic7iAv1p6dqtcpXz/fTqRRIpCZTKThfX18XCoWDZgEOAvFXfB8kl9m2xcUyTSvSnBQ+xROnGHeavRGBfgFmNgBuGIJRq+vdkW1bpuWFFCLw5eWlLKfhfHHxO5sVhvHn/4EjbwmmUMWqp5B2dB8BQPXq6opXoQCwWKlUDv8ZsO/7bIjeVDAvusAguWGj/8IKgwSxfwB4w0wdwYER8AAAAABJRU5ErkJggg==&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;Untitled&quot;
        title=&quot;Untitled&quot;
        src=&quot;/static/f4306b6874986bfb26dc8fbae3c5accf/61c63/Untitled6.png&quot;
        srcset=&quot;/static/f4306b6874986bfb26dc8fbae3c5accf/5a46d/Untitled6.png 300w,
/static/f4306b6874986bfb26dc8fbae3c5accf/0a47e/Untitled6.png 600w,
/static/f4306b6874986bfb26dc8fbae3c5accf/61c63/Untitled6.png 693w&quot;
        sizes=&quot;(max-width: 693px) 100vw, 693px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
      /&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Tagmap: DTA 시스템을 위해 마련되는 가상 메모리 공간입니다. 즉, 메모리 공간의 오염 정보 상태를 기록하는 곳입니다.
(DTA 에서는 이런 공간을 SHADOW MEMORY라고 부르지만, LIBDFT에서는 TAGMAP 이라는 이름을 사용합니다.)&lt;/li&gt;
&lt;li&gt;Vcpu: CPU 레지스터들의 오염 상태를 관리하는 공간입니다. 메모리 공간뿐 아니라 레지스터도 오염 대상이 될 수 있습니다.&lt;/li&gt;
&lt;li&gt;Tracker: 오염 추적 엔진입니다. &lt;code class=&quot;language-text&quot;&gt;libdft_core.c&lt;/code&gt;에 구현되어 있습니다.&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&quot;c-libdft64-api&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#c-libdft64-api&quot; aria-label=&quot;c libdft64 api permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;C. LIBDFT64 API&lt;/h2&gt;
&lt;p&gt;주요 사용되는 API를  설명합니다.&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;tagmap_setb() : 특정 메모리 바이트를 오염된 것으로 표시합니다.&lt;/li&gt;
&lt;li&gt;tagmap_getb() : 특정 메모리 바이트의 오염 여부를 확인합니다.&lt;/li&gt;
&lt;li&gt;syscall_set _pre() 시스템 콜 발생에 대한 사전 콜백을 등록합니다.&lt;/li&gt;
&lt;li&gt;syscall_set _post() : 시스템 콜 발생에 대한 사후 콜백을 등록합니다.&lt;/li&gt;
&lt;li&gt;&lt;u&gt;syscall_desc&lt;/u&gt; : 시스템 콜 콜백들을 저장하기 위한 배열입니다.&lt;/li&gt;
&lt;li&gt;ins_set _pre/post() : 명령어에 대한 사전/사후 콜백을 등록합니다.&lt;/li&gt;
&lt;li&gt;&lt;u&gt;ins_desc&lt;/u&gt; : 명령어 콜백들을 저장하기 위한 배열입니다.&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;참고로 밑줄 친 두 개의 배열은 &lt;code class=&quot;language-text&quot;&gt;extern&lt;/code&gt;으로 선언해 주어야 합니다. &lt;/p&gt;
&lt;h2 id=&quot;d-빌드-방법&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#d-%EB%B9%8C%EB%93%9C-%EB%B0%A9%EB%B2%95&quot; aria-label=&quot;d 빌드 방법 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;D. 빌드 방법&lt;/h2&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;분석 대상 프로그램 &lt;/p&gt;
&lt;p&gt;dta tool로 분석하고자 하는 프로그램을 &lt;code class=&quot;language-text&quot;&gt;libdft64/tools/obj-intel64&lt;/code&gt; 디렉토리 안에 위치시킵니다.&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;dta tool 빌드&lt;/p&gt;
&lt;p&gt;개발한 dta tool파일은 &lt;code class=&quot;language-text&quot;&gt;libdft64/tools&lt;/code&gt;폴더에 위치해야 합니다.&lt;/p&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;libdft64/tools/makefile.rules&lt;/code&gt; 파일의 31번째 행의 TOOL_ROOTS 변수에 dta tool 파일 이름을 넣습니다. &lt;/p&gt;
&lt;p&gt;이후 &lt;code class=&quot;language-text&quot;&gt;libdft64/&lt;/code&gt; 로 이동해서 make 명령어를 입력합니다.&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;분석 수행&lt;/p&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;libdft64/tools/makefile.rules&lt;/code&gt; 의 마지막 행에 다음 makefile rule을 추가합니다.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;bash&quot;&gt;&lt;pre class=&quot;language-bash&quot;&gt;&lt;code class=&quot;language-bash&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;name&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;: &lt;span class=&quot;token variable&quot;&gt;&lt;span class=&quot;token variable&quot;&gt;$(&lt;/span&gt;OBJDIR&lt;span class=&quot;token variable&quot;&gt;)&lt;/span&gt;&lt;/span&gt;/&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;dta_tool&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token variable&quot;&gt;&lt;span class=&quot;token variable&quot;&gt;$(&lt;/span&gt;PINTOOL_SUFFIX&lt;span class=&quot;token variable&quot;&gt;)&lt;/span&gt;&lt;/span&gt; &lt;span class=&quot;token variable&quot;&gt;${OBJDIR}&lt;/span&gt;/&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;analysis_target&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;
     &lt;span class=&quot;token variable&quot;&gt;&lt;span class=&quot;token variable&quot;&gt;$(&lt;/span&gt;PIN&lt;span class=&quot;token variable&quot;&gt;)&lt;/span&gt;&lt;/span&gt; -t $&lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt; -- &lt;span class=&quot;token variable&quot;&gt;&lt;span class=&quot;token variable&quot;&gt;$(&lt;/span&gt;OBJDIR&lt;span class=&quot;token variable&quot;&gt;)&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;analysis_target&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;이후 &lt;code class=&quot;language-text&quot;&gt;libdft64/tools/&lt;/code&gt; 경로에서 &lt;code class=&quot;language-text&quot;&gt;make [name]&lt;/code&gt; 을 해주시면, 툴이 분석 대상 프로그램 계측을 시작합니다.&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;h1 id=&quot;4-libdft64로-format-string-bug-탐지&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#4-libdft64%EB%A1%9C-format-string-bug-%ED%83%90%EC%A7%80&quot; aria-label=&quot;4 libdft64로 format string bug 탐지 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;4. LIBDFT64로 Format String Bug 탐지&lt;/h1&gt;
&lt;h2 id=&quot;a-format-string-bug-탐지-방안&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#a-format-string-bug-%ED%83%90%EC%A7%80-%EB%B0%A9%EC%95%88&quot; aria-label=&quot;a format string bug 탐지 방안 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;A. Format String Bug 탐지 방안&lt;/h2&gt;
&lt;p&gt;FSB 탐지 방법은 되게 직관적이고 간단합니다. &lt;/p&gt;
&lt;p&gt;FSB는 사용자가 포맷스트링을 입력할 수 있을 때 발생합니다. &lt;/p&gt;
&lt;p&gt;아래는 본 글에서 dta 툴을 사용한 분석에 사용될 프로그램 코드입니다.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;c&quot;&gt;&lt;pre class=&quot;language-c&quot;&gt;&lt;code class=&quot;language-c&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;// gcc -o fsb fsb.c -no-pie -fcf-protection=none&lt;/span&gt;
&lt;span class=&quot;token macro property&quot;&gt;&lt;span class=&quot;token directive-hash&quot;&gt;#&lt;/span&gt;&lt;span class=&quot;token directive keyword&quot;&gt;include&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&amp;lt;stdio.h&gt;&lt;/span&gt;&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;int&lt;/span&gt; key &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;main&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;void&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
	
	&lt;span class=&quot;token keyword&quot;&gt;char&lt;/span&gt; buf&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;0x20&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
	&lt;span class=&quot;token function&quot;&gt;read&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; buf&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;0x20&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
	
	&lt;span class=&quot;token function&quot;&gt;printf&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;buf&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

	&lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;key&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
		&lt;span class=&quot;token function&quot;&gt;printf&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;FSB\n&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
	&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;	

	&lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;위 프로그램 내에서의 fsb를 탐지하기 위해 아래와 같이 설계해 줍니다.&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Taint Source : read()&lt;/li&gt;
&lt;li&gt;Taint Sink : printf()&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;read 함수로 입력되는 값을 오염시키고, 그 값이 printf()함수의 &lt;strong&gt;“첫 번째 인자”&lt;/strong&gt; 로 사용되었을 때 FSB가 발생한다고 가정했습니다.(linux x64비트니까 printf()함수의 RDI값을 확인하면 되겠져)&lt;/p&gt;
&lt;p&gt;추가적으로 콜백 등록 관련 고려해야 할 부분이 있습니다.&lt;/p&gt;
&lt;p&gt;Taint Source인 read()는 시스템 콜에 콜백을 등록해 주면 됩니다.&lt;/p&gt;
&lt;p&gt;하지만 LIBDFT를 사용해서 라이브러리 함수를 직접적으로 후킹 할 수 없습니다. 왜냐하면 이 함수는 시스템 콜이 아니기 때문입니다. &lt;strong&gt;대신 명령어 콜백은 사용할 수 있으므로, printf함수의 PLT를 CALL하는 경우를 탐지해 줍니다.&lt;/strong&gt;&lt;/p&gt;
&lt;blockquote&gt;
&lt;ul&gt;
&lt;li&gt;fsb가 일어나는 함수는 sprintf, fprintf 등 다양하지만 위 테스트 코드에 한정해 dta 툴을 작성했습니다. &lt;/li&gt;
&lt;li&gt;‘printf() 함수로 바로 이동 하는 상황’ 혹은 ‘read 외 다른 함수로 입력을 받는 상황’ 등은 고려하지 않습니다.&lt;/li&gt;
&lt;/ul&gt;
&lt;/blockquote&gt;
&lt;h2 id=&quot;b-테스트-대상-프로그램-빌드-시-유의-사항&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#b-%ED%85%8C%EC%8A%A4%ED%8A%B8-%EB%8C%80%EC%83%81-%ED%94%84%EB%A1%9C%EA%B7%B8%EB%9E%A8-%EB%B9%8C%EB%93%9C-%EC%8B%9C-%EC%9C%A0%EC%9D%98-%EC%82%AC%ED%95%AD&quot; aria-label=&quot;b 테스트 대상 프로그램 빌드 시 유의 사항 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;B. 테스트 대상 프로그램 빌드 시 유의 사항&lt;/h2&gt;
&lt;p&gt;테스트 대상 프로그램을 GCC로 빌드 할 시 꼭 &lt;code class=&quot;language-text&quot;&gt;fcf-protection=none&lt;/code&gt; 옵션을 추가해 주세요!&lt;/p&gt;
&lt;p&gt;상기 언급한 대로, DTA 툴 내에서 테스트 대상 프로그램 printf()의 PLT주소를 알아야 합니다.&lt;/p&gt;
&lt;p&gt;PLT 주소를 알아내기 위해 DTA 툴에서 분석 대상 ELF의 섹션 정보를 파싱하는데 &lt;/p&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;fcf-protection&lt;/code&gt;이 활성화되어 있으면, 빌드 후 바이너리 내에서 &lt;code class=&quot;language-text&quot;&gt;.plt&lt;/code&gt; 섹션을 사용하지 않고 &lt;code class=&quot;language-text&quot;&gt;.plt.sec&lt;/code&gt; 섹션을 사용합니다.&lt;/p&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;.plt.sec&lt;/code&gt; 섹션의 코드는 다음과 같은 &lt;code class=&quot;language-text&quot;&gt;endbr64&lt;/code&gt; 명령어로 시작합니다. &lt;/p&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 919px; &quot;
    &gt;
      &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 5%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAABCAYAAADeko4lAAAACXBIWXMAAAsTAAALEwEAmpwYAAAASklEQVQI1w3LOxKAIAxAQXsIw2Siw0eijbR6/8s9Kbbczdy4PkeyoEXxd9BnJ0kihLBEYgzcU2iPk+vA2okehbo7qoaJ4DGR1/kB4XsY8JMX79sAAAAASUVORK5CYII=&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;Untitled&quot;
        title=&quot;Untitled&quot;
        src=&quot;/static/941bb0f3cf98cfff8ad19c3bd73f58bb/6295b/Untitled7.png&quot;
        srcset=&quot;/static/941bb0f3cf98cfff8ad19c3bd73f58bb/5a46d/Untitled7.png 300w,
/static/941bb0f3cf98cfff8ad19c3bd73f58bb/0a47e/Untitled7.png 600w,
/static/941bb0f3cf98cfff8ad19c3bd73f58bb/6295b/Untitled7.png 919w&quot;
        sizes=&quot;(max-width: 919px) 100vw, 919px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
      /&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;안타깝게도 pin tools의 elf 파싱 로직이 저 부분을 해석하지 못합니다.. &lt;/p&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;fcf-protection&lt;/code&gt; 보안 기법에 대한 설명은 추후 추가하겠습니다. &lt;/p&gt;
&lt;h2 id=&quot;c-dta-툴-작성&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#c-dta-%ED%88%B4-%EC%9E%91%EC%84%B1&quot; aria-label=&quot;c dta 툴 작성 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;C. DTA 툴 작성&lt;/h2&gt;
&lt;p&gt;전체 코드는 &lt;a href=&quot;https://github.com/hyunjungg/libdft64/blob/master/tools/detect_fsb.cpp&quot;&gt;여기&lt;/a&gt;서 확인하실 수 있습니다.&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;초기화 및 콜백 등록&lt;/li&gt;
&lt;/ul&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;c&quot;&gt;&lt;pre class=&quot;language-c&quot;&gt;&lt;code class=&quot;language-c&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;main&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;int&lt;/span&gt; argc&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;char&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;*&lt;/span&gt;argv&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
 
  &lt;span class=&quot;token function&quot;&gt;PIN_InitSymbols&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
	
	&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt;
	&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt;  일부 생략
	&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt;

  &lt;span class=&quot;token function&quot;&gt;IMG_AddInstrumentFunction&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;image_load&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;token comment&quot;&gt;// PLT PARSING&lt;/span&gt;
  &lt;span class=&quot;token function&quot;&gt;syscall_set_post&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&amp;amp;&lt;/span&gt;syscall_desc&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;__NR_read&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; post_read_hook&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;token comment&quot;&gt;// set read callback&lt;/span&gt;
  &lt;span class=&quot;token function&quot;&gt;ins_set_post&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&amp;amp;&lt;/span&gt;ins_desc&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;XED_ICLASS_CALL_NEAR&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; dta_instrument_call&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;token comment&quot;&gt;// set ins callback&lt;/span&gt;
	
  &lt;span class=&quot;token comment&quot;&gt;/* start Pin */&lt;/span&gt;
  &lt;span class=&quot;token function&quot;&gt;PIN_StartProgram&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;ul&gt;
&lt;li&gt;PLT 파싱&lt;/li&gt;
&lt;/ul&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;c&quot;&gt;&lt;pre class=&quot;language-c&quot;&gt;&lt;code class=&quot;language-c&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;void&lt;/span&gt; 
&lt;span class=&quot;token function&quot;&gt;image_load&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;IMG img&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; VOID &lt;span class=&quot;token operator&quot;&gt;*&lt;/span&gt;v&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;IMG_IsMainExecutable&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;img&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;

      &lt;span class=&quot;token keyword&quot;&gt;for&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;SEC sec &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;IMG_SecHead&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;img&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;SEC_Valid&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;sec&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt; sec &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;SEC_Next&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;sec&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;

        &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;SEC_Name&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;sec&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;==&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;.plt&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
          &lt;span class=&quot;token keyword&quot;&gt;for&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;RTN rtn &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;SEC_RtnHead&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;sec&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;RTN_Valid&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;rtn&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt; rtn &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;RTN_Next&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;rtn&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;

            &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;RTN_Name&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;rtn&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;==&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;printf@plt&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
                plt_printf &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;RTN_Address&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;rtn&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
                &lt;span class=&quot;token keyword&quot;&gt;break&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
            &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
          &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
          &lt;span class=&quot;token keyword&quot;&gt;break&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
        &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
      &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;ul&gt;
&lt;li&gt;READ 콜백 함수&lt;/li&gt;
&lt;/ul&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;c&quot;&gt;&lt;pre class=&quot;language-c&quot;&gt;&lt;code class=&quot;language-c&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;void&lt;/span&gt;
&lt;span class=&quot;token function&quot;&gt;post_read_hook&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;THREADID tid&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;syscall_ctx_t&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;*&lt;/span&gt;ctx&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  
  &lt;span class=&quot;token comment&quot;&gt;// only receive input data from STDIN(0)&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;ctx&lt;span class=&quot;token operator&quot;&gt;-&gt;&lt;/span&gt;arg&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;SYSCALL_ARG0&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;!=&lt;/span&gt; STDIN_FILENO&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

  &lt;span class=&quot;token comment&quot;&gt;// set the tag marking&lt;/span&gt;
  &lt;span class=&quot;token function&quot;&gt;tagmap_setn&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;ctx&lt;span class=&quot;token operator&quot;&gt;-&gt;&lt;/span&gt;arg&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;SYSCALL_ARG1&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;size_t&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;ctx&lt;span class=&quot;token operator&quot;&gt;-&gt;&lt;/span&gt;ret&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;0x01&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;token function&quot;&gt;fprintf&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token constant&quot;&gt;stderr&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;[INFO] tainting bytes %p ~ %p (tainted byte : %lu)\n&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; 
          &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;ctx&lt;span class=&quot;token operator&quot;&gt;-&gt;&lt;/span&gt;arg&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;SYSCALL_ARG1&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
          &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;ctx&lt;span class=&quot;token operator&quot;&gt;-&gt;&lt;/span&gt;arg&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;SYSCALL_ARG1&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;size_t&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;ctx&lt;span class=&quot;token operator&quot;&gt;-&gt;&lt;/span&gt;ret&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
          &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;size_t&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;ctx&lt;span class=&quot;token operator&quot;&gt;-&gt;&lt;/span&gt;ret &lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;ul&gt;
&lt;li&gt;CALL 명령어 콜백 함수&lt;/li&gt;
&lt;/ul&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;c&quot;&gt;&lt;pre class=&quot;language-c&quot;&gt;&lt;code class=&quot;language-c&quot;&gt;&lt;span class=&quot;token function&quot;&gt;dta_instrument_call&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;INS ins&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
 
  &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;!&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;INS_IsCall&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;ins&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

  &lt;span class=&quot;token function&quot;&gt;INS_InsertCall&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;ins&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
      IPOINT_BEFORE&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
      &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;AFUNPTR&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;check_string_taint&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
      IARG_CONTEXT &lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;  
      IARG_INST_PTR&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; IARG_BRANCH_TARGET_ADDR&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
      IARG_END&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;ul&gt;
&lt;li&gt;분석 함수&lt;/li&gt;
&lt;/ul&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;c&quot;&gt;&lt;pre class=&quot;language-c&quot;&gt;&lt;code class=&quot;language-c&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;void&lt;/span&gt;
&lt;span class=&quot;token function&quot;&gt;check_string_taint&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;CONTEXT &lt;span class=&quot;token operator&quot;&gt;*&lt;/span&gt;ctxt&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; ADDRINT ip&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; ADDRINT target&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  
  &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;target &lt;span class=&quot;token operator&quot;&gt;!=&lt;/span&gt; plt_printf&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

  ADDRINT rdiValue &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;PIN_GetContextReg&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;ctxt&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; REG_RDI&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;char&lt;/span&gt; buffer&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;1024&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

  &lt;span class=&quot;token function&quot;&gt;PIN_SafeCopy&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;buffer&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;VOID&lt;span class=&quot;token operator&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;rdiValue&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;sizeof&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;buffer&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  
  &lt;span class=&quot;token keyword&quot;&gt;for&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;ADDRINT addr &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; rdiValue&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt; addr &lt;span class=&quot;token operator&quot;&gt;&amp;lt;=&lt;/span&gt; end&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt; addr&lt;span class=&quot;token operator&quot;&gt;++&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    tag &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;tagmap_getb&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;addr&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;tag &lt;span class=&quot;token operator&quot;&gt;!=&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
      &lt;span class=&quot;token function&quot;&gt;fprintf&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token constant&quot;&gt;stderr&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;\n\n\n[WARNING] !!! ADDRESS %p IS TAINTED (tag=0x%02x), ABORTING !!!!!\n\n\n&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
            &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;addr&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
            &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;unsigned&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;int&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;tag&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
      &lt;span class=&quot;token function&quot;&gt;exit&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
  
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h2 id=&quot;d-결과&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#d-%EA%B2%B0%EA%B3%BC&quot; aria-label=&quot;d 결과 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;D. 결과&lt;/h2&gt;
&lt;p&gt;최종 실행 시, 다음과 같이 정상 동작하는 것을 확인할 수 있습니다.&lt;/p&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 1014px; &quot;
    &gt;
      &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 26.333333333333336%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAFCAIAAADKYVtkAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAnElEQVQY022PzRLCIAyEe7aWlgD9wUolVKEHff/Hc01nPPFx2Ul2M0uTPznksOXg2W+c9tc7xNcjHbwfMca74L0fBa21c26apnmeiagpuSROTzxOibmUvK43Y2gcHdZGGIbhWqMxVvbWkCHSPzfOX4S2bf+iHl6W5TyPMiiGhtBodXbDBAZU6LquEsYfziSEtdYJcCul+r5XQjUJvvfuF1aDGdZsAAAAAElFTkSuQmCC&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;Untitled&quot;
        title=&quot;Untitled&quot;
        src=&quot;/static/8fe3b0112491f8013b9d982e0adf07e9/d7ab4/Untitled8.png&quot;
        srcset=&quot;/static/8fe3b0112491f8013b9d982e0adf07e9/5a46d/Untitled8.png 300w,
/static/8fe3b0112491f8013b9d982e0adf07e9/0a47e/Untitled8.png 600w,
/static/8fe3b0112491f8013b9d982e0adf07e9/d7ab4/Untitled8.png 1014w&quot;
        sizes=&quot;(max-width: 1014px) 100vw, 1014px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
      /&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;h1 id=&quot;5-참고&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#5-%EC%B0%B8%EA%B3%A0&quot; aria-label=&quot;5 참고 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;5. 참고&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;https://www.google.com/search?q=libdft&amp;#x26;oq=libdft&amp;#x26;aqs=chrome..69i57j69i59l2j69i60l3.3035j0j7&amp;#x26;sourceid=chrome&amp;#x26;ie=UTF-8&quot;&gt;https://www.google.com/search?q=libdft&amp;#x26;oq=libdft&amp;#x26;aqs=chrome..69i57j69i59l2j69i60l3.3035j0j7&amp;#x26;sourceid=chrome&amp;#x26;ie=UTF-8&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://github.com/AngoraFuzzer/libdft64&quot;&gt;https://github.com/AngoraFuzzer/libdft64&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://terrorgum.com/tfox/books/practicalbinaryanalysis.pdf&quot;&gt;https://terrorgum.com/tfox/books/practicalbinaryanalysis.pdf&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;</content:encoded></item><item><title><![CDATA[Windows IRQL 1]]></title><description><![CDATA[Dispatch Level에서 Dispatcher 호출하기! TOC 1. 개요 2. 개념 1. 윈도우 스케줄링 2. IRQL 3. DPC 3. 실습 참고 1. 개요 안녕하세요.! 오늘은 IRQL…]]></description><link>https://hyunjungg.github.io/windows/1202_windows_irql1/</link><guid isPermaLink="false">https://hyunjungg.github.io/windows/1202_windows_irql1/</guid><pubDate>Mon, 12 Dec 2022 00:58:13 GMT</pubDate><content:encoded>&lt;h1 id=&quot;dispatch-level에서-dispatcher-호출하기&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#dispatch-level%EC%97%90%EC%84%9C-dispatcher-%ED%98%B8%EC%B6%9C%ED%95%98%EA%B8%B0&quot; aria-label=&quot;dispatch level에서 dispatcher 호출하기 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Dispatch Level에서 Dispatcher 호출하기!&lt;/h1&gt;
&lt;h3 id=&quot;toc&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#toc&quot; aria-label=&quot;toc permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;[TOC]&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;#1---&quot;&gt;1. 개요&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;a href=&quot;#2---&quot;&gt;2. 개념&lt;/a&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;#1---------&quot;&gt;1. 윈도우 스케줄링&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#2-irql&quot;&gt;2. IRQL&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#3-dpc&quot;&gt;3. DPC&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#3---&quot;&gt;3. 실습&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#--&quot;&gt;참고&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&quot;1-개요&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#1-%EA%B0%9C%EC%9A%94&quot; aria-label=&quot;1 개요 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;1. 개요&lt;/h2&gt;
&lt;p&gt;안녕하세요.!&lt;/p&gt;
&lt;p&gt;오늘은 IRQL을 좀 더 자세히 이해하기 위해서 간단한 테스트를 해보려고 합니다!
IRQL을 공부하다 보면 인터럽트 마스킹이라는 개념을 접하게 되는데요,&lt;/p&gt;
&lt;p&gt;이를 눈으로 직접 확인해보겠습니다.!&lt;/p&gt;
&lt;p&gt;동작 방식 확인을 위해서 IRQL Dispatch level에서 동작하는 코드를 작성하고, 해당 코드 내부에서 dispatcher 를 호출 해서 시스템이 크래시 나는 과정을 한번 보려고 합니다.&lt;/p&gt;
&lt;p&gt;좀 더 자세히 말하면,  &lt;code class=&quot;language-text&quot;&gt;SetTimer()&lt;/code&gt; 로 DPC 루틴을 등록하여 실행시킨 후, 해당 DPC루틴 내부에서 &lt;code class=&quot;language-text&quot;&gt;KeDelayExecutionThread()&lt;/code&gt; 를 통해 퀀텀시간을 반납하여 dispatcher 를 호출해 볼 예정입니다. &lt;/p&gt;
&lt;p&gt;블루스크린이 발생한다는 사실은 알고 있지만
드라이버 개발을 할 일이 없기 했고..  드라이버를 활용하여 만들어 보고 싶은것도 없었기 때문에, 제 눈으로 직접 확인해 볼 수 있는 기회가 없었던 것 같아여 … ㅎ_ㅎ&lt;/p&gt;
&lt;p&gt;그럼 먼저 이해를 위해 알아야 할 개념들을 설명하겠습니다.!&lt;/p&gt;
&lt;h2 id=&quot;2-개념&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#2-%EA%B0%9C%EB%85%90&quot; aria-label=&quot;2 개념 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;2. 개념&lt;/h2&gt;
&lt;h3 id=&quot;1-윈도우-스케줄링&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#1-%EC%9C%88%EB%8F%84%EC%9A%B0-%EC%8A%A4%EC%BC%80%EC%A4%84%EB%A7%81&quot; aria-label=&quot;1 윈도우 스케줄링 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;1. 윈도우 스케줄링&lt;/h3&gt;
&lt;p&gt;윈도우의 스케줄링 코드는 커널에 구현돼 있지만, 별도의 루틴으로 존재하는 것이 아니라 커널내부에 산재해 있습니다! 이런 작업을 수행하는 루틴들을 합쳐 &lt;strong&gt;Kernel Dispatcher&lt;/strong&gt; 라고 부릅니다 .&lt;/p&gt;
&lt;p&gt;Kernel Dispatcher가 호출 되는 상황의 예시를 몇 가지 들어보겠습니다.!&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;스레드의 퀀텀시간이 종료되는 경우&lt;/p&gt;
&lt;p&gt;이 경우, Dispatcher 가 바로 호출 되는 것이 아니라 아래와 같은 과정을 거치게 됩니다!&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;DIRQL 레벨에서 Timer Interrupt Handler 호출 

-&gt; 해당 핸들러에서 Timer DPC Routine 등록 

-&gt; Dispatcher 호출&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;스레드가 자발적으로 퀀텀시간을 반납하는 경우&lt;/p&gt;
&lt;p&gt;이 경우, 커널 Dispatcher 가 바로 호출되고 대기 중이었던 다른 Thread 가 호출 되게 됩니다.&lt;/p&gt;
&lt;p&gt;이때 만약 대기 중인 스레드가 존재하지 않는다면, Dispatcher는 Idle Thread 를 호출합니다.&lt;/p&gt;
&lt;p&gt;( 참고로, Idle Thread는 CPU 개수만큼 존재합니다. !)&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;이렇게 Kernel Dispatcher에서 스케줄링 관련 이벤트가 일어나게 되는데요~  이렇게 스레드의 문맥이 전환이 되면 &lt;strong&gt;Context Switching&lt;/strong&gt; 이 일어나게 됩니다.!&lt;/p&gt;
&lt;p&gt;Context Switching 이란 현재 실행 중인 스레드와 관련된 휘발성 프로세서 정보를 저장한 후 새로운 스레드의 상태 값을 가져와 새로운 스레드의 실행을 시작하는 과정을 말합니다!&lt;/p&gt;
&lt;p&gt;휘발성 프로세서 정보가 무엇일까여 ?!&lt;/p&gt;
&lt;p&gt;일반적으로 Context Switching  에서는 다음의 자료들을 저장합니다!&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Instruction Pointer&lt;/li&gt;
&lt;li&gt;Kernel Stack Pointer&lt;/li&gt;
&lt;li&gt;Process의 Page Table Directory Pointer &lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;참고로 마지막에 쓴 프로세스의 페이지 테이블 디렉토리 포인터는 CPU의 CR3 레지스터 값에 저장되게 됩니다.!&lt;/p&gt;
&lt;p&gt;커널은 이러한 정보들을 커널모드 스택에 넣고, 스택 포인터를 스레드의 KTHREAD 블록에 저장합니다.&lt;/p&gt;
&lt;p&gt;—&gt; 해당 부분에 대해 다음시간에 Windbg로 분석해보는 시간을 가지려구 합니다 ^^ &lt;/p&gt;
&lt;h3 id=&quot;2-irql&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#2-irql&quot; aria-label=&quot;2 irql permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;2. IRQL&lt;/h3&gt;
&lt;p&gt;IRQL은 인터럽트의 우선순위로, 코어의 개수만큼 존재합니다!!&lt;/p&gt;
&lt;p&gt;x64환경 기준으로 &lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;0 - PASSIVE_LEVEL

1 - APC_LEVEL

2 - DISPATCH_LEVEL

3 ~ 11 - DIRQLs

12 ~ 15 - HIGH_LEVEL&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;이렇게 구성되어 있습니다.&lt;/p&gt;
&lt;p&gt;&lt;u&gt;높은 IRQL의 코드는 낮은 IRQL에서 실행하는 코드를 선점할 수 있습니다!&lt;/u&gt; 이를 &lt;strong&gt;Interrupt Masking&lt;/strong&gt; 이라고 합니다.&lt;/p&gt;
&lt;p&gt;참고로 IRQL 은 스레드 우선순위와는 다릅니다.. 실제로 스레드 우선순위는 IRQL이 2보다 작을 때에만 의미를 가집니다~&lt;/p&gt;
&lt;p&gt;그럼 중요한 IRQL 들 중 0번과 2번에 대해 설명 해 보겠습니다!&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;PASSIVE ( IRQL 0 )&lt;/p&gt;
&lt;p&gt;보통의 스레드 코드가 흐르는 레벨입니다. 특별히 아무것도 발생하지 않고 일반적인 소프트웨어나 드라이버 코드들이 실행되는 레벨 입니다! ( 설명이 이상하네요 .. )&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;DISPATCH_LEVEL ( IRQL 2 )&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;1번 윈도우 스케줄링 개념 설명&lt;/strong&gt; 에서 언급했던 Kernel Dispatcher 가 동작하는 IRQL 입니다! 스레드가 현재 IRQL을 2 이상으로 상승 시키게 되면, 스레드는 기본적으로 &lt;u&gt;무한 퀀텀&lt;/u&gt; 을 갖게 되고, 다른 스레드에 의해 선점될 수 없습니다!!!!!!!!!!&lt;/p&gt;
&lt;p&gt;그럼 여기서 굉장히 중요한 이야기를 해보겠습니다.  &lt;/p&gt;
&lt;p&gt;방금 전에 제가 위에서 Interrupt Masking 에대한 개념을 설명했고, Kernel Dispatcher 는 &lt;strong&gt;IRQL DISPATCH_LEVEL&lt;/strong&gt; 에서 동작한다고 했습니다.!!&lt;/p&gt;
&lt;p&gt;그럼 IRQL이 &lt;strong&gt;DISPATCH_LEVEL&lt;/strong&gt; 이상일 때, 페이징이 발생하면 어떻게 될까요 ???…
이런 경우에 시스템이 크래시 되게 됩니다.! ( 블루스크린이 발생합니다 .. )&lt;/p&gt;
&lt;p&gt;실제로 페이징이 발생한다는 것은 Page Fault 가 처리된다는 것인데요! Page Fault가 처리되는 과정에서 Context Switching 이 일어나기 때문에 Dispatcher 가 호출되게 됩니다.! &lt;/p&gt;
&lt;p&gt;따라서 IRQL 2 또는 그 이상의 레벨에서 실행하는 코드는 NonPaged Memory 만을 접근해야합니다.&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&quot;3-dpc&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#3-dpc&quot; aria-label=&quot;3 dpc permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;3. DPC&lt;/h3&gt;
&lt;p&gt;Deferred Procedure Call 이라 불리는 DPC 루틴은 &lt;strong&gt;IRQL Dispatch_LEVEL&lt;/strong&gt;에서 호출 됩니다.&lt;/p&gt;
&lt;p&gt;주로 DPC는 인터럽트 후처리를 위해 존재합니다.&lt;/p&gt;
&lt;p&gt;IRQL 3 이상의 값을 가지는 루틴에서 .. 스레드를 오랫동안 가지고 있게되면, 우선 순위가 낮은 루틴들은 아무것도 못하게 되잖아여?&lt;/p&gt;
&lt;p&gt;따라서 현재 실행에 꼭 필요한 기능만을 수행하고, 다른 기능들은 DPC 담아 DPC 큐에 등록합니다!&lt;/p&gt;
&lt;p&gt;그럼 나중에 IRQL DISPATCH_LEVEL 에서 등록된 DPC 루틴들이 실행되게 되는 거에요!!&lt;/p&gt;
&lt;p&gt;정확한 순서는 아래와 같습니다.&lt;/p&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 521px; &quot;
    &gt;
      &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 89.66666666666666%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAASABQDASIAAhEBAxEB/8QAGAABAAMBAAAAAAAAAAAAAAAAAAECAwX/xAAUAQEAAAAAAAAAAAAAAAAAAAAA/9oADAMBAAIQAxAAAAHuU0zNkC0BQH//xAAZEAACAwEAAAAAAAAAAAAAAAABEAACMRH/2gAIAQEAAQUCMxcQdc//xAAUEQEAAAAAAAAAAAAAAAAAAAAg/9oACAEDAQE/AR//xAAUEQEAAAAAAAAAAAAAAAAAAAAg/9oACAECAQE/AR//xAAWEAEBAQAAAAAAAAAAAAAAAAAgMUH/2gAIAQEABj8Cg0//xAAbEAEBAQACAwAAAAAAAAAAAAABEQAgMSFBcf/aAAgBAQABPyFPWCp6w00+jSWn1pnh4H//2gAMAwEAAgADAAAAEGAHAP/EABQRAQAAAAAAAAAAAAAAAAAAACD/2gAIAQMBAT8QH//EABQRAQAAAAAAAAAAAAAAAAAAACD/2gAIAQIBAT8QH//EAB0QAQEAAQQDAAAAAAAAAAAAAAERABAxQVEhYaH/2gAIAQEAAT8QdV4cO9wgaTmSZJXGLIXDdT0HOyF71P3n/9k=&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;222AFD385883A84E31&quot;
        title=&quot;222AFD385883A84E31&quot;
        src=&quot;/static/a29a8a787f96d4de7238abb782168175/d52bd/222AFD385883A84E31.jpg&quot;
        srcset=&quot;/static/a29a8a787f96d4de7238abb782168175/f93b5/222AFD385883A84E31.jpg 300w,
/static/a29a8a787f96d4de7238abb782168175/d52bd/222AFD385883A84E31.jpg 521w&quot;
        sizes=&quot;(max-width: 521px) 100vw, 521px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
      /&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;1. 인터럽트 발생
2. 발생한 인터럽트가 IRQL 이 높을 경우 현 상태를 저장하고 IDT를 참조하여 ISR 실행
3. ISR이 동작하면서 CPU의 IRQL을 올림
4. 덜 중요한 작업들은 Dpc 큐에 넣음
5. ISR 이 종료되면 IRQL 이 DPC 레벨로 낮아짐
6. DPC의 인터럽트들을 실행하고 큐의 모든 객체를 실행한 다음 원래 Thread로 복귀 &lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h2 id=&quot;3-실습&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#3-%EC%8B%A4%EC%8A%B5&quot; aria-label=&quot;3 실습 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;3. 실습&lt;/h2&gt;
&lt;p&gt;실습을 위해 유저모드 Application과 레거시 드라이버. 이렇게 두 가지를 작성하였으며, 글에서는 코드 일부만 첨부하였습니다.!&lt;/p&gt;
&lt;p&gt;글 초반에서 언급했듯이, 실습해볼 내용은 다음과 같습니다.!&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;UserMode Application에서 제가 작성한 드라이버코드로 Read 요청을 보내 ReadDispatch를 호출 시킵니다.&lt;/li&gt;
&lt;li&gt;드라이버의 ReadDispatch에서 &lt;code class=&quot;language-text&quot;&gt;KeSetTimer()&lt;/code&gt; 함수로 timer 10초 세팅 + DPC 루틴 등록 후 실행 시킵니다.!&lt;/li&gt;
&lt;li&gt;10초 뒤 호출된 DPC 루틴에서 &lt;code class=&quot;language-text&quot;&gt;KeDelayExecutionThread()&lt;/code&gt; 함수를 사용하여 자발적으로 퀀텀 시간을 반납해줍니다.&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;3번 까지 실행되고 나면..  블루스크린을 볼 수 있을 텐데요 ㅎㅎ&lt;/p&gt;
&lt;p&gt;코드는 아래와 같습니다.&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;irql_test.sys&lt;/li&gt;
&lt;/ul&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;c++&quot;&gt;&lt;pre class=&quot;language-c++&quot;&gt;&lt;code class=&quot;language-c++&quot;&gt;NTSTATUS ReadDispatch(PDEVICE_OBJECT pDevObj, PIRP pIrp) {
	
	PDEVICE_EXTENSION pDE;
	pDE = (PDEVICE_EXTENSION)pDevObj-&amp;gt;DeviceExtension;

	pIrp-&amp;gt;IoStatus.Status = STATUS_SUCCESS;

	pDE-&amp;gt;pPendingIrp = pIrp;
	IoMarkIrpPending(pIrp); // 비동기 IO 완료를 위해 필요

	LARGE_INTEGER Result;
	Result.QuadPart = -1 * 10 * 10000000; // 10초 타이머 세팅 
	KeSetTimer(&amp;amp;pDE-&amp;gt;Timer, Result, &amp;amp;pDE-&amp;gt;Dpc);

	return STATUS_PENDING;  // 비동기 IO 완료를 위해 필요

}&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;c++&quot;&gt;&lt;pre class=&quot;language-c++&quot;&gt;&lt;code class=&quot;language-c++&quot;&gt;VOID DpcRoutine(
	struct _KDPC* Dpc,
	PVOID  DeferredContext,
	PVOID  SystemArgument1,
	PVOID  SystemArgument2
)
{
	PDEVICE_EXTENSION pDE = DeferredContext;
	UNREFERENCED_PARAMETER(Dpc);
	UNREFERENCED_PARAMETER(SystemArgument1);
	UNREFERENCED_PARAMETER(SystemArgument2);


    LARGE_INTEGER Result;
    Result.QuadPart = -1 * 10 * 10000000; //10초 설정 

    KeDelayExecutionThread(KernelMode, FALSE, &amp;amp;Result);
	
	IoCompleteRequest(pDE-&amp;gt;pPendingIrp, IO_NO_INCREMENT); 
}&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;ul&gt;
&lt;li&gt;application.c&lt;/li&gt;
&lt;/ul&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;c++&quot;&gt;&lt;pre class=&quot;language-c++&quot;&gt;&lt;code class=&quot;language-c++&quot;&gt;	handle = CreateFileW(L&amp;quot;\\??\\IRQL&amp;quot;, GENERIC_READ | GENERIC_WRITE, 0, NULL, OPEN_EXISTING, 0, NULL);

	bRet = ReadFile(handle, NULL, NULL, NULL, NULL);&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;다음으로 실제 가상환경에서 해당 드라이버 코드를 실행 시킨 후 WinDBG로 확인하는 과정을 하나씩 하나씩 살펴보겠습니당.&lt;/p&gt;
&lt;p&gt;우선 드라이버를 가상환경에 올려줍시다!&lt;/p&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 966px; &quot;
    &gt;
      &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 27.666666666666668%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAGCAYAAADDl76dAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAnklEQVQY04WRTQuEIBRF22ZlZqX2QStx4f//f3e4DxqEGmdx4fJ4Ho/YbNuG67qw7zucc5jnGeu6YhgG9H2PruseKefsZRpCCNRaC4RJKcnMWitzZhxHCfsb6AskIMaI4zhA22makHOWTtsQApZlgfdeOgWqQFoQwEO8/Ya2bQul1GuqTybwPE8YY2SBxjWDG/bTkCDa3R9RLv8Dv+UD4DKNNFRJ9DIAAAAASUVORK5CYII=&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;image-20211129021308727&quot;
        title=&quot;image-20211129021308727&quot;
        src=&quot;/static/fb100fa1aa50c995ab9af83a0fdcf5e3/5bf79/image-20211129021308727.png&quot;
        srcset=&quot;/static/fb100fa1aa50c995ab9af83a0fdcf5e3/5a46d/image-20211129021308727.png 300w,
/static/fb100fa1aa50c995ab9af83a0fdcf5e3/0a47e/image-20211129021308727.png 600w,
/static/fb100fa1aa50c995ab9af83a0fdcf5e3/5bf79/image-20211129021308727.png 966w&quot;
        sizes=&quot;(max-width: 966px) 100vw, 966px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
      /&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;이제 해당 환경에 Windbg를 붙이고 제 드라이버의 ReadDispatch 루틴과 DpcRoutine에 break point를 걸어줍니다!&lt;/p&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 479px; &quot;
    &gt;
      &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 14.666666666666666%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAADCAYAAACTWi8uAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAdklEQVQI143H0QoCIRSEYd//1UQIwhITzBtXPW5rbm3eTYei22rg42dEjBEhBHjvceaenIMxBkopSCmh9QHWWowx8M8EUUHOCZUIJWeWMNcKKpmVV9tywWO747Z2tn4ldtpif3SYqCHN/a1euR8dE/9IC2s/PQHtnuHch7xJzwAAAABJRU5ErkJggg==&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;image-20211129022043078&quot;
        title=&quot;image-20211129022043078&quot;
        src=&quot;/static/41f1b5d06aa771b642c0b5180ffda9f9/a9b70/image-20211129022043078.png&quot;
        srcset=&quot;/static/41f1b5d06aa771b642c0b5180ffda9f9/5a46d/image-20211129022043078.png 300w,
/static/41f1b5d06aa771b642c0b5180ffda9f9/a9b70/image-20211129022043078.png 479w&quot;
        sizes=&quot;(max-width: 479px) 100vw, 479px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
      /&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;이렇게 세팅한 후 가상환경에서 application을 실행시키면, ReadDispatch에 bp 가 걸리게 됩니다.!&lt;/p&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 575px; &quot;
    &gt;
      &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 10.999999999999998%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAACCAYAAABYBvyLAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAWUlEQVQI15XN0QZAIRCE4d7/7brpJrYoiohkFdEczRuc5bv7zRprLZxzCCEgpYRSCuacOOfg3vvLOyMiHHq894gxUs4ZvXdGqoq1Fp/UWjHGoNYavW7vzfYDO8qYvJJdLQEAAAAASUVORK5CYII=&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;image-20211129021910788&quot;
        title=&quot;image-20211129021910788&quot;
        src=&quot;/static/d8afc499fab80cd3d81623cf8dbfd4c9/59415/image-20211129021910788.png&quot;
        srcset=&quot;/static/d8afc499fab80cd3d81623cf8dbfd4c9/5a46d/image-20211129021910788.png 300w,
/static/d8afc499fab80cd3d81623cf8dbfd4c9/59415/image-20211129021910788.png 575w&quot;
        sizes=&quot;(max-width: 575px) 100vw, 575px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
      /&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;이 때의  IRQL 레벨과 실행중인 스레드를 확인해 볼까요 ?&lt;/p&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 690px; &quot;
    &gt;
      &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 21%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAECAYAAACOXx+WAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAoUlEQVQY042PWQqFMBAEvf/FvICgKG64gFsWoyBGbel58L4dKJoOQzEJkiRB27ZI0xTzPGPfd0Ep9ec8TzzPA++9cN+3cF2XdCY7JwjDEJRmWSbSsixRFAW6rkNVVfLOrOsay7IIzjms6wqtNYwxsNbiOI6fkIu8LM9zDMOAKIoQxzGapsG2bZLc4SVfJqCo73tM0yTicRwlKed32Qmv+MILHRQuv1tKL0wAAAAASUVORK5CYII=&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;image-20211129022227084&quot;
        title=&quot;image-20211129022227084&quot;
        src=&quot;/static/fe3cd50360bc4839e8ee4b291fcedf23/1e043/image-20211129022227084.png&quot;
        srcset=&quot;/static/fe3cd50360bc4839e8ee4b291fcedf23/5a46d/image-20211129022227084.png 300w,
/static/fe3cd50360bc4839e8ee4b291fcedf23/0a47e/image-20211129022227084.png 600w,
/static/fe3cd50360bc4839e8ee4b291fcedf23/1e043/image-20211129022227084.png 690w&quot;
        sizes=&quot;(max-width: 690px) 100vw, 690px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
      /&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;참고로 prcb 구조체는 windows가 cpu를 추상화한 구조체 입니다.!
prcb 값을 확인해 보면 현재 IRQL LEVEL 은 PASSIVE(0) 이고, 현재 Thread는 &lt;code class=&quot;language-text&quot;&gt;ffffcb82292d3080&lt;/code&gt; 인 것을 확인할 수 있는데요! 해당 스레드에 대한 정보를 확인해보겠습니다.!&lt;/p&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 729px; &quot;
    &gt;
      &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 32%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAGCAYAAADDl76dAAAACXBIWXMAAAsTAAALEwEAmpwYAAABB0lEQVQY05WQiY6DMAxE+f+fQ4ij5RIIUCkhlDuBdtXZTFZ8wFqx5ITxGxsnSVMkRYOqlXg8O7Rti74XeM0b5HJAyBFb1+EYXth7CdUJrEEIVTfQ54mfzwdXfEztBEGAJEmglYLSJxox4zmsEEJgWhYDGrC6HmY/wBZGUAYGA7Lx/Zrzl4zjOOBEUWSnklJaSFEUmKYJ4zhCGZP/xGmMnNvthtSsHYahnTTLMtzvd+R5jrqu0TSNNVT7Dq21nYLJmgCaMt/vNzajsSsTGsexTYLKsoTv+9aEZjTgt+v3sOZm1FHvuq7V1sbc8TzPNlPE6dhQVZWFXKDLkE18I5g9hFHPO43necYvq8u9eHbvLykAAAAASUVORK5CYII=&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;image-20211129022634188&quot;
        title=&quot;image-20211129022634188&quot;
        src=&quot;/static/7bdf0bae13224e570206f80df359e50f/b2982/image-20211129022634188.png&quot;
        srcset=&quot;/static/7bdf0bae13224e570206f80df359e50f/5a46d/image-20211129022634188.png 300w,
/static/7bdf0bae13224e570206f80df359e50f/0a47e/image-20211129022634188.png 600w,
/static/7bdf0bae13224e570206f80df359e50f/b2982/image-20211129022634188.png 729w&quot;
        sizes=&quot;(max-width: 729px) 100vw, 729px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
      /&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;당연히 제가 실행시킨 application의 컨택스트 이구여! ( 해당 application 이름은 ConsolApplication1.exe 가 맞습니다. )&lt;/p&gt;
&lt;p&gt;현재 Running 상태인 것을 확인해 볼 수 있습니다.&lt;/p&gt;
&lt;p&gt;아까 위에 첨부한 코드에서 알 수 있듯이, ReadDispatch 내부에서 10초 타이머를 세팅 시켰는데요~ 실제로 디버거를 Go 시키게 되면 10초 뒤에 DpcRoutine의 break point가 잡히게 됩니다.&lt;/p&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 629px; &quot;
    &gt;
      &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 10.999999999999998%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAACCAYAAABYBvyLAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAc0lEQVQI102MUQrDIABDe/+zDQb76ToYWJ04RAWLKIL2rRYKC4QkEN6k9Jfb/cFznpFKIaUkhECtldYa+74zdGXv/fTYI8fnX9PHWObXG3WAxLqyLAtCCNQBN8YQY2TbNrz3pJTQWmOtxTl39utTSiHnzA8Rv5e7MAUrZgAAAABJRU5ErkJggg==&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;image-20211129023101129&quot;
        title=&quot;image-20211129023101129&quot;
        src=&quot;/static/faf6890aea336e4afe99346c57455f3a/63a68/image-20211129023101129.png&quot;
        srcset=&quot;/static/faf6890aea336e4afe99346c57455f3a/5a46d/image-20211129023101129.png 300w,
/static/faf6890aea336e4afe99346c57455f3a/0a47e/image-20211129023101129.png 600w,
/static/faf6890aea336e4afe99346c57455f3a/63a68/image-20211129023101129.png 629w&quot;
        sizes=&quot;(max-width: 629px) 100vw, 629px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
      /&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;오오 위에 사진에서 보시다시피 DpcRoutine에서 멈췄습니다.
이 때의 IRQL LEVEL은 몇일까요!?  당연히 Dispatch Level 이겠죠?&lt;/p&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 649px; &quot;
    &gt;
      &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 17.333333333333336%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAADCAYAAACTWi8uAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAn0lEQVQI132OvQ6CMACEef9nMW46oINGJ2lcGiOFBktbEv7ahMLGzwl9AIYvueW+u+ATXiFfEeLbHToisEkK1/do2xZ1XaNpGhhjMI4jpmnCPM+7BO/DEfR0hnw8kYQXqFX+EwJaa1RVBaWUJ89zFEXhR7aBruvgnPN5w1qLYRgQ0G8MISUY5xBrkfEUhBAwxlCWpZdQSpFlmX+5LMsufycG3zamLKBNAAAAAElFTkSuQmCC&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;image-20211129023437141&quot;
        title=&quot;image-20211129023437141&quot;
        src=&quot;/static/ebc1c8ce5a5cacff08d8e8556c8d1f12/7762d/image-20211129023437141.png&quot;
        srcset=&quot;/static/ebc1c8ce5a5cacff08d8e8556c8d1f12/5a46d/image-20211129023437141.png 300w,
/static/ebc1c8ce5a5cacff08d8e8556c8d1f12/0a47e/image-20211129023437141.png 600w,
/static/ebc1c8ce5a5cacff08d8e8556c8d1f12/7762d/image-20211129023437141.png 649w&quot;
        sizes=&quot;(max-width: 649px) 100vw, 649px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
      /&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;그럼 이때의 스레드는 누구일까요 ??&lt;/p&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 732px; &quot;
    &gt;
      &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 12%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAACCAYAAABYBvyLAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAdklEQVQI132NQQ7CIBREe/+TaeIKYtt0Q2n5IAKljd1p8sQL+JJJZvNmOq0198kwmMAaK6sTZrvgRCjbjoSK+I0YEnFZyN6TcuupxczI5UqxllQyx7HTKaXo+6ENOX6EcnKbIr28yKni2+HWxHfKPMaRT3zyjy+PVpVBj7IFxAAAAABJRU5ErkJggg==&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;image-20211129023843207&quot;
        title=&quot;image-20211129023843207&quot;
        src=&quot;/static/eb3c70be36d0c0387ad2051240714f46/d0cc0/image-20211129023843207.png&quot;
        srcset=&quot;/static/eb3c70be36d0c0387ad2051240714f46/5a46d/image-20211129023843207.png 300w,
/static/eb3c70be36d0c0387ad2051240714f46/0a47e/image-20211129023843207.png 600w,
/static/eb3c70be36d0c0387ad2051240714f46/d0cc0/image-20211129023843207.png 732w&quot;
        sizes=&quot;(max-width: 732px) 100vw, 732px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
      /&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;ConsolApplication 스레드가 아닌 다른 스레드입니다! 여기서는 System 스레드 였네요 ㅎㅎ&lt;/p&gt;
&lt;p&gt;이제  &lt;code class=&quot;language-text&quot;&gt;kd &gt; u fffff805556a1030 L20&lt;/code&gt; 커맨드로 어셈블리를 확인한 후 &lt;code class=&quot;language-text&quot;&gt;KeDelayExecutionThread()&lt;/code&gt;에 bp를 걸어 보겠습니다! ( 굳이 bp를 거는 이유는 .. 블루스크린이 뜨기 전의 마지막 드라이버코드이기 때문입니다.. )&lt;/p&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 724px; &quot;
    &gt;
      &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 31.333333333333336%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAGCAYAAADDl76dAAAACXBIWXMAAAsTAAALEwEAmpwYAAABLklEQVQY022Q606DQBCFef/3sdEa/aXRKC0sXVjYxVIsbVruxWojtpwOGzWYOMnJzJ5kvp0Zg7sCYRiCcw6lFJgbIElrbMo3rCjLxRpRsgUPIqyzGs3hqLU/tGjbT/TRdZ1WH4ZlMwjhaaDnebAtC+/7PfI8R5am2kuWS/pUoSgKfBPwE92g1kDH4ZBBAJeAQghYBGyaBlVZakDvRfO5BseLGAPS72RDGTZ34SsJTo1CBniamCjrWiuvSvIkFAEtxvASRWiPR3xR4wn/h8EeHqFoKt80KdsIbRtF/IoN3TUjQDCdYi1p3ThGnaxQ0fpVkuAjzdDRJqfdXxl8dAl/fI3ZxQjq5hbx3T12MxepOcH22YS4GiObWrrOKVdshpLuXjuUmYPG9chz6M2pj+MMhda6j2viujsAAAAASUVORK5CYII=&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;image-20211129024314132&quot;
        title=&quot;image-20211129024314132&quot;
        src=&quot;/static/a7a88f83242aacc5339c9bd2b3678742/a242d/image-20211129024314132.png&quot;
        srcset=&quot;/static/a7a88f83242aacc5339c9bd2b3678742/5a46d/image-20211129024314132.png 300w,
/static/a7a88f83242aacc5339c9bd2b3678742/0a47e/image-20211129024314132.png 600w,
/static/a7a88f83242aacc5339c9bd2b3678742/a242d/image-20211129024314132.png 724w&quot;
        sizes=&quot;(max-width: 724px) 100vw, 724px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
      /&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 268px; &quot;
    &gt;
      &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 12.686567164179104%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAADCAYAAACTWi8uAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAeklEQVQI152NuQoEIRBE5/9/TUFGPIIBDU1MPEDBo3Zs2GyjfUlXV/Vx4aW1hlor5pxUxxjkpZRQSkHOmfTJeu/Un/yrT3Z2Dtd8hfceQgga4pzDOYcQArTWeJ4HxhjyrbWIMZKWUkIphfu+wRijZ3QQP1hr4R/23vgAHDTlDYk5KfMAAAAASUVORK5CYII=&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;image-20211129024346385&quot;
        title=&quot;image-20211129024346385&quot;
        src=&quot;/static/fe91faf07f0772ce044429c9d004a0dd/484ae/image-20211129024346385.png&quot;
        srcset=&quot;/static/fe91faf07f0772ce044429c9d004a0dd/484ae/image-20211129024346385.png 268w&quot;
        sizes=&quot;(max-width: 268px) 100vw, 268px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
      /&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;그럼 이제 이어서 실행해보겟습니다!!&lt;/p&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 1200px; &quot;
    &gt;
      &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 69.33333333333334%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAOCAYAAAAvxDzwAAAACXBIWXMAAAsTAAALEwEAmpwYAAACJ0lEQVQ4y42RTW8SURSGD4Ng47ddWK2K8rHSxIULoytLxYUbVy6MpjSRWhfQVG0ZGGjRpH4uXLjxN7gwxmrU+BeMiYlxmCm01igmuqAUlVIL5PXcGSDTaQ1O8uSce+fmue+9lxZKiygtFFEu/kD5+xdUy0XUKmUs/SyhylQWiwa16i80liuoL/+2YI4bf5ZQrzewslID9Qf7EDxzFqHBMfRfHEVo4BpOh8dwauD6GkKW2iY8jtCFKE72BREOD4L4A3UfBo28B8XegaJNYutgn4++BV39CDr/WIiwu2cXSOJG8p6AM52HlNTgTusGkqLDqZi11a8hmYVzch4bhl+yUEIg4G8m9BwDJXU4EiqOPpzDxlQWJKugRAfinC41C0fkuZHQ7/NahTOQElkcejBr7Exx1ZQK4hZkaxXCOYvQt1ooEu67nYP3Xh57uXru5ozaMzWD/XdyOMjzovdw38vzvVM6um99Bl36R0JxjJ03eNFNHdu5bp7UDLZldOzg8VauXWnN+Cd6kjscWSQU6Xz3xQNlzUsXKCYuvlt3SoNL9IxbUeHOfII0tN6RE2YiebqA8WffjBSCVrot/E/IWgi5K6nCZREG/DbhpgkNsScFjDwtsNwci01EFYnbjyRbH8Vy5NVCzVjQlVL5nrLmYjuyjfgHFuZZOG0THjgOmpg3diMlbyL6Tig5UOYrHMOvbcI9R0CXX4EiL0BDTSL/Ax/1yhs4zj1qC/8CxPhpzrN8NaMAAAAASUVORK5CYII=&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;image-20211130212319831&quot;
        title=&quot;image-20211130212319831&quot;
        src=&quot;/static/35ee502496cc568878c891c836b1124c/c1b63/image-20211130212319831.png&quot;
        srcset=&quot;/static/35ee502496cc568878c891c836b1124c/5a46d/image-20211130212319831.png 300w,
/static/35ee502496cc568878c891c836b1124c/0a47e/image-20211130212319831.png 600w,
/static/35ee502496cc568878c891c836b1124c/c1b63/image-20211130212319831.png 1200w,
/static/35ee502496cc568878c891c836b1124c/5c98f/image-20211130212319831.png 1283w&quot;
        sizes=&quot;(max-width: 1200px) 100vw, 1200px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
      /&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;예상대로 블루스크린을 확인할 수 있습니다.&lt;/p&gt;
&lt;p&gt;오늘은 이렇게 IRQL 인터럽트 마스킹 개념에 대해 알아 보았습니다!!!&lt;/p&gt;
&lt;p&gt;커널을 공부한다는 건 정말 재밌는 일 같아요 ㅎㅎ  다음에는 컨텍스트 스위칭이 일어나는 과정을 분석 해보거나, 다양한 버그체크 덤프들을 분석하는 글을 포스팅 해보려고 합니다.!&lt;/p&gt;
&lt;h2 id=&quot;참고&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%EC%B0%B8%EA%B3%A0&quot; aria-label=&quot;참고 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;참고&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;https://rockball.tistory.com/7&quot;&gt;https://rockball.tistory.com/7&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://www.youtube.com/channel/UC7Ek4hbKRdWT1idaZLz-F_Q&quot;&gt;https://www.youtube.com/channel/UC7Ek4hbKRdWT1idaZLz-F_Q&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;[Windows Internals, Part 1]&lt;/li&gt;
&lt;/ul&gt;</content:encoded></item><item><title><![CDATA[Category Test2]]></title><link>https://hyunjungg.github.io/template/</link><guid isPermaLink="false">https://hyunjungg.github.io/template/</guid><pubDate>Thu, 02 Jul 2020 16:21:13 GMT</pubDate><content:encoded></content:encoded></item><item><title><![CDATA[Category Test2]]></title><description><![CDATA[Test2]]></description><link>https://hyunjungg.github.io/security/test2/</link><guid isPermaLink="false">https://hyunjungg.github.io/security/test2/</guid><pubDate>Thu, 02 Jul 2020 16:21:13 GMT</pubDate><content:encoded>&lt;p&gt;Test2&lt;/p&gt;</content:encoded></item><item><title><![CDATA[about]]></title><description><![CDATA[Your name Thank you for reading my resume. If you want to contact me, Please send me an email.]]></description><link>https://hyunjungg.github.io/resume-ko/</link><guid isPermaLink="false">https://hyunjungg.github.io/resume-ko/</guid><pubDate>Sun, 27 Jan 2019 16:21:13 GMT</pubDate><content:encoded>&lt;h1 id=&quot;your-name&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#your-name&quot; aria-label=&quot;your name permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Your name&lt;/h1&gt;
&lt;div align=&quot;center&quot;&gt;
&lt;p&gt;&lt;em&gt;Thank you for reading my resume. If you want to contact me, Please send me an email.&lt;/em&gt;&lt;/p&gt;
&lt;/div&gt;</content:encoded></item></channel></rss>