<?xml version="1.0" encoding="UTF-8"?><rss xmlns:dc="http://purl.org/dc/elements/1.1/" xmlns:content="http://purl.org/rss/1.0/modules/content/" xmlns:atom="http://www.w3.org/2005/Atom" version="2.0"><channel><title><![CDATA[Hyunjung's Blog]]></title><description><![CDATA[보안과 개발을 좋아하는 학생입니다~^^]]></description><link>https://hyunjungg.github.io</link><generator>GatsbyJS</generator><lastBuildDate>Sun, 05 Mar 2023 08:46:45 GMT</lastBuildDate><item><title><![CDATA[Detecting Format String Bugs with Libdft]]></title><description><![CDATA[본 글에서는 DTA라이브러리인 LIBDFT64를 사용하는 방법을 간단한 예제와 함께 설명합니다.  1. LIBDFT64?  기존에 많이 알려져 있는 libdft는 32비트 바이너리만 지원하는데, 리서치 도중 64비트 호환이 가능하게 libdft6…]]></description><link>https://hyunjungg.github.io/binary_analysis/Detecting_FSB_with_DTA/</link><guid isPermaLink="false">https://hyunjungg.github.io/binary_analysis/Detecting_FSB_with_DTA/</guid><pubDate>Sun, 05 Mar 2023 16:58:13 GMT</pubDate><content:encoded>&lt;p&gt;본 글에서는 DTA라이브러리인 LIBDFT64를 사용하는 방법을 간단한 예제와 함께 설명합니다. &lt;/p&gt;
&lt;h1 id=&quot;1-libdft64&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#1-libdft64&quot; aria-label=&quot;1 libdft64 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;1. LIBDFT64?&lt;/h1&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 497px; &quot;
    &gt;
      &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 51%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAYAAAC0VX7mAAAACXBIWXMAAAsTAAALEwEAmpwYAAABr0lEQVQoz5VRTU/bQBTcP98LP4ELogckKqpyqEAgxKGHViQpiJBA4ny5QFI7ru2s19jr/fCwuw4RqEJVLY1m3vN69r0xwX88dV1vuJE1tNZGa8e2JmVZ4rrbw3TmYzSeYDyZonvTx+N84fTQG7l+xtgrs8aY5hzbpz6OOwvHeSlAWJ7jdjDEZDpDq/PTGXR7fTw8zuGNxvDWlwgp/zJcxAW2Dif41g2w9WWMiJYgQRBib/8AX49OsPNxz+lPnw8x8+//uTorOHbOfHw4GGH33EfBK5CqqrD4HeDX/QPCZYQgDB1sFDYopZSDXk/WZNZkWBstBcc8YlCGbU2EEIiiGOmKYkUpknQFSjPEcWqMl4iT1L23oBlz/T9xgqoSzbSbqRsQabKxBtYwMR9bQ5trmlLXe2fnN3lqXW9eESUkmDGE++1wnJmaF2ZlczAzpqm5SJqJLLu+NVJ6A1tn7AlFyUGsN1MC1GSQawllay0Ql0/QTkuEjLrVEl6AyurtsGsuuIJUduW2B9nxUP64RfG9D9EaQK3rF11dDODOtYfgF3cQhl+gWx6W7R4ury5xZfAM3hP2w8ntdsQAAAAASUVORK5CYII=&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;[https://github.com/AngoraFuzzer/libdft64](https://github.com/AngoraFuzzer/libdft64)&quot;
        title=&quot;[https://github.com/AngoraFuzzer/libdft64](https://github.com/AngoraFuzzer/libdft64)&quot;
        src=&quot;/static/ef778d9dd1ecac1886175fc3646d10c5/15d25/Untitled.png&quot;
        srcset=&quot;/static/ef778d9dd1ecac1886175fc3646d10c5/5a46d/Untitled.png 300w,
/static/ef778d9dd1ecac1886175fc3646d10c5/15d25/Untitled.png 497w&quot;
        sizes=&quot;(max-width: 497px) 100vw, 497px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
      /&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;기존에 많이 알려져 있는 &lt;a href=&quot;https://www.cs.columbia.edu/~vpk/research/libdft/&quot;&gt;libdft&lt;/a&gt;는 32비트 바이너리만 지원하는데, 리서치 도중 64비트 호환이 가능하게 &lt;a href=&quot;https://github.com/AngoraFuzzer/libdft64&quot;&gt;libdft64&lt;/a&gt; 프로젝트를 진행해 주신 분이 계셔서 사용해 보았습니다.!&lt;/p&gt;
&lt;p&gt;Libdft는 인텔의 Pin을 기반으로 작성된 DTA 라이브러리 입니다. 현재 알려진 DTA 라이브러리 중 가장 많이 사용되고 있습니다.&lt;/p&gt;
&lt;p&gt;MMX나 SSE와 같은 확장 명령어는 지원하고 있지 않으므로, 분석 대상 프로그램 컴파일 시 해당 명령어들이 포함되지 않게 해주셔야 합니다.! gcc 의 경우 &lt;code class=&quot;language-text&quot;&gt;-mno-{mmx, sse, sse2, sse3}&lt;/code&gt; 를 추가해주시면 됩니당.&lt;/p&gt;
&lt;h1 id=&quot;2-dta&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#2-dta&quot; aria-label=&quot;2 dta permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;2. DTA?&lt;/h1&gt;
&lt;h2 id=&quot;a-dta란-무엇인가&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#a-dta%EB%9E%80-%EB%AC%B4%EC%97%87%EC%9D%B8%EA%B0%80&quot; aria-label=&quot;a dta란 무엇인가 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;A. DTA란 무엇인가?&lt;/h2&gt;
&lt;p&gt;DTA (Dynamic Taint Analysis)는 프로그램에서 사용자 입력 값으로 인해 어떤 레지스터와 메모리 영역이 제어 가능한지 확인하는 기법입니다. &lt;/p&gt;
&lt;p&gt;런타임 정보를 사용하므로 STA(정적 오염 분석) 보다 결과의 신뢰도가 높습니다.
또한 정적 분석은 컴파일 시점에 오염 분석 기능을 삽입하기 때문에 소스코드가 제공되는 경우에만 가능합니다. 이에 반해 DTA는 빌드 된 바이너리에 분석 기능 삽입이 가능합니다.  (&lt;a href=&quot;https://www.zerodayinitiative.com/blog/2022/2/14/static-taint-analysis-using-binary-ninja-a-case-study-of-mysql-cluster-vulnerabilities&quot;&gt;Binary Ninja 등의 툴을 활용하면  정적 분석도 바이너리 레벨에서 taint analyze가 가능하긴 합니다!&lt;/a&gt;)&lt;/p&gt;
&lt;p&gt;하지만 DTA를 수행하면 계측 대상 프로그램이 성능상 엄청난 부하를 감수할 수밖에 없습니다. 아주 최적화된 방법을 사용하더라도 10배 혹은 그 이상의 성능 저하가 발생합니다..ㅠㅠ&lt;/p&gt;
&lt;h2 id=&quot;b-퍼징과-다른-점&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#b-%ED%8D%BC%EC%A7%95%EA%B3%BC-%EB%8B%A4%EB%A5%B8-%EC%A0%90&quot; aria-label=&quot;b 퍼징과 다른 점 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;B. 퍼징과 다른 점?&lt;/h2&gt;
&lt;p&gt;DTA도 퍼징처럼 소프트웨어 취약점을 이용해서 나타날 수 있는 소프트웨어의 오류를 찾아내고 대처할 수 있는 분석 방법 중 하나입니다.&lt;/p&gt;
&lt;p&gt;퍼징은 버그를 탐지할 때 주로 외부에 드러나는 현상을 중심으로 관찰합니다. 특히 프로그램의 Crashing, Hanging 현상을 활용합니다. &lt;/p&gt;
&lt;p&gt;이처럼 일반적인 퍼징이 주로 관찰 가능한 버그만 찾을 수 있는 상황에 사용하는 것이라면, DTA는 정보 유출 혹은 Logical Bugs 등 충돌이 발생하지 않는 버그에 사용됩니다.&lt;/p&gt;
&lt;h2 id=&quot;c-dta의-세-가지-요소&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#c-dta%EC%9D%98-%EC%84%B8-%EA%B0%80%EC%A7%80-%EC%9A%94%EC%86%8C&quot; aria-label=&quot;c dta의 세 가지 요소 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;C. DTA의 세 가지 요소&lt;/h2&gt;
&lt;p&gt;큰 시각에서 봤을 때 오염 분석은 세 가지 요소를 정의하는 과정으로 출발합니다. 먼저 &lt;strong&gt;Taint Source&lt;/strong&gt;를 설정하고, &lt;strong&gt;Taint Sink&lt;/strong&gt;를 정의한 후 &lt;strong&gt;Taint Propagation&lt;/strong&gt;를 추적합니다. &lt;/p&gt;
&lt;p&gt;(실제 DTA툴 개발 시, 개발자는 앞 두 가지만 정의하면 됩니다. &lt;strong&gt;Taint Progatation&lt;/strong&gt;은 통상적으로 라이브러리가 지원해 줍니다.)&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;Detecting_FSB_with_DTA%5CUntitled%201.png&quot; alt=&quot;Untitled&quot;&gt;&lt;/p&gt;
&lt;p&gt;용어 설명 전, 이해를 돕기 위해 아주 쉬운 예시 상황을 설정하겠습니다.&lt;/p&gt;
&lt;p&gt;서버와 클라이언트가 send와 recv함수를 사용해 통신합니다. 이때 사용자가 악의적으로 버퍼오버플로우를 일으켜 exec_buf 값을 수정하여 원하는 명령어를 실행할 수 있습니다.&lt;/p&gt;
&lt;p&gt;위와 같은 상황을 탐지하기 위해서는 각 요소를 어떻게 설정해야 할까여??&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Taint Source&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;추적하고자 선택한 특정 데이터의 프로그램 내 위치입니다. 위 상황에서는 &lt;strong&gt;recv&lt;/strong&gt;함수가 해당됩니다.&lt;/p&gt;
&lt;p&gt;따라서 분석 툴 개발 시 recv 시스템 콜 콜백함수를 사용하면 됩니다.&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Taint Sink&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;오염된 데이터(Taint Source로 설정한 데이터)로부터 영향을 받았는지 여부를 확인하고자 하는 프로그램 내의 위치입니다.&lt;/p&gt;
&lt;p&gt;위 상황에서는 &lt;strong&gt;execve&lt;/strong&gt;함수가 됩니다.&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Taint Propagation&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;프로그램 내에서 오염된 데이터가 어떻게 흘러가는지 추적하려면 해당 데이터를 처리하는 모든 명령어에 대해 계측을 수행해야 합니다. mov, xor, shl 와 같은 모~든 명령어를 계측하여 일부 바이트라도 영향을 미치면 전부 오염시킵니다. &lt;/p&gt;
&lt;p&gt;이 부분은 Taint Policy의 영향을 받습니다. Taint Policy에 대해서는 바로 다음 파트에서 설명하겠습니당.&lt;/p&gt;
&lt;h2 id=&quot;d-taint-policy&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#d-taint-policy&quot; aria-label=&quot;d taint policy permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;D. Taint Policy&lt;/h2&gt;
&lt;p&gt;DTA 시스템에서 오염이 전파되는 기준에 대한 정의입니다.  또한 중첩된 오염이 발생한 경우 색깔을 어떻게 merge해 표기할지를 정의합니다. &lt;/p&gt;
&lt;p&gt;몇 가지 X64 명령어를 예시로 설명합니다.&lt;/p&gt;
&lt;p&gt;참고로 아래 설명에서 T는 Taint(오염된) 메모리를 의미합니다.&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;MOV&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;img src=&quot;Detecting_FSB_with_DTA%5CUntitled%202.png&quot; alt=&quot;Untitled&quot;&gt;&lt;/p&gt;
&lt;p&gt;mov 같은 단순한 연상의 경우 전파되는 규칙이 명확합니다.&lt;/p&gt;
&lt;p&gt;결과값은 단순히 T의 복사본이기 때문에 A역시 오염된 메모리 T의 오염 정보를 그대로 전수받습니다.&lt;/p&gt;
&lt;p&gt;결과적으로 이 경우에 Taint merge operation은 &lt;code class=&quot;language-text&quot;&gt;:=&lt;/code&gt; 입니다.(그냥 단순 할당)&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;XOR&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;img src=&quot;Detecting_FSB_with_DTA%5CUntitled%203.png&quot; alt=&quot;Untitled&quot;&gt;&lt;/p&gt;
&lt;p&gt;피연산자가 자기 자신과 동일한 값으로 연산을 수행하는 특수한 xor 연산 상황을 예시로 들겠습니다.&lt;/p&gt;
&lt;p&gt;이 경우 항상 결과는 0이 됩니다.&lt;/p&gt;
&lt;p&gt;따라서 공격자가 아무리 T 값을 조작하려고 해도 결과값에 대해서 아무런 변화를 줄 수가 없게 되겠쬬?&lt;/p&gt;
&lt;p&gt;결과적으로 이 경우의 Taint merge operation은 &lt;code class=&quot;language-text&quot;&gt;Ø&lt;/code&gt; 공집합입니다.&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;SHL&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;img src=&quot;Detecting_FSB_with_DTA%5CUntitled%204.png&quot; alt=&quot;Untitled&quot;&gt;&lt;/p&gt;
&lt;p&gt;변수 T값만큼 A값을 시프트하는 상황입니다. 이러한 경우 T가 한 바이트만 오염되어 있어도 A의 모든 바이트에 영향을 미칠 수 있습니다.&lt;/p&gt;
&lt;p&gt;결과적으로 A의 모든 부분에 오염이 전파됩니다.&lt;/p&gt;
&lt;p&gt;이 경우 오염 정책의 Taint merge operation은 &lt;code class=&quot;language-text&quot;&gt;:=&lt;/code&gt; 가 됩니다.&lt;/p&gt;
&lt;h2 id=&quot;e-한계&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#e-%ED%95%9C%EA%B3%84&quot; aria-label=&quot;e 한계 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;E. 한계..&lt;/h2&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;python&quot;&gt;&lt;pre class=&quot;language-python&quot;&gt;&lt;code class=&quot;language-python&quot;&gt;var &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;while&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;taint&lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; var&lt;span class=&quot;token operator&quot;&gt;+&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;+&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;token comment&quot;&gt;# taint는 오염된 변수를 의미합니다.&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;코드를 보면 공격자가 taint 변수를 통해 var 값을 변조하는 것을 확인할 수 있습니다. &lt;/p&gt;
&lt;p&gt;gcc로 빌드 후 해당 부분의 명령어를 확인해 보면 아래와 같습니다. &lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;Detecting_FSB_with_DTA%5CUntitled%205.png&quot; alt=&quot;Untitled&quot;&gt;&lt;/p&gt;
&lt;p&gt;두 변수 간의 묵시적인 데이터 흐름이 발생하지 않는 것이 확인됩니다.&lt;/p&gt;
&lt;p&gt;결국 DTA는 taint 변수 값이 오염된 상황이지만 var 값은 오염되지 않은 것으로 판단하고 이 결과 과소 오염으로 진단하게 됩니다.&lt;/p&gt;
&lt;h1 id=&quot;3-libdft64-설치-및-사용-방법&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#3-libdft64-%EC%84%A4%EC%B9%98-%EB%B0%8F-%EC%82%AC%EC%9A%A9-%EB%B0%A9%EB%B2%95&quot; aria-label=&quot;3 libdft64 설치 및 사용 방법 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;3. LIBDFT64 설치 및 사용 방법&lt;/h1&gt;
&lt;h2 id=&quot;a-설치&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#a-%EC%84%A4%EC%B9%98&quot; aria-label=&quot;a 설치 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;A. 설치&lt;/h2&gt;
&lt;p&gt;ubuntu 20.04 기준 정상 동작했으며, wsl환경을 사용했습니다.&lt;/p&gt;
&lt;p&gt;설치 스크립트는 다음과 같습니다.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;bash&quot;&gt;&lt;pre class=&quot;language-bash&quot;&gt;&lt;code class=&quot;language-bash&quot;&gt;&lt;span class=&quot;token shebang important&quot;&gt;#!/bin/bash&lt;/span&gt;
&lt;span class=&quot;token function&quot;&gt;git&lt;/span&gt; clone https://github.com/AngoraFuzzer/libdft64.git

&lt;span class=&quot;token builtin class-name&quot;&gt;cd&lt;/span&gt; libdft64

./install_pin.sh

&lt;span class=&quot;token builtin class-name&quot;&gt;export&lt;/span&gt; &lt;span class=&quot;token assign-left variable&quot;&gt;PIN_ROOT&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;pintools_path&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;

&lt;span class=&quot;token function&quot;&gt;make&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h2 id=&quot;b-libdft64-내부-구조&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#b-libdft64-%EB%82%B4%EB%B6%80-%EA%B5%AC%EC%A1%B0&quot; aria-label=&quot;b libdft64 내부 구조 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;B. LIBDFT64 내부 구조&lt;/h2&gt;
&lt;p&gt;&lt;img src=&quot;Detecting_FSB_with_DTA%5CUntitled%206.png&quot; alt=&quot;Untitled&quot;&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Tagmap: DTA 시스템을 위해 마련되는 가상 메모리 공간입니다. 즉, 메모리 공간의 오염 정보 상태를 기록하는 곳입니다.
(DTA 에서는 이런 공간을 SHADOW MEMORY라고 부르지만, LIBDFT에서는 TAGMAP 이라는 이름을 사용합니다.)&lt;/li&gt;
&lt;li&gt;Vcpu: CPU 레지스터들의 오염 상태를 관리하는 공간입니다. 메모리 공간뿐 아니라 레지스터도 오염 대상이 될 수 있습니다.&lt;/li&gt;
&lt;li&gt;Tracker: 오염 추적 엔진입니다. &lt;code class=&quot;language-text&quot;&gt;libdft_core.c&lt;/code&gt;에 구현되어 있습니다.&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&quot;c-libdft64-api&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#c-libdft64-api&quot; aria-label=&quot;c libdft64 api permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;C. LIBDFT64 API&lt;/h2&gt;
&lt;p&gt;주요 사용되는 API를  설명합니다.&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;tagmap_setb() : 특정 메모리 바이트를 오염된 것으로 표시합니다.&lt;/li&gt;
&lt;li&gt;tagmap_getb() : 특정 메모리 바이트의 오염 여부를 확인합니다.&lt;/li&gt;
&lt;li&gt;syscall&lt;em&gt;set&lt;/em&gt;pre() 시스템 콜 발생에 대한 사전 콜백을 등록합니다.&lt;/li&gt;
&lt;li&gt;syscall&lt;em&gt;set&lt;/em&gt;post() : 시스템 콜 발생에 대한 사후 콜백을 등록합니다.&lt;/li&gt;
&lt;li&gt;&lt;u&gt;syscall_desc&lt;/u&gt; : 시스템 콜 콜백들을 저장하기 위한 배열입니다.&lt;/li&gt;
&lt;li&gt;ins&lt;em&gt;set&lt;/em&gt;pre/post() : 명령어에 대한 사전/사후 콜백을 등록합니다.&lt;/li&gt;
&lt;li&gt;&lt;u&gt;ins_desc&lt;/u&gt; : 명령어 콜백들을 저장하기 위한 배열입니다.&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;참고로 밑줄 친 두 개의 배열은 &lt;code class=&quot;language-text&quot;&gt;extern&lt;/code&gt;으로 선언해 주어야 합니다. &lt;/p&gt;
&lt;h2 id=&quot;d-빌드-방법&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#d-%EB%B9%8C%EB%93%9C-%EB%B0%A9%EB%B2%95&quot; aria-label=&quot;d 빌드 방법 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;D. 빌드 방법&lt;/h2&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;분석 대상 프로그램 &lt;/p&gt;
&lt;p&gt;dta tool로 분석하고자 하는 프로그램을 &lt;code class=&quot;language-text&quot;&gt;libdft64/tools/obj-intel64&lt;/code&gt; 디렉토리 안에 위치시킵니다.&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;dta tool 빌드&lt;/p&gt;
&lt;p&gt;개발한 dta tool파일은 &lt;code class=&quot;language-text&quot;&gt;libdft64/tools&lt;/code&gt;폴더에 위치해야 합니다.&lt;/p&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;libdft64/tools/makefile.rules&lt;/code&gt; 파일의 31번째 행의 TOOL_ROOTS 변수에 dta tool 파일 이름을 넣습니다. &lt;/p&gt;
&lt;p&gt;이후 &lt;code class=&quot;language-text&quot;&gt;libdft64/&lt;/code&gt; 로 이동해서 make 명령어를 입력합니다.&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;분석 수행&lt;/p&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;libdft64/tools/makefile.rules&lt;/code&gt; 의 마지막 행에 다음 makefile rule을 추가합니다.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;bash&quot;&gt;&lt;pre class=&quot;language-bash&quot;&gt;&lt;code class=&quot;language-bash&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;name&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;: &lt;span class=&quot;token variable&quot;&gt;&lt;span class=&quot;token variable&quot;&gt;$(&lt;/span&gt;OBJDIR&lt;span class=&quot;token variable&quot;&gt;)&lt;/span&gt;&lt;/span&gt;/&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;dta_tool&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token variable&quot;&gt;&lt;span class=&quot;token variable&quot;&gt;$(&lt;/span&gt;PINTOOL_SUFFIX&lt;span class=&quot;token variable&quot;&gt;)&lt;/span&gt;&lt;/span&gt; &lt;span class=&quot;token variable&quot;&gt;${OBJDIR}&lt;/span&gt;/&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;analysis_target&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;
     &lt;span class=&quot;token variable&quot;&gt;&lt;span class=&quot;token variable&quot;&gt;$(&lt;/span&gt;PIN&lt;span class=&quot;token variable&quot;&gt;)&lt;/span&gt;&lt;/span&gt; -t $&lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt; -- &lt;span class=&quot;token variable&quot;&gt;&lt;span class=&quot;token variable&quot;&gt;$(&lt;/span&gt;OBJDIR&lt;span class=&quot;token variable&quot;&gt;)&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;analysis_target&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;이후 &lt;code class=&quot;language-text&quot;&gt;libdft64/tools/&lt;/code&gt; 경로에서 &lt;code class=&quot;language-text&quot;&gt;make [name]&lt;/code&gt; 을 해주시면, 툴이 분석 대상 프로그램 계측을 시작합니다.&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;h1 id=&quot;4-libdft64로-format-string-bug-탐지&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#4-libdft64%EB%A1%9C-format-string-bug-%ED%83%90%EC%A7%80&quot; aria-label=&quot;4 libdft64로 format string bug 탐지 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;4. LIBDFT64로 Format String Bug 탐지&lt;/h1&gt;
&lt;h2 id=&quot;a-format-string-bug-탐지-방안&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#a-format-string-bug-%ED%83%90%EC%A7%80-%EB%B0%A9%EC%95%88&quot; aria-label=&quot;a format string bug 탐지 방안 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;A. Format String Bug 탐지 방안&lt;/h2&gt;
&lt;p&gt;FSB 탐지 방법은 되게 직관적이고 간단합니다. &lt;/p&gt;
&lt;p&gt;FSB는 사용자가 포맷스트링을 입력할 수 있을 때 발생합니다. &lt;/p&gt;
&lt;p&gt;아래는 본 글에서 dta 툴을 사용한 분석에 사용될 프로그램 코드입니다.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;c&quot;&gt;&lt;pre class=&quot;language-c&quot;&gt;&lt;code class=&quot;language-c&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;// gcc -o fsb fsb.c -no-pie -fcf-protection=none&lt;/span&gt;
&lt;span class=&quot;token macro property&quot;&gt;&lt;span class=&quot;token directive-hash&quot;&gt;#&lt;/span&gt;&lt;span class=&quot;token directive keyword&quot;&gt;include&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&amp;lt;stdio.h&gt;&lt;/span&gt;&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;int&lt;/span&gt; key &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;main&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;void&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
	
	&lt;span class=&quot;token keyword&quot;&gt;char&lt;/span&gt; buf&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;0x20&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
	&lt;span class=&quot;token function&quot;&gt;read&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; buf&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;0x20&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
	
	&lt;span class=&quot;token function&quot;&gt;printf&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;buf&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

	&lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;key&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
		&lt;span class=&quot;token function&quot;&gt;printf&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;FSB\n&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
	&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;	

	&lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;위 프로그램 내에서의 fsb를 탐지하기 위해 아래와 같이 설계해 줍니다.&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Taint Source : read()&lt;/li&gt;
&lt;li&gt;Taint Sink : printf()&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;read 함수로 입력되는 값을 오염시키고, 그 값이 printf()함수의 &lt;strong&gt;“첫 번째 인자”&lt;/strong&gt; 로 사용되었을 때 FSB가 발생한다고 가정했습니다.(linux x64비트니까 printf()함수의 RDI값을 확인하면 되겠져)&lt;/p&gt;
&lt;p&gt;추가적으로 콜백 등록 관련 고려해야 할 부분이 있습니다.&lt;/p&gt;
&lt;p&gt;Taint Source인 read()는 시스템 콜에 콜백을 등록해 주면 됩니다.&lt;/p&gt;
&lt;p&gt;하지만 LIBDFT를 사용해서 라이브러리 함수를 직접적으로 후킹 할 수 없습니다. 왜냐하면 이 함수는 시스템 콜이 아니기 때문입니다. &lt;strong&gt;대신 명령어 콜백은 사용할 수 있으므로, printf함수의 PLT를 CALL하는 경우를 탐지해 줍니다.&lt;/strong&gt;&lt;/p&gt;
&lt;blockquote&gt;
&lt;ul&gt;
&lt;li&gt;fsb가 일어나는 함수는 sprintf, fprintf 등 다양하지만 위 테스트 코드에 한정해 dta 툴을 작성했습니다. &lt;/li&gt;
&lt;li&gt;‘printf() 함수로 바로 이동 하는 상황’ 혹은 ‘read 외 다른 함수로 입력을 받는 상황’ 등은 고려하지 않습니다.&lt;/li&gt;
&lt;/ul&gt;
&lt;/blockquote&gt;
&lt;h2 id=&quot;b-테스트-대상-프로그램-빌드-시-유의-사항&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#b-%ED%85%8C%EC%8A%A4%ED%8A%B8-%EB%8C%80%EC%83%81-%ED%94%84%EB%A1%9C%EA%B7%B8%EB%9E%A8-%EB%B9%8C%EB%93%9C-%EC%8B%9C-%EC%9C%A0%EC%9D%98-%EC%82%AC%ED%95%AD&quot; aria-label=&quot;b 테스트 대상 프로그램 빌드 시 유의 사항 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;B. 테스트 대상 프로그램 빌드 시 유의 사항&lt;/h2&gt;
&lt;p&gt;테스트 대상 프로그램을 GCC로 빌드 할 시 꼭 &lt;code class=&quot;language-text&quot;&gt;fcf-protection=none&lt;/code&gt; 옵션을 추가해 주세요!&lt;/p&gt;
&lt;p&gt;상기 언급한 대로, DTA 툴 내에서 테스트 대상 프로그램 printf()의 PLT주소를 알아야 합니다.&lt;/p&gt;
&lt;p&gt;PLT 주소를 알아내기 위해 DTA 툴에서 분석 대상 ELF의 섹션 정보를 파싱하는데 &lt;/p&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;fcf-protection&lt;/code&gt;이 활성화되어 있으면, 빌드 후 바이너리 내에서 &lt;code class=&quot;language-text&quot;&gt;.plt&lt;/code&gt; 섹션을 사용하지 않고 &lt;code class=&quot;language-text&quot;&gt;.plt.sec&lt;/code&gt; 섹션을 사용합니다.&lt;/p&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;.plt.sec&lt;/code&gt; 섹션의 코드는 다음과 같은 &lt;code class=&quot;language-text&quot;&gt;endbr64&lt;/code&gt; 명령어로 시작합니다. &lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;Detecting_FSB_with_DTA%5CUntitled%207.png&quot; alt=&quot;Untitled&quot;&gt;&lt;/p&gt;
&lt;p&gt;안타깝게도 pin tools의 elf 파싱 로직이 저 부분을 해석하지 못합니다.. &lt;/p&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;fcf-protection&lt;/code&gt; 보안 기법에 대한 설명은 추후 추가하겠습니다. &lt;/p&gt;
&lt;h2 id=&quot;c-dta-툴-작성&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#c-dta-%ED%88%B4-%EC%9E%91%EC%84%B1&quot; aria-label=&quot;c dta 툴 작성 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;C. DTA 툴 작성&lt;/h2&gt;
&lt;p&gt;전체 코드는 &lt;a href=&quot;https://github.com/hyunjungg/libdft64/blob/master/tools/detect_fsb.cpp&quot;&gt;여기&lt;/a&gt;서 확인하실 수 있습니다.&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;초기화 및 콜백 등록&lt;/li&gt;
&lt;/ul&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;c&quot;&gt;&lt;pre class=&quot;language-c&quot;&gt;&lt;code class=&quot;language-c&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;main&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;int&lt;/span&gt; argc&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;char&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;*&lt;/span&gt;argv&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
 
  &lt;span class=&quot;token function&quot;&gt;PIN_InitSymbols&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
	
	&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt;
	&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt;  일부 생략
	&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt;

  &lt;span class=&quot;token function&quot;&gt;IMG_AddInstrumentFunction&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;image_load&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;token comment&quot;&gt;// PLT PARSING&lt;/span&gt;
  &lt;span class=&quot;token function&quot;&gt;syscall_set_post&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&amp;amp;&lt;/span&gt;syscall_desc&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;__NR_read&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; post_read_hook&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;token comment&quot;&gt;// set read callback&lt;/span&gt;
  &lt;span class=&quot;token function&quot;&gt;ins_set_post&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&amp;amp;&lt;/span&gt;ins_desc&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;XED_ICLASS_CALL_NEAR&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; dta_instrument_call&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;token comment&quot;&gt;// set ins callback&lt;/span&gt;
	
  &lt;span class=&quot;token comment&quot;&gt;/* start Pin */&lt;/span&gt;
  &lt;span class=&quot;token function&quot;&gt;PIN_StartProgram&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;ul&gt;
&lt;li&gt;PLT 파싱&lt;/li&gt;
&lt;/ul&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;c&quot;&gt;&lt;pre class=&quot;language-c&quot;&gt;&lt;code class=&quot;language-c&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;void&lt;/span&gt; 
&lt;span class=&quot;token function&quot;&gt;image_load&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;IMG img&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; VOID &lt;span class=&quot;token operator&quot;&gt;*&lt;/span&gt;v&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;IMG_IsMainExecutable&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;img&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;

      &lt;span class=&quot;token keyword&quot;&gt;for&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;SEC sec &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;IMG_SecHead&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;img&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;SEC_Valid&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;sec&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt; sec &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;SEC_Next&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;sec&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;

        &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;SEC_Name&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;sec&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;==&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;.plt&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
          &lt;span class=&quot;token keyword&quot;&gt;for&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;RTN rtn &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;SEC_RtnHead&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;sec&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;RTN_Valid&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;rtn&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt; rtn &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;RTN_Next&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;rtn&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;

            &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;RTN_Name&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;rtn&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;==&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;printf@plt&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
                plt_printf &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;RTN_Address&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;rtn&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
                &lt;span class=&quot;token keyword&quot;&gt;break&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
            &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
          &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
          &lt;span class=&quot;token keyword&quot;&gt;break&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
        &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
      &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;ul&gt;
&lt;li&gt;READ 콜백 함수&lt;/li&gt;
&lt;/ul&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;c&quot;&gt;&lt;pre class=&quot;language-c&quot;&gt;&lt;code class=&quot;language-c&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;void&lt;/span&gt;
&lt;span class=&quot;token function&quot;&gt;post_read_hook&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;THREADID tid&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;syscall_ctx_t&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;*&lt;/span&gt;ctx&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  
  &lt;span class=&quot;token comment&quot;&gt;// only receive input data from STDIN(0)&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;ctx&lt;span class=&quot;token operator&quot;&gt;-&gt;&lt;/span&gt;arg&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;SYSCALL_ARG0&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;!=&lt;/span&gt; STDIN_FILENO&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

  &lt;span class=&quot;token comment&quot;&gt;// set the tag marking&lt;/span&gt;
  &lt;span class=&quot;token function&quot;&gt;tagmap_setn&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;ctx&lt;span class=&quot;token operator&quot;&gt;-&gt;&lt;/span&gt;arg&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;SYSCALL_ARG1&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;size_t&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;ctx&lt;span class=&quot;token operator&quot;&gt;-&gt;&lt;/span&gt;ret&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;0x01&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;token function&quot;&gt;fprintf&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token constant&quot;&gt;stderr&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;[INFO] tainting bytes %p ~ %p (tainted byte : %lu)\n&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; 
          &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;ctx&lt;span class=&quot;token operator&quot;&gt;-&gt;&lt;/span&gt;arg&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;SYSCALL_ARG1&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
          &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;ctx&lt;span class=&quot;token operator&quot;&gt;-&gt;&lt;/span&gt;arg&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;SYSCALL_ARG1&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;size_t&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;ctx&lt;span class=&quot;token operator&quot;&gt;-&gt;&lt;/span&gt;ret&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
          &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;size_t&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;ctx&lt;span class=&quot;token operator&quot;&gt;-&gt;&lt;/span&gt;ret &lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;ul&gt;
&lt;li&gt;CALL 명령어 콜백 함수&lt;/li&gt;
&lt;/ul&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;c&quot;&gt;&lt;pre class=&quot;language-c&quot;&gt;&lt;code class=&quot;language-c&quot;&gt;&lt;span class=&quot;token function&quot;&gt;dta_instrument_call&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;INS ins&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
 
  &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;!&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;INS_IsCall&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;ins&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

  &lt;span class=&quot;token function&quot;&gt;INS_InsertCall&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;ins&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
      IPOINT_BEFORE&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
      &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;AFUNPTR&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;check_string_taint&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
      IARG_CONTEXT &lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;  
      IARG_INST_PTR&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; IARG_BRANCH_TARGET_ADDR&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
      IARG_END&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;ul&gt;
&lt;li&gt;분석 함수&lt;/li&gt;
&lt;/ul&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;c&quot;&gt;&lt;pre class=&quot;language-c&quot;&gt;&lt;code class=&quot;language-c&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;void&lt;/span&gt;
&lt;span class=&quot;token function&quot;&gt;check_string_taint&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;CONTEXT &lt;span class=&quot;token operator&quot;&gt;*&lt;/span&gt;ctxt&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; ADDRINT ip&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; ADDRINT target&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  
  &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;target &lt;span class=&quot;token operator&quot;&gt;!=&lt;/span&gt; plt_printf&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

  ADDRINT rdiValue &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;PIN_GetContextReg&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;ctxt&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; REG_RDI&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;char&lt;/span&gt; buffer&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;1024&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

  &lt;span class=&quot;token function&quot;&gt;PIN_SafeCopy&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;buffer&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;VOID&lt;span class=&quot;token operator&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;rdiValue&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;sizeof&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;buffer&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  
  &lt;span class=&quot;token keyword&quot;&gt;for&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;ADDRINT addr &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; rdiValue&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt; addr &lt;span class=&quot;token operator&quot;&gt;&amp;lt;=&lt;/span&gt; end&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt; addr&lt;span class=&quot;token operator&quot;&gt;++&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    tag &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;tagmap_getb&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;addr&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;tag &lt;span class=&quot;token operator&quot;&gt;!=&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
      &lt;span class=&quot;token function&quot;&gt;fprintf&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token constant&quot;&gt;stderr&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;\n\n\n[WARNING] !!! ADDRESS %p IS TAINTED (tag=0x%02x), ABORTING !!!!!\n\n\n&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
            &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;addr&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
            &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;unsigned&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;int&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;tag&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
      &lt;span class=&quot;token function&quot;&gt;exit&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
  
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h2 id=&quot;d-결과&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#d-%EA%B2%B0%EA%B3%BC&quot; aria-label=&quot;d 결과 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;D. 결과&lt;/h2&gt;
&lt;p&gt;최종 실행 시, 다음과 같이 정상 동작하는 것을 확인할 수 있습니다.&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;Detecting_FSB_with_DTA%5CUntitled%208.png&quot; alt=&quot;Untitled&quot;&gt;&lt;/p&gt;
&lt;h1 id=&quot;5-참고&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#5-%EC%B0%B8%EA%B3%A0&quot; aria-label=&quot;5 참고 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;5. 참고&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;https://www.google.com/search?q=libdft&amp;#x26;oq=libdft&amp;#x26;aqs=chrome..69i57j69i59l2j69i60l3.3035j0j7&amp;#x26;sourceid=chrome&amp;#x26;ie=UTF-8&quot;&gt;https://www.google.com/search?q=libdft&amp;#x26;oq=libdft&amp;#x26;aqs=chrome..69i57j69i59l2j69i60l3.3035j0j7&amp;#x26;sourceid=chrome&amp;#x26;ie=UTF-8&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://github.com/AngoraFuzzer/libdft64&quot;&gt;https://github.com/AngoraFuzzer/libdft64&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://terrorgum.com/tfox/books/practicalbinaryanalysis.pdf&quot;&gt;https://terrorgum.com/tfox/books/practicalbinaryanalysis.pdf&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;</content:encoded></item><item><title><![CDATA[Windows IRQL 1]]></title><description><![CDATA[Dispatch Level에서 Dispatcher 호출하기! 1. 개요 안녕하세여!!!!!!! 오늘은 IRQL을 좀 더 자세히 이해하기 위해서 간단한 테스트를 해보려고 합니다!!!!!!!!!!!!!!!!!!
IRQL…]]></description><link>https://hyunjungg.github.io/windows/1202_windows_irql1/</link><guid isPermaLink="false">https://hyunjungg.github.io/windows/1202_windows_irql1/</guid><pubDate>Thu, 02 Dec 2021 00:58:13 GMT</pubDate><content:encoded>&lt;h1 id=&quot;dispatch-level에서-dispatcher-호출하기&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#dispatch-level%EC%97%90%EC%84%9C-dispatcher-%ED%98%B8%EC%B6%9C%ED%95%98%EA%B8%B0&quot; aria-label=&quot;dispatch level에서 dispatcher 호출하기 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Dispatch Level에서 Dispatcher 호출하기!&lt;/h1&gt;
&lt;h2 id=&quot;1-개요&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#1-%EA%B0%9C%EC%9A%94&quot; aria-label=&quot;1 개요 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;1. 개요&lt;/h2&gt;
&lt;p&gt;안녕하세여!!!!!!!&lt;/p&gt;
&lt;p&gt;오늘은 IRQL을 좀 더 자세히 이해하기 위해서 간단한 테스트를 해보려고 합니다!!!!!!!!!!!!!!!!!!
IRQL을 공부하다 보면 인터럽트 마스킹이라는 개념을 접하게 되는데요,&lt;/p&gt;
&lt;p&gt;이를 눈으로 직접 확인해보겠습니다.!&lt;/p&gt;
&lt;p&gt;동작 방식 확인을 위해서 IRQL Dispatch level에서 동작하는 코드를 작성하고, 해당 코드 내부에서 dispatcher 를 호출 해서 시스템이 크래시 나는 과정을 한번 보려고 합니다.~&lt;/p&gt;
&lt;p&gt;좀 더 자세히 말하면,  &lt;code class=&quot;language-text&quot;&gt;SetTimer()&lt;/code&gt; 로 DPC 루틴을 등록하여 실행시킨 후, 해당 DPC루틴 내부에서 &lt;code class=&quot;language-text&quot;&gt;KeDelayExecutionThread()&lt;/code&gt; 를 통해 퀀텀시간을 반납하여 dispatcher 를 호출해 볼 예정입니다. ㅎㅎ &lt;/p&gt;
&lt;p&gt;블루스크린이 발생한다는 사실은 알고 있지만
드라이버 개발을 할 일이 없기 했고..  드라이버를 활용하여 만들어 보고 싶은것도 없었기 때문에, 제 눈으로 직접 확인해 볼 수 있는 기회가 없었던 것 같아여 … ㅎ_ㅎ T^T&lt;/p&gt;
&lt;p&gt;그럼 먼저 이해를 위해 알아야 할 개념들을 설명하겠습니다.!&lt;/p&gt;
&lt;h2 id=&quot;2-개념&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#2-%EA%B0%9C%EB%85%90&quot; aria-label=&quot;2 개념 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;2. 개념&lt;/h2&gt;
&lt;h3 id=&quot;1-윈도우-스케줄링&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#1-%EC%9C%88%EB%8F%84%EC%9A%B0-%EC%8A%A4%EC%BC%80%EC%A4%84%EB%A7%81&quot; aria-label=&quot;1 윈도우 스케줄링 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;1. 윈도우 스케줄링&lt;/h3&gt;
&lt;p&gt;윈도우의 스케줄링 코드는 커널에 구현돼 있지만, 별도의 루틴으로 존재하는 것이 아니라 커널내부에 산재해 있습니다! 이런 작업을 수행하는 루틴들을 합쳐 &lt;strong&gt;Kernel Dispatcher&lt;/strong&gt; 라고 부릅니다 .&lt;/p&gt;
&lt;p&gt;Kernel Dispatcher가 호출 되는 상황의 예시를 몇 가지 들어보겠습니다.!&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;스레드의 퀀텀시간이 종료되는 경우&lt;/p&gt;
&lt;p&gt;이 경우, Dispatcher 가 바로 호출 되는 것이 아니라 아래와 같은 과정을 거치게 됩니다!&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;DIRQL 레벨에서 Timer Interrupt Handler 호출 

-&gt; 해당 핸들러에서 Timer DPC Routine 등록 

-&gt; Dispatcher 호출&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;스레드가 자발적으로 퀀텀시간을 반납하는 경우&lt;/p&gt;
&lt;p&gt;이 경우, 커널 Dispatcher 가 바로 호출되고 대기 중이었던 다른 Thread 가 호출 되게 됩니다.&lt;/p&gt;
&lt;p&gt;이때 만약 대기 중인 스레드가 존재하지 않는다면, Dispatcher는 Idle Thread 를 호출합니다.&lt;/p&gt;
&lt;p&gt;( 참고로, Idle Thread는 CPU 개수만큼 존재합니다. !)&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;이렇게 Kernel Dispatcher에서 스케줄링 관련 이벤트가 일어나게 되는데요~  이렇게 스레드의 문맥이 전환이 되면 &lt;strong&gt;Context Switching&lt;/strong&gt; 이 일어나게 됩니다.!&lt;/p&gt;
&lt;p&gt;Context Switching 이란 현재 실행 중인 스레드와 관련된 휘발성 프로세서 정보를 저장한 후 새로운 스레드의 상태 값을 가져와 새로운 스레드의 실행을 시작하는 과정을 말합니다!&lt;/p&gt;
&lt;p&gt;휘발성 프로세서 정보가 무엇일까여 ?! ㅎㅎ&lt;/p&gt;
&lt;p&gt;일반적으로 Context Switching  에서는 다음의 자료들을 저장합니다!&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Instruction Pointer&lt;/li&gt;
&lt;li&gt;Kernel Stack Pointer&lt;/li&gt;
&lt;li&gt;Process의 Page Table Directory Pointer &lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;참고로 마지막에 쓴 프로세스의 페이지 테이블 디렉토리 포인터는 CPU의 CR3 레지스터 값에 저장되게 됩니다.!&lt;/p&gt;
&lt;p&gt;커널은 이러한 정보들을 커널모드 스택에 넣고, 스택 포인터를 스레드의 KTHREAD 블록에 저장합니다.&lt;/p&gt;
&lt;p&gt;—&gt; 해당 부분에 대해 다음시간에 Windbg로 분석해보는 시간을 가지려구 합니다 ^^ 재밌겟져 &lt;/p&gt;
&lt;h3 id=&quot;2-irql&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#2-irql&quot; aria-label=&quot;2 irql permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;2. IRQL&lt;/h3&gt;
&lt;p&gt;IRQL은 인터럽트의 우선순위로, 코어의 개수만큼 존재합니다!!&lt;/p&gt;
&lt;p&gt;x64환경 기준으로 &lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;0 - PASSIVE_LEVEL

1 - APC_LEVEL

2 - DISPATCH_LEVEL

3 ~ 11 - DIRQLs

12 ~ 15 - HIGH_LEVEL&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;이렇게 구성되어 있습니다.&lt;/p&gt;
&lt;p&gt;&lt;u&gt;높은 IRQL의 코드는 낮은 IRQL에서 실행하는 코드를 선점할 수 있습니다!&lt;/u&gt; 이를 &lt;strong&gt;Interrupt Masking&lt;/strong&gt; 이라고 합니다.&lt;/p&gt;
&lt;p&gt;참고로 IRQL 은 스레드 우선순위와는 다릅니다.. 실제로 스레드 우선순위는 IRQL이 2보다 작을 때에만 의미를 가집니다~&lt;/p&gt;
&lt;p&gt;그럼 중요한 IRQL 들 중 0번과 2번에 대해 설명 해 보겠습니다!&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;PASSIVE ( IRQL 0 )&lt;/p&gt;
&lt;p&gt;보통의 스레드 코드가 흐르는 레벨입니다. 특별히 아무것도 발생하지 않고 일반적인 소프트웨어나 드라이버 코드들이 실행되는 레벨 입니다! ( 설명이 이상하네요 .. )&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;DISPATCH_LEVEL ( IRQL 2 )&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;1번 윈도우 스케줄링 개념 설명&lt;/strong&gt; 에서 언급했던 Kernel Dispatcher 가 동작하는 IRQL 입니다! 스레드가 현재 IRQL을 2 이상으로 상승 시키게 되면, 스레드는 기본적으로 &lt;u&gt;무한 퀀텀&lt;/u&gt; 을 갖게 되고, 다른 스레드에 의해 선점될 수 없습니다!!!!!!!!!!&lt;/p&gt;
&lt;p&gt;그럼 여기서 굉장히 중요한 이야기를 해보겠습니다.  &lt;/p&gt;
&lt;p&gt;방금 전에 제가 위에서 Interrupt Masking 에대한 개념을 설명했고, Kernel Dispatcher 는 &lt;strong&gt;IRQL DISPATCH_LEVEL&lt;/strong&gt; 에서 동작한다고 했습니다.!!&lt;/p&gt;
&lt;p&gt;그럼 IRQL이 &lt;strong&gt;DISPATCH_LEVEL&lt;/strong&gt; 이상일 때, 페이징이 발생하면 어떻게 될까요 ???…
이런 경우에 시스템이 크래시 되게 됩니다.! ( 블루스크린이 발생합니다 .. )&lt;/p&gt;
&lt;p&gt;실제로 페이징이 발생한다는 것은 Page Fault 가 처리된다는 것인데요! Page Fault가 처리되는 과정에서 Context Switching 이 일어나기 때문에 Dispatcher 가 호출되게 됩니다.! &lt;/p&gt;
&lt;p&gt;따라서 IRQL 2 또는 그 이상의 레벨에서 실행하는 코드는 NonPaged Memory 만을 접근해야합니다.&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&quot;3-dpc&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#3-dpc&quot; aria-label=&quot;3 dpc permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;3. DPC&lt;/h3&gt;
&lt;p&gt;Deferred Procedure Call 이라 불리는 DPC 루틴은 &lt;strong&gt;IRQL Dispatch_LEVEL&lt;/strong&gt;에서 호출 됩니다.&lt;/p&gt;
&lt;p&gt;주로 DPC는 인터럽트 후처리를 위해 존재합니다.&lt;/p&gt;
&lt;p&gt;IRQL 3 이상의 값을 가지는 루틴에서 .. 스레드를 오랫동안 가지고 있게되면, 우선 순위가 낮은 루틴들은 아무것도 못하게 되잖아여?&lt;/p&gt;
&lt;p&gt;따라서 현재 실행에 꼭 필요한 기능만을 수행하고, 다른 기능들은 DPC 담아 DPC 큐에 등록합니다!&lt;/p&gt;
&lt;p&gt;그럼 나중에 IRQL DISPATCH_LEVEL 에서 등록된 DPC 루틴들이 실행되게 되는 거에요!!&lt;/p&gt;
&lt;p&gt;정확한 순서는 아래와 같습니다.&lt;/p&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 521px; &quot;
    &gt;
      &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 89.66666666666666%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAASABQDASIAAhEBAxEB/8QAGAABAAMBAAAAAAAAAAAAAAAAAAECAwX/xAAUAQEAAAAAAAAAAAAAAAAAAAAA/9oADAMBAAIQAxAAAAHuU0zNkC0BQH//xAAZEAACAwEAAAAAAAAAAAAAAAABEAACMRH/2gAIAQEAAQUCMxcQdc//xAAUEQEAAAAAAAAAAAAAAAAAAAAg/9oACAEDAQE/AR//xAAUEQEAAAAAAAAAAAAAAAAAAAAg/9oACAECAQE/AR//xAAWEAEBAQAAAAAAAAAAAAAAAAAgMUH/2gAIAQEABj8Cg0//xAAbEAEBAQACAwAAAAAAAAAAAAABEQAgMSFBcf/aAAgBAQABPyFPWCp6w00+jSWn1pnh4H//2gAMAwEAAgADAAAAEGAHAP/EABQRAQAAAAAAAAAAAAAAAAAAACD/2gAIAQMBAT8QH//EABQRAQAAAAAAAAAAAAAAAAAAACD/2gAIAQIBAT8QH//EAB0QAQEAAQQDAAAAAAAAAAAAAAERABAxQVEhYaH/2gAIAQEAAT8QdV4cO9wgaTmSZJXGLIXDdT0HOyF71P3n/9k=&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;222AFD385883A84E31&quot;
        title=&quot;222AFD385883A84E31&quot;
        src=&quot;/static/a29a8a787f96d4de7238abb782168175/d52bd/222AFD385883A84E31.jpg&quot;
        srcset=&quot;/static/a29a8a787f96d4de7238abb782168175/f93b5/222AFD385883A84E31.jpg 300w,
/static/a29a8a787f96d4de7238abb782168175/d52bd/222AFD385883A84E31.jpg 521w&quot;
        sizes=&quot;(max-width: 521px) 100vw, 521px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
      /&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;1. 인터럽트 발생
2. 발생한 인터럽트가 IRQL 이 높을 경우 현 상태를 저장하고 IDT를 참조하여 ISR 실행
3. ISR이 동작하면서 CPU의 IRQL을 올림
4. 덜 중요한 작업들은 Dpc 큐에 넣음
5. ISR 이 종료되면 IRQL 이 DPC 레벨로 낮아짐
6. DPC의 인터럽트들을 실행하고 큐의 모든 객체를 실행한 다음 원래 Thread로 복귀 &lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h2 id=&quot;3-실습&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#3-%EC%8B%A4%EC%8A%B5&quot; aria-label=&quot;3 실습 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;3. 실습&lt;/h2&gt;
&lt;p&gt;실습을 위해 유저모드 Application과 레거시 드라이버. 이렇게 두 가지를 작성하였으며, 글에서는 코드 일부만 첨부하였습니다.!&lt;/p&gt;
&lt;p&gt;글 초반에서 언급했듯이, 실습해볼 내용은 다음과 같습니다.!&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;UserMode Application에서 제가 작성한 드라이버코드로 Read 요청을 보내 ReadDispatch를 호출 시킵니다.&lt;/li&gt;
&lt;li&gt;드라이버의 ReadDispatch에서 &lt;code class=&quot;language-text&quot;&gt;KeSetTimer()&lt;/code&gt; 함수로 timer 10초 세팅 + DPC 루틴 등록 후 실행 시킵니다.!&lt;/li&gt;
&lt;li&gt;10초 뒤 호출된 DPC 루틴에서 &lt;code class=&quot;language-text&quot;&gt;KeDelayExecutionThread()&lt;/code&gt; 함수를 사용하여 자발적으로 퀀텀 시간을 반납해줍니다.&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;3번 까지 실행되고 나면..  블루스크린을 볼 수 있을 텐데요 ㅎㅎ&lt;/p&gt;
&lt;p&gt;코드는 아래와 같습니다.&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;irql_test.sys&lt;/li&gt;
&lt;/ul&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;c++&quot;&gt;&lt;pre class=&quot;language-c++&quot;&gt;&lt;code class=&quot;language-c++&quot;&gt;NTSTATUS ReadDispatch(PDEVICE_OBJECT pDevObj, PIRP pIrp) {
	
	PDEVICE_EXTENSION pDE;
	pDE = (PDEVICE_EXTENSION)pDevObj-&amp;gt;DeviceExtension;

	pIrp-&amp;gt;IoStatus.Status = STATUS_SUCCESS;

	pDE-&amp;gt;pPendingIrp = pIrp;
	IoMarkIrpPending(pIrp); // 비동기 IO 완료를 위해 필요

	LARGE_INTEGER Result;
	Result.QuadPart = -1 * 10 * 10000000; // 10초 타이머 세팅 
	KeSetTimer(&amp;amp;pDE-&amp;gt;Timer, Result, &amp;amp;pDE-&amp;gt;Dpc);

	return STATUS_PENDING;  // 비동기 IO 완료를 위해 필요

}&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;c++&quot;&gt;&lt;pre class=&quot;language-c++&quot;&gt;&lt;code class=&quot;language-c++&quot;&gt;VOID DpcRoutine(
	struct _KDPC* Dpc,
	PVOID  DeferredContext,
	PVOID  SystemArgument1,
	PVOID  SystemArgument2
)
{
	PDEVICE_EXTENSION pDE = DeferredContext;
	UNREFERENCED_PARAMETER(Dpc);
	UNREFERENCED_PARAMETER(SystemArgument1);
	UNREFERENCED_PARAMETER(SystemArgument2);


    LARGE_INTEGER Result;
    Result.QuadPart = -1 * 10 * 10000000; //10초 설정 

    KeDelayExecutionThread(KernelMode, FALSE, &amp;amp;Result);
	
	IoCompleteRequest(pDE-&amp;gt;pPendingIrp, IO_NO_INCREMENT); 
}&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;ul&gt;
&lt;li&gt;application.c&lt;/li&gt;
&lt;/ul&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;c++&quot;&gt;&lt;pre class=&quot;language-c++&quot;&gt;&lt;code class=&quot;language-c++&quot;&gt;	handle = CreateFileW(L&amp;quot;\\??\\IRQL&amp;quot;, GENERIC_READ | GENERIC_WRITE, 0, NULL, OPEN_EXISTING, 0, NULL);

	bRet = ReadFile(handle, NULL, NULL, NULL, NULL);&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;다음으로 실제 가상환경에서 해당 드라이버 코드를 실행 시킨 후 WinDBG로 확인하는 과정을 하나씩 하나씩 살펴보겠습니당.&lt;/p&gt;
&lt;p&gt;우선 드라이버를 가상환경에 올려줍시다!&lt;/p&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 966px; &quot;
    &gt;
      &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 27.666666666666668%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAGCAYAAADDl76dAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAnklEQVQY04WRTQuEIBRF22ZlZqX2QStx4f//f3e4DxqEGmdx4fJ4Ho/YbNuG67qw7zucc5jnGeu6YhgG9H2PruseKefsZRpCCNRaC4RJKcnMWitzZhxHCfsb6AskIMaI4zhA22makHOWTtsQApZlgfdeOgWqQFoQwEO8/Ya2bQul1GuqTybwPE8YY2SBxjWDG/bTkCDa3R9RLv8Dv+UD4DKNNFRJ9DIAAAAASUVORK5CYII=&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;image-20211129021308727&quot;
        title=&quot;image-20211129021308727&quot;
        src=&quot;/static/fb100fa1aa50c995ab9af83a0fdcf5e3/5bf79/image-20211129021308727.png&quot;
        srcset=&quot;/static/fb100fa1aa50c995ab9af83a0fdcf5e3/5a46d/image-20211129021308727.png 300w,
/static/fb100fa1aa50c995ab9af83a0fdcf5e3/0a47e/image-20211129021308727.png 600w,
/static/fb100fa1aa50c995ab9af83a0fdcf5e3/5bf79/image-20211129021308727.png 966w&quot;
        sizes=&quot;(max-width: 966px) 100vw, 966px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
      /&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;이제 해당 환경에 Windbg를 붙이고 제 드라이버의 ReadDispatch 루틴과 DpcRoutine에 break point를 걸어줍니다!&lt;/p&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 479px; &quot;
    &gt;
      &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 14.666666666666666%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAADCAYAAACTWi8uAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAdklEQVQI143H0QoCIRSEYd//1UQIwhITzBtXPW5rbm3eTYei22rg42dEjBEhBHjvceaenIMxBkopSCmh9QHWWowx8M8EUUHOCZUIJWeWMNcKKpmVV9tywWO747Z2tn4ldtpif3SYqCHN/a1euR8dE/9IC2s/PQHtnuHch7xJzwAAAABJRU5ErkJggg==&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;image-20211129022043078&quot;
        title=&quot;image-20211129022043078&quot;
        src=&quot;/static/41f1b5d06aa771b642c0b5180ffda9f9/a9b70/image-20211129022043078.png&quot;
        srcset=&quot;/static/41f1b5d06aa771b642c0b5180ffda9f9/5a46d/image-20211129022043078.png 300w,
/static/41f1b5d06aa771b642c0b5180ffda9f9/a9b70/image-20211129022043078.png 479w&quot;
        sizes=&quot;(max-width: 479px) 100vw, 479px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
      /&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;이렇게 세팅한 후 가상환경에서 application을 실행시키면, ReadDispatch에 bp 가 걸리게 됩니다.!&lt;/p&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 575px; &quot;
    &gt;
      &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 10.999999999999998%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAACCAYAAABYBvyLAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAWUlEQVQI15XN0QZAIRCE4d7/7brpJrYoiohkFdEczRuc5bv7zRprLZxzCCEgpYRSCuacOOfg3vvLOyMiHHq894gxUs4ZvXdGqoq1Fp/UWjHGoNYavW7vzfYDO8qYvJJdLQEAAAAASUVORK5CYII=&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;image-20211129021910788&quot;
        title=&quot;image-20211129021910788&quot;
        src=&quot;/static/d8afc499fab80cd3d81623cf8dbfd4c9/59415/image-20211129021910788.png&quot;
        srcset=&quot;/static/d8afc499fab80cd3d81623cf8dbfd4c9/5a46d/image-20211129021910788.png 300w,
/static/d8afc499fab80cd3d81623cf8dbfd4c9/59415/image-20211129021910788.png 575w&quot;
        sizes=&quot;(max-width: 575px) 100vw, 575px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
      /&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;이 때의  IRQL 레벨과 실행중인 스레드를 확인해 볼까요 ?&lt;/p&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 690px; &quot;
    &gt;
      &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 21%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAECAYAAACOXx+WAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAoUlEQVQY042PWQqFMBAEvf/FvICgKG64gFsWoyBGbel58L4dKJoOQzEJkiRB27ZI0xTzPGPfd0Ep9ec8TzzPA++9cN+3cF2XdCY7JwjDEJRmWSbSsixRFAW6rkNVVfLOrOsay7IIzjms6wqtNYwxsNbiOI6fkIu8LM9zDMOAKIoQxzGapsG2bZLc4SVfJqCo73tM0yTicRwlKed32Qmv+MILHRQuv1tKL0wAAAAASUVORK5CYII=&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;image-20211129022227084&quot;
        title=&quot;image-20211129022227084&quot;
        src=&quot;/static/fe3cd50360bc4839e8ee4b291fcedf23/1e043/image-20211129022227084.png&quot;
        srcset=&quot;/static/fe3cd50360bc4839e8ee4b291fcedf23/5a46d/image-20211129022227084.png 300w,
/static/fe3cd50360bc4839e8ee4b291fcedf23/0a47e/image-20211129022227084.png 600w,
/static/fe3cd50360bc4839e8ee4b291fcedf23/1e043/image-20211129022227084.png 690w&quot;
        sizes=&quot;(max-width: 690px) 100vw, 690px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
      /&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;참고로 prcb 구조체는 windows가 cpu를 추상화한 구조체 입니다.!
prcb 값을 확인해 보면 현재 IRQL LEVEL 은 PASSIVE(0) 이고, 현재 Thread는 &lt;code class=&quot;language-text&quot;&gt;ffffcb82292d3080&lt;/code&gt; 인 것을 확인할 수 있는데요! 해당 스레드에 대한 정보를 확인해보겠습니다.!&lt;/p&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 729px; &quot;
    &gt;
      &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 32%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAGCAYAAADDl76dAAAACXBIWXMAAAsTAAALEwEAmpwYAAABB0lEQVQY05WQiY6DMAxE+f+fQ4ij5RIIUCkhlDuBdtXZTFZ8wFqx5ITxGxsnSVMkRYOqlXg8O7Rti74XeM0b5HJAyBFb1+EYXth7CdUJrEEIVTfQ54mfzwdXfEztBEGAJEmglYLSJxox4zmsEEJgWhYDGrC6HmY/wBZGUAYGA7Lx/Zrzl4zjOOBEUWSnklJaSFEUmKYJ4zhCGZP/xGmMnNvthtSsHYahnTTLMtzvd+R5jrqu0TSNNVT7Dq21nYLJmgCaMt/vNzajsSsTGsexTYLKsoTv+9aEZjTgt+v3sOZm1FHvuq7V1sbc8TzPNlPE6dhQVZWFXKDLkE18I5g9hFHPO43necYvq8u9eHbvLykAAAAASUVORK5CYII=&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;image-20211129022634188&quot;
        title=&quot;image-20211129022634188&quot;
        src=&quot;/static/7bdf0bae13224e570206f80df359e50f/b2982/image-20211129022634188.png&quot;
        srcset=&quot;/static/7bdf0bae13224e570206f80df359e50f/5a46d/image-20211129022634188.png 300w,
/static/7bdf0bae13224e570206f80df359e50f/0a47e/image-20211129022634188.png 600w,
/static/7bdf0bae13224e570206f80df359e50f/b2982/image-20211129022634188.png 729w&quot;
        sizes=&quot;(max-width: 729px) 100vw, 729px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
      /&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;당연히 제가 실행시킨 application의 컨택스트 이구여! ( 해당 application 이름은 ConsolApplication1.exe 가 맞습니다. )&lt;/p&gt;
&lt;p&gt;현재 Running 상태인 것을 확인해 볼 수 있습니다.&lt;/p&gt;
&lt;p&gt;아까 위에 첨부한 코드에서 알 수 있듯이, ReadDispatch 내부에서 10초 타이머를 세팅 시켰는데요~ 실제로 디버거를 Go 시키게 되면 10초 뒤에 DpcRoutine의 break point가 잡히게 됩니다.&lt;/p&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 629px; &quot;
    &gt;
      &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 10.999999999999998%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAACCAYAAABYBvyLAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAc0lEQVQI102MUQrDIABDe/+zDQb76ToYWJ04RAWLKIL2rRYKC4QkEN6k9Jfb/cFznpFKIaUkhECtldYa+74zdGXv/fTYI8fnX9PHWObXG3WAxLqyLAtCCNQBN8YQY2TbNrz3pJTQWmOtxTl39utTSiHnzA8Rv5e7MAUrZgAAAABJRU5ErkJggg==&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;image-20211129023101129&quot;
        title=&quot;image-20211129023101129&quot;
        src=&quot;/static/faf6890aea336e4afe99346c57455f3a/63a68/image-20211129023101129.png&quot;
        srcset=&quot;/static/faf6890aea336e4afe99346c57455f3a/5a46d/image-20211129023101129.png 300w,
/static/faf6890aea336e4afe99346c57455f3a/0a47e/image-20211129023101129.png 600w,
/static/faf6890aea336e4afe99346c57455f3a/63a68/image-20211129023101129.png 629w&quot;
        sizes=&quot;(max-width: 629px) 100vw, 629px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
      /&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;오오 위에 사진에서 보시다시피 DpcRoutine에서 멈췄습니다.
이 때의 IRQL LEVEL은 몇일까요!?  당연히 Dispatch Level 이겠죠?&lt;/p&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 649px; &quot;
    &gt;
      &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 17.333333333333336%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAADCAYAAACTWi8uAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAn0lEQVQI132OvQ6CMACEef9nMW46oINGJ2lcGiOFBktbEv7ahMLGzwl9AIYvueW+u+ATXiFfEeLbHToisEkK1/do2xZ1XaNpGhhjMI4jpmnCPM+7BO/DEfR0hnw8kYQXqFX+EwJaa1RVBaWUJ89zFEXhR7aBruvgnPN5w1qLYRgQ0G8MISUY5xBrkfEUhBAwxlCWpZdQSpFlmX+5LMsufycG3zamLKBNAAAAAElFTkSuQmCC&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;image-20211129023437141&quot;
        title=&quot;image-20211129023437141&quot;
        src=&quot;/static/ebc1c8ce5a5cacff08d8e8556c8d1f12/7762d/image-20211129023437141.png&quot;
        srcset=&quot;/static/ebc1c8ce5a5cacff08d8e8556c8d1f12/5a46d/image-20211129023437141.png 300w,
/static/ebc1c8ce5a5cacff08d8e8556c8d1f12/0a47e/image-20211129023437141.png 600w,
/static/ebc1c8ce5a5cacff08d8e8556c8d1f12/7762d/image-20211129023437141.png 649w&quot;
        sizes=&quot;(max-width: 649px) 100vw, 649px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
      /&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;그럼 이때의 스레드는 누구일까요 ??&lt;/p&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 732px; &quot;
    &gt;
      &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 12%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAACCAYAAABYBvyLAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAdklEQVQI132NQQ7CIBREe/+TaeIKYtt0Q2n5IAKljd1p8sQL+JJJZvNmOq0198kwmMAaK6sTZrvgRCjbjoSK+I0YEnFZyN6TcuupxczI5UqxllQyx7HTKaXo+6ENOX6EcnKbIr28yKni2+HWxHfKPMaRT3zyjy+PVpVBj7IFxAAAAABJRU5ErkJggg==&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;image-20211129023843207&quot;
        title=&quot;image-20211129023843207&quot;
        src=&quot;/static/eb3c70be36d0c0387ad2051240714f46/d0cc0/image-20211129023843207.png&quot;
        srcset=&quot;/static/eb3c70be36d0c0387ad2051240714f46/5a46d/image-20211129023843207.png 300w,
/static/eb3c70be36d0c0387ad2051240714f46/0a47e/image-20211129023843207.png 600w,
/static/eb3c70be36d0c0387ad2051240714f46/d0cc0/image-20211129023843207.png 732w&quot;
        sizes=&quot;(max-width: 732px) 100vw, 732px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
      /&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;ConsolApplication 스레드가 아닌 다른 스레드입니다! 여기서는 System 스레드 였네요 ㅎㅎ&lt;/p&gt;
&lt;p&gt;이제  &lt;code class=&quot;language-text&quot;&gt;kd &gt; u fffff805556a1030 L20&lt;/code&gt; 커맨드로 어셈블리를 확인한 후 &lt;code class=&quot;language-text&quot;&gt;KeDelayExecutionThread()&lt;/code&gt;에 bp를 걸어 보겠습니다! ( 굳이 bp를 거는 이유는 .. 블루스크린이 뜨기 전의 마지막 드라이버코드이기 때문입니다.. )&lt;/p&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 724px; &quot;
    &gt;
      &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 31.333333333333336%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAGCAYAAADDl76dAAAACXBIWXMAAAsTAAALEwEAmpwYAAABLklEQVQY022Q606DQBCFef/3sdEa/aXRKC0sXVjYxVIsbVruxWojtpwOGzWYOMnJzJ5kvp0Zg7sCYRiCcw6lFJgbIElrbMo3rCjLxRpRsgUPIqyzGs3hqLU/tGjbT/TRdZ1WH4ZlMwjhaaDnebAtC+/7PfI8R5am2kuWS/pUoSgKfBPwE92g1kDH4ZBBAJeAQghYBGyaBlVZakDvRfO5BseLGAPS72RDGTZ34SsJTo1CBniamCjrWiuvSvIkFAEtxvASRWiPR3xR4wn/h8EeHqFoKt80KdsIbRtF/IoN3TUjQDCdYi1p3ThGnaxQ0fpVkuAjzdDRJqfdXxl8dAl/fI3ZxQjq5hbx3T12MxepOcH22YS4GiObWrrOKVdshpLuXjuUmYPG9chz6M2pj+MMhda6j2viujsAAAAASUVORK5CYII=&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;image-20211129024314132&quot;
        title=&quot;image-20211129024314132&quot;
        src=&quot;/static/a7a88f83242aacc5339c9bd2b3678742/a242d/image-20211129024314132.png&quot;
        srcset=&quot;/static/a7a88f83242aacc5339c9bd2b3678742/5a46d/image-20211129024314132.png 300w,
/static/a7a88f83242aacc5339c9bd2b3678742/0a47e/image-20211129024314132.png 600w,
/static/a7a88f83242aacc5339c9bd2b3678742/a242d/image-20211129024314132.png 724w&quot;
        sizes=&quot;(max-width: 724px) 100vw, 724px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
      /&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 268px; &quot;
    &gt;
      &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 12.686567164179104%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAADCAYAAACTWi8uAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAeklEQVQI152NuQoEIRBE5/9/TUFGPIIBDU1MPEDBo3Zs2GyjfUlXV/Vx4aW1hlor5pxUxxjkpZRQSkHOmfTJeu/Un/yrT3Z2Dtd8hfceQgga4pzDOYcQArTWeJ4HxhjyrbWIMZKWUkIphfu+wRijZ3QQP1hr4R/23vgAHDTlDYk5KfMAAAAASUVORK5CYII=&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;image-20211129024346385&quot;
        title=&quot;image-20211129024346385&quot;
        src=&quot;/static/fe91faf07f0772ce044429c9d004a0dd/484ae/image-20211129024346385.png&quot;
        srcset=&quot;/static/fe91faf07f0772ce044429c9d004a0dd/484ae/image-20211129024346385.png 268w&quot;
        sizes=&quot;(max-width: 268px) 100vw, 268px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
      /&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;그럼 이제 go 해보겟습니다!!&lt;/p&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 1200px; &quot;
    &gt;
      &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 69.33333333333334%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAOCAYAAAAvxDzwAAAACXBIWXMAAAsTAAALEwEAmpwYAAACJ0lEQVQ4y42RTW8SURSGD4Ng47ddWK2K8rHSxIULoytLxYUbVy6MpjSRWhfQVG0ZGGjRpH4uXLjxN7gwxmrU+BeMiYlxmCm01igmuqAUlVIL5PXcGSDTaQ1O8uSce+fmue+9lxZKiygtFFEu/kD5+xdUy0XUKmUs/SyhylQWiwa16i80liuoL/+2YI4bf5ZQrzewslID9Qf7EDxzFqHBMfRfHEVo4BpOh8dwauD6GkKW2iY8jtCFKE72BREOD4L4A3UfBo28B8XegaJNYutgn4++BV39CDr/WIiwu2cXSOJG8p6AM52HlNTgTusGkqLDqZi11a8hmYVzch4bhl+yUEIg4G8m9BwDJXU4EiqOPpzDxlQWJKugRAfinC41C0fkuZHQ7/NahTOQElkcejBr7Exx1ZQK4hZkaxXCOYvQt1ooEu67nYP3Xh57uXru5ozaMzWD/XdyOMjzovdw38vzvVM6um99Bl36R0JxjJ03eNFNHdu5bp7UDLZldOzg8VauXWnN+Cd6kjscWSQU6Xz3xQNlzUsXKCYuvlt3SoNL9IxbUeHOfII0tN6RE2YiebqA8WffjBSCVrot/E/IWgi5K6nCZREG/DbhpgkNsScFjDwtsNwci01EFYnbjyRbH8Vy5NVCzVjQlVL5nrLmYjuyjfgHFuZZOG0THjgOmpg3diMlbyL6Tig5UOYrHMOvbcI9R0CXX4EiL0BDTSL/Ax/1yhs4zj1qC/8CxPhpzrN8NaMAAAAASUVORK5CYII=&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;image-20211130212319831&quot;
        title=&quot;image-20211130212319831&quot;
        src=&quot;/static/35ee502496cc568878c891c836b1124c/c1b63/image-20211130212319831.png&quot;
        srcset=&quot;/static/35ee502496cc568878c891c836b1124c/5a46d/image-20211130212319831.png 300w,
/static/35ee502496cc568878c891c836b1124c/0a47e/image-20211130212319831.png 600w,
/static/35ee502496cc568878c891c836b1124c/c1b63/image-20211130212319831.png 1200w,
/static/35ee502496cc568878c891c836b1124c/5c98f/image-20211130212319831.png 1283w&quot;
        sizes=&quot;(max-width: 1200px) 100vw, 1200px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
      /&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;헉.. &lt;/p&gt;
&lt;p&gt;오늘은 이렇게 IRQL 인터럽트 마스킹 개념에 대해 알아 보았습니다!!!&lt;/p&gt;
&lt;p&gt;커널을 공부한다는 건 정말 재밌는 일 같아요 ㅎㅎ! 다음에는 컨텍스트 스위칭이 일어나는 과정을 분석 해보거나, 다양한 버그체크 덤프들을 분석하는 글을 포스팅 해보려고 합니다.!&lt;/p&gt;
&lt;p&gt;윈도우즈 커널에 대한 복잡한 내용을 쉽게 설명 해주시는 이봉석 대표님께 너무 감사드립니다. ㅎㅎ&lt;/p&gt;
&lt;h2 id=&quot;참고&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%EC%B0%B8%EA%B3%A0&quot; aria-label=&quot;참고 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;참고&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;https://rockball.tistory.com/7&quot;&gt;https://rockball.tistory.com/7&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;하제소프트 이봉석님 유튜브 🤍 - &lt;a href=&quot;https://www.youtube.com/channel/UC7Ek4hbKRdWT1idaZLz-F_Q&quot;&gt;https://www.youtube.com/channel/UC7Ek4hbKRdWT1idaZLz-F_Q&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;[Windows Internals, Part 1]&lt;/li&gt;
&lt;/ul&gt;</content:encoded></item><item><title><![CDATA[Category Test2]]></title><link>https://hyunjungg.github.io/template/</link><guid isPermaLink="false">https://hyunjungg.github.io/template/</guid><pubDate>Thu, 02 Jul 2020 16:21:13 GMT</pubDate><content:encoded></content:encoded></item><item><title><![CDATA[Category Test2]]></title><description><![CDATA[Test2]]></description><link>https://hyunjungg.github.io/security/test2/</link><guid isPermaLink="false">https://hyunjungg.github.io/security/test2/</guid><pubDate>Thu, 02 Jul 2020 16:21:13 GMT</pubDate><content:encoded>&lt;p&gt;Test2&lt;/p&gt;</content:encoded></item><item><title><![CDATA[about]]></title><description><![CDATA[Your name Thank you for reading my resume. If you want to contact me, Please send me an email.]]></description><link>https://hyunjungg.github.io/resume-ko/</link><guid isPermaLink="false">https://hyunjungg.github.io/resume-ko/</guid><pubDate>Sun, 27 Jan 2019 16:21:13 GMT</pubDate><content:encoded>&lt;h1 id=&quot;your-name&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#your-name&quot; aria-label=&quot;your name permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Your name&lt;/h1&gt;
&lt;div align=&quot;center&quot;&gt;
&lt;p&gt;&lt;em&gt;Thank you for reading my resume. If you want to contact me, Please send me an email.&lt;/em&gt;&lt;/p&gt;
&lt;/div&gt;</content:encoded></item></channel></rss>